C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\obj\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\..\KERNEL\SYSTEM\main.c OPTIMIZE(SIZE) BROWSE INCDIR(..\..\DRIVER\INC;..
                    -\..\KERNEL\SCALER\INC;..\..\KERNEL\SYSTEM\INC;..\..\LIB\INC;..\..\PANEL\INC;..\..\BOARD;..\..\DRIVER\INC;..\..\KERNEL\SY
                    -STEM\INC\AOC2011;..\..\DRIVER\extDEVICE\INC;..\..\MODEL;..\..\CONFIG;..\..\PANEL;..\..\UI\F_LOGO\INC;..\..\UI\HkcOsd\INC
                    -) DEFINE(ModelName=JRY_TESTBOARD_C_BOARD) DEBUG OBJECTEXTEND PRINT(.\list\main.lst) OBJECT(.\obj\main.obj)

line level    source

   1          #include "types.h"
   2          #include "board.h"
*** MESSAGE C320 IN LINE 337 OF ..\..\CONFIG\BOARD.H: "Please remember to disable the debug function!" 
   3          #include "global.h"
   4          #include "mcu.h"
   5          #include "detect.h"
   6          #include "menu.h"
   7          #include "ms_reg.h"
   8          #include "power.h"
   9          #include "debug.h"
  10          #include "ms_rwreg.h"
  11          #include "msosd.h"
  12          #include "misc.h"
  13          #include "NVRam.h"
  14          #include "mstar.h"
  15          #include "UserPref.h"
  16          #include "keypad.h"
  17          #include "Panel.h"
  18          #include "msflash.h"  //2006-03-20
  19          #include "ddc2bi.h"
  20          #include "menudef.h"//071226
  21          #include "keypaddef.h"
  22          #if DDCCI_ENABLE   || AudioFunc
  23              #include "adjust.h"
  24          #endif
  25          #if MWEFunction
  26              #include "MsDLC.h"
  27              #include "MsACE.h"
  28          #endif
  29          
  30          #if ENABLE_RTE
                  #include "drvmsovd.h"
              #endif
  33          
  34          #if ENABLE_HDMI
  35          #include "MsHDMI.h"
  36          #endif
  37          #if 1   //#ifdef ReduceDDC   For WH_REQUEST
  38          #include "ddc.h"
  39          #endif
  40          #if MS_DAC
  41          #include "drvDAC.h"
  42          #endif
  43          #if MS_PM
  44          #include "MS_PM.h"
  45          #endif
  46          
  47          #if ENABLE_DisplayPortTX
              #include "drvDPTxApp.h"
              #endif
  50          
  51          int i;
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 2   

  52          ////////////////////////////////////
  53          //#include "drvMcu.h"
  54          ///////////////////////////////////
  55          #include "GPIO_DEF.h"
  56          
  57          #if  ENABLE_ANDROID_IR  //131008 Modify
              #include "drv_Ir.h"
              #endif
  60          
  61          #define Main_DEBUG    0
  62          #if ENABLE_DEBUG&&Main_DEBUG
                  #define Main_printData(str, value)   printData(str, value)
                  #define Main_printMsg(str)           printMsg(str)
              #else
  66              #define Main_printData(str, value)
  67              #define Main_printMsg(str)
  68          #endif
  69          
  70          void Init_Device(void);
  71          void Main_SlowTimerHandler(void);
  72          extern void Init_GlobalVariables(void);
  73          extern void NVRAM_i2C_Intial(void); //2006/03/20
  74          //extern WORD ReadFlashID(DWORD address); 
  75          
  76          extern BYTE xdata PowerDownCounter;
  77          #if ENABLE_DeltaE
              extern BYTE xdata bToolWriteGamma;
              #endif
  80          #if ENABLE_HDCP
  81              #if HDCPKEY_IN_Flash
  82                  extern void msInitHDCPProductionKey(void);
  83              #endif
  84          #endif
  85          
  86          #if 1// 110915 coding def OffPower           //090331 xiandi.yu Auto Off Power
  87          extern PowerOffSystem(void);
  88          #endif
  89          
  90          #if Enable_CheckVcc5V
              extern Bool CheckVCC5V ( void );
              #endif
  93          
  94          //extern BYTE Second;
  95          
  96          #if ((CHIP_ID == CHIP_TSUM9 || CHIP_ID == CHIP_TSUMF)&& ENABLE_CABLE_5V_EDID)
              void ReadHdcpEdidInFlashSetting(void)
              {
                      FLASH_HDCP_EDIDAddr = FDATA_HDCPKEY_START_ADDR; 
              }
              #endif
 102          
 103          
 104          
 105          #if AudioFunc
 106          
 107          #if All_AudioDet
              
              void CheckEarphoneDetStatus(void)
              {
                      
                   if (HarphoneDet_Pin) 
                      {
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 3   

                              if(bAudioInputStatus == AudioInput_Spk)
                              {
                              #if DEBUG_MSG
                              printMsg("change to ear");
                              #endif
                                      Delay1ms(1);
                                      if (HarphoneDet_Pin)
                                      {
                                             #if SWAP_LR_CHANNL
                                                #if CHIP_ID==CHIP_TSUMU  
                                              msWriteByte(REG_2C05, 0x00);
                                                #else
                                                #endif
                                               #endif  
                                              Set_EarphoneDetStatusChangeFlag();
                                              bAudioInputStatus = AudioInput_Ear;
                                      }
                              }
              
                       }
                       else
                       {
                              if(bAudioInputStatus == AudioInput_Ear)
                                      {
                                              Delay1ms(1);
                                              if (HarphoneDet_Pin)
                                              {
                                                      ;
                                              }
                                              else
                                              {
                              #if DEBUG_MSG           
                              printMsg("change to spk");
                              #endif
                                                 #if SWAP_LR_CHANNL
                                                      #if CHIP_ID==CHIP_TSUMU
                                                      msWriteByte(REG_2C05, 0x10);
                                                      #else
              
                                                      #endif
                                                    #endif               
                                                      msAudioLineOutGain( Def_DACGain );
                                                      msAudioEARout_Mute( FALSE );
                                                      Set_EarphoneDetStatusChangeFlag();
                                                      bAudioInputStatus = AudioInput_Spk;
                                              }
                                      }
                       }
                       
              }
              
              
              
              
              void Volume_EarphoneDetHander(void)
              {
                      CheckEarphoneDetStatus();
              
                      if(EarphoneDetStatusChangeFlag)
                      {
                              #if DEBUG_MSG           
                              printMsg("change to audio");
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 4   

                              #endif  
                              mStar_AdjustVolume(UserPrefVolume);
                              Clr_EarphoneDetStatusChangeFlag();
                      }
              }
              #endif
 182          
 183          
 184          #endif
 185          
 186          
 187          
 188          void main(void)
 189          {   
 190   1      
 191   1       #if Enable_CheckVcc5V
                   Restart:
              #endif
 194   1      
 195   1      
 196   1      #if (CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSUMF)
                  #if ENABLE_CABLE_5V_EDID
                  ReadHdcpEdidInFlashSetting();
                  #endif
                      drvmStar_PowerOnInit(); 
              #if (CHIP_ID == CHIP_TSUMF)
                              MPLL_CLOCK_ADC(TRUE);
              #endif
              #endif
 205   1      
 206   1      
 207   1      #if ENABLE_DP_INPUT
                  gDPInfo.bDPSave = 1;
                  g_bDoDPInit = TRUE;
              #endif
 211   1      
 212   1          Init_MCU();
 213   1      
 214   1      #if (CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSUMF)
                      if (!g_bFROTrimResult)
                              Main_printMsg("FRO trim failed!");
              #endif
 218   1      
 219   1      #if( ENABLE_WATCH_DOG ) //130716 xiandi follow demo code
                      WDT_CLEAR();
              #endif
 222   1      
 223   1          ForceDelay1ms(100); // 100802 coding, wait for system power stable then execute scalar setting
 224   1          ScalerReset();
 225   1          mcuSetSystemSpeed(SPEED_NORMAL_MODE);
 226   1          Delay1ms( 100 );
 227   1              
 228   1              
 229   1      
 230   1          GPIOPWMSelect();    
 231   1      
 232   1          g_ucFlashID = ReadFlashID();
 233   1              
 234   1      #if !USEFLASH 
                  NVRAM_i2C_Intial(); 
              #endif
 237   1      
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 5   

 238   1      #if DisplayPowerOnLogo
 239   1          UserPrefLogoON=1;   //120420 Modify
 240   1      #endif    
 241   1      
 242   1      
 243   1      #if  Enable_CheckVcc5V
                  if ( CheckVCC5V() )         
                      goto Restart;
              #endif
 247   1      //å•ç‰‡æœºä¸Šç”µï¼Œåˆå§‹åŒ–é˜¶æ®µä¼šè¯»flashé‡Œé¢ä¿å­˜çš„å±å¹•å„ç§æ•°æ®
 248   1          ReadMonitorSetting(); //Benz 2007.4.23   19:11:22                                                                                                   // flash 
 249   1      
 250   1      
 251   1          mStar_InitDDC(); // 2017/02/20                                                                                                                                              //my EDID
 252   1         
 253   1          mStar_Init(); //2006-03-07                                                                          //
             -my
 254   1      
 255   1      
 256   1              
 257   1      #if  (MS_PM)
 258   1              msPM_Init();
 259   1      #endif
 260   1      #if (FEnterFunction==FEnter_AC_MENU)
 261   1             CheckFactoryKeyStatus();
 262   1      #endif
 263   1              
 264   1          Init_GlobalVariables();                                                                         //my  
             -     ACON 
 265   1          Menu_InitVariable();        
 266   1          Init_Device();
 267   1          DDC2Bi_Init();
 268   1      #if ENABLE_FACTORY_BLACKLEVEL  ||   ENABLE_DDCCI_BLACKLEVEL   
                  mStar_AdjustUserPrefBlacklevel(UserprefRedBlackLevel, UserprefGreenBlackLevel, UserprefBlueBlackLevel)
             -;
              #else
 271   1          mStar_AdjustUserPrefBlacklevel(DefRedBlackLevel, DefGreenBlackLevel, DefBlueBlackLevel);
 272   1      #endif
 273   1              
 274   1      #if ENABLE_MHL
                      mapi_mhl_init();
              #endif
 277   1      
 278   1      
 279   1      
 280   1      do {            
 281   2      
 282   2      
 283   2              #if     (MS_PM)
 284   2              while(1)
 285   2              {
 286   3                      msPM_Handler();//æŒ‰é”®å¼€å…³å¯åŠ¨å…¥å£                                                                                                                               my DCON
 287   3                      if(msPM_IsState_IDLE())break;//æŽ¥ä¸‹æ¥çš„æµç¨‹è·Ÿâ€œä¸Šç”µä¸”æœ‰ä¿¡å·çš„æƒ…å†µï¼Œéœ€è¦èµ°å‰é¢çš„å
             -ˆå§‹åŒ–â€ä¸€æ ·
 288   3              }
 289   2              #endif
 290   2      
 291   2      
 292   2              
 293   2              while(1)
 294   2              {
 295   3      
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 6   

 296   3      #if Enable_CheckVcc5V
                        if ( CheckVCC5V() )   goto Restart;     
              #endif
 299   3      
 300   3      
 301   3                      DebugHandler();
 302   3                      if(DebugOnlyFlag)
 303   3                              continue;
 304   3      
 305   3      #if( ENABLE_WATCH_DOG ) //130702 xiandi
                              WDT_CLEAR();//ClearWDT();
              #endif
 308   3      //æ•°æ®è¯»å–æˆ–è€…å‘é€å®Œæ¯•åŽé€€å‡ºä¸­æ–­ã€‚
 309   3                      DDC2Bi_CommandHandler();
 310   3      
 311   3                      Main_SlowTimerHandler();
 312   3      
 313   3      #if JRY_Color_Tool_Functing
 314   3                      if (ATEModeFlag)
 315   3                              continue;
 316   3      
 317   3              #if LoadAllPortSeriealnumberByOneVGAPort
 318   3              if(DDCCOneVGAPortLoadEDIDFlag&&!ATEModeFlag)
 319   3              {
 320   4              hw_ClrAmberLed();
 321   4              hw_ClrGreenLed();               
 322   4              ReLoadEDIDtoAddSN();
 323   4               Clr_DDCCOneVGAPortLoadEDIDFlag();      
 324   4              }
 325   3              #endif
 326   3      
 327   3                      
 328   3                      #if WriteSN_Functiom_New
                              if(DDCCIReadLoadEDIDFlag) break;
                              #elif JRY_FDDCCI_WriteEDID
 331   3                      if (DDCCIReadLoadEDIDFlag&&DDCCILoadEDIDCount%3==0)
 332   3                      {
 333   4                              mStar_InitDDC();
 334   4                              #if ENABLE_DP_INPUT
                                      DPRxEDIDLoad();
                                      #endif
 337   4                              Clr_DDCCIReadLoadEDIDFlag();
 338   4                              DDCCILoadEDIDCount=0;
 339   4                      }
 340   3                      #endif  
 341   3      #endif
 342   3                              
 343   3      #if ENABLE_DeltaE
                              if(bToolWriteGamma) //nick add for avoid delta-E fail 20131122
                                              continue;
              #endif
 347   3      
 348   3                          
 349   3      #if 0//def UseVGACableReadWriteAllPortsEDID
                              #if ENABLE_DP_INPUT||ENABLE_MHL //121228 Modify
                                      if(LoadEDIDFlag)
                                      {
                                      #if ENABLE_DP_INPUT
                                              DPRxEDIDLoad();
                                      #endif
                                      #if ENABLE_MHL
                                              mapi_mhl_init();
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 7   

                                      #endif
                                              Clr_LoadEDIDFlag();
                                      }
                              #endif
                                  if(WriteDeviceFlag)
                                      continue;
              #endif
 365   3      
 366   3      //3ÕâÊÇDDCCIÉÕÂ¼HDCP£¬ÎÒÃÇ²»ÐèÒªÊ¹ÓÃ
 367   3      #if 0//ENABLE_HDCP                      
                          #if HDCPKEY_IN_Flash
                              if (WriteHDCPcodeFlag)
                                      continue;
              
                              if (LoadHDCPKeyFlag)
                                      {
                                              msInitHDCPProductionKey();
                                              Clr_LoadHDCPKeyFlag();
                                              #if ENABLE_DP_INPUT     //121228 Modify
                                              DPRxHDCPLoadKey();
                                              #endif
                                      }
                          #endif
              #endif
 382   3                              
 383   3      
 384   3                      Power_PowerHandler();
 385   3      #if (MS_PM)
 386   3                      if(!msPM_IsState_IDLE())break;
 387   3      #endif
 388   3      
 389   3                              if (!ModeDetectCounter || InputTimingChangeFlag)                                                                                                //my DC/ACON
 390   3                              {       
 391   4              //                      printData("                                            ");
 392   4              //                      printData("NO ----------------------------------------%d", i++);
 393   4              ///                     printData("InputTimingStableCounter %d", InputTimingStableCounter);
 394   4              //                      printData("InputTimingChangeFlag--- %d", InputTimingChangeFlag);
 395   4              //                      printData("SrcFlags ----------------%d", SrcFlags);
 396   4              //                      printData("DoModeSettingFlag------- %d", DoModeSettingFlag);
 397   4              //                      printData("FreeRunModeFlag--------- %d", FreeRunModeFlag);
 398   4              //                      printData("                                            ");
 399   4                                      mStar_MonitorInputTiming();                                                                //my
 400   4                                      ModeDetectCounter = 20;
 401   4                              }
 402   3      
 403   3                      mStar_ModeHandler();                                                                         //my
             -       find mode
 404   3      
 405   3      #if(CHIP_ID==CHIP_TSUM9)
              #if (ENABLE_HDMI || ENABLE_DVI)
                              drv_TMDS_DATA_ALIGN();
              #endif
              #endif
 410   3      
 411   3      #if ENABLE_HDMI
 412   3                      mstar_HDMIHandler();
 413   3      #endif
 414   3      
 415   3      #if ENABLE_DP_INPUT
                          if (CURRENT_INPUT_IS_DISPLAYPORT())
                              DPRxHandle();             // DP hander
              #endif
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 8   

 419   3      
 420   3      #if ENABLE_DisplayPortTX
                      //if( !SyncLossState() )
                              DPTxHandle();
              #endif
 424   3      
 425   3      
 426   3      #if MS_DAC
 427   3      #if (CHIP_ID==CHIP_TSUMC ||CHIP_ID==CHIP_TSUMD||CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSUMF)
 428   3                           msDACInitStep();
 429   3      #endif
 430   3                              msAudioGainToggle();
 431   3      #endif
 432   3      
 433   3                       Menu_OsdHandler();
 434   3      
 435   3      #if (MS_PM)
 436   3                              if(!msPM_IsState_IDLE())break;
 437   3      #endif
 438   3      
 439   3      #if MWEFunction
 440   3                          if ((UserPrefDcrMode) && PowerOnFlag && !SyncLossState() && !FreeRunModeFlag&& InputTimingStableFlag
             -)//edit by yz.nie .for DCR ON,change timing quickly have white screen.
 441   3                          {
 442   4                              msDlcHandler();
 443   4                          msDCRHandler();
 444   4                          }
 445   3      #endif
 446   3      
 447   3                          
 448   3      
 449   3      
 450   3      #if 0// ENABLE_MHL
                          if(MHL_CHECK_CONDITION()) // 120614 coding addition//130703 nick
                          { 
                              #if ((CHIP_ID == CHIP_TSUMC || CHIP_ID == CHIP_TSUMD||CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSU
             -MF))
                                      #if MHL_HW_RTERM_SUPPORT                // 130717 william For G15 compiling warning
                                  mapi_mhl_RtermControlHWMode(FALSE);
                                      #endif
                              #endif
                              mapi_mhl_handler();
                              #if ((CHIP_ID == CHIP_TSUMC || CHIP_ID == CHIP_TSUMD||CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSU
             -MF))
                                      #if MHL_HW_RTERM_SUPPORT                // 130717 william For G15 compiling warning
                                  mapi_mhl_RtermControlHWMode(TRUE);
                                      #endif
                              #endif
                          }
              #endif
 466   3      
 467   3      #if AudioFunc
 468   3      #if All_AudioDet
              
              if((!InputTimingChangeFlag)&&InputTimingStableFlag&&(!SyncLossState())&&(!PowerSavingFlag)&&PanelOnFlag&&(
             -!UnsupportedModeFlag))
                      Volume_EarphoneDetHander();
              
              #endif
 474   3      #endif
 475   3      
 476   3      #if USEFLASH
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 9   

 477   3                              UserPref_FlashDataSaving();                                                                                     //flashæ•°æ®æ›´æ”¹
 478   3      #endif
 479   3      
 480   3                 }
 481   2      
 482   2      #if WriteSN_Functiom_New
              #message "Äã½«Ê¹ÓÃÖ»ÉÕÂ¼SNµÄ·½Ê½£¬ÇëÈ·ÈÏÊÇ·ñÂú×ãÐèÇó"
              #message "ÈôÊ¹ÓÃ£¬Çë×ñÊØ¹æ·¶"
              if(DDCCIReadLoadEDIDFlag)
              {
                    ReLoadEDIDtoAddSN();
                      mStar_InitDDC();
                      #if ENABLE_DP_INPUT
                      DPRxEDIDLoad();
                      #endif  
                  Clr_DDCCIReadLoadEDIDFlag();        
                  Power_TurnOnGreenLed();
              }       
              #endif
 496   2      
 497   2              
 498   2      }    while (1);
 499   1      }
 500          
 501          
 502          void Init_Device()
 503          {
 504   1      
 505   1      
 506   1      #if AudioFunc
 507   1              mStar_AdjustVolume(0);
 508   1      #endif
 509   1      
 510   1      
 511   1      
 512   1              if (PowerOnFlag)
 513   1              {
 514   2                  Power_TurnOnGreenLed();             
 515   2              }
 516   1              else
 517   1              {
 518   2                  Power_TurnOffLed();
 519   2              }
 520   1      }
 521          
 522          #if Enable_CheckVcc5V
              extern void Osd_Hide( void );
              extern void Power_PowerOffSystem( void );
              
              Bool CheckVCC5V ( void )
              {
                  if ( !hwDetectVCC5V_Pin )  
                  {
                      Delay1ms ( 20 );
                      if ( !hwDetectVCC5V_Pin )
                      {
                          Clr_CheckVcc5VFlag();
                      if(PowerOnFlag&&(!PowerSavingFlag))
                        {
                          hw_ClrBlacklit();
                          hw_ClrPanel();
                           Osd_Hide();
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 10  

                          Power_PowerOffSystem();
                          hw_ClrGreenLed();
                          hw_ClrAmberLed();
                        }
                       else
                        {     
                         hw_ClrGreenLed();
                         hw_ClrAmberLed();
                        }
                          Delay1ms ( 20 );
                          while ( 1 )
                          {
                              if ( hwDetectVCC5V_Pin )
                              {
                                  Delay1ms ( 20 );
                                  if ( hwDetectVCC5V_Pin )
                                  {   Set_CheckVcc5VFlag();
                                      return TRUE;
                                  }
                              }
                          }
                      }
                  }
              
                  return FALSE;
              }
              
              
              #endif
 568          //read mode 870
 569          void Main_SlowTimerHandler(void)                                                                                                                                        //å¯æ£€æµ‹æ˜¯å¦ä½¿ç”¨flashä¿å­˜ p877
 570          {
 571   1          if(ms10Flag)
 572   1          {
 573   2              if (ModeDetectCounter)
 574   2              {
 575   3                  if(ModeDetectCounter > 10)
 576   3                      ModeDetectCounter -= 10;
 577   3                  else       
 578   3                      ModeDetectCounter = 0;
 579   3              }
 580   2      
 581   2              if( TPDebunceCounter )
 582   2              {
 583   3                  if(TPDebunceCounter > 10)
 584   3                      TPDebunceCounter -= 10;
 585   3                  else
 586   3                      TPDebunceCounter = 0;
 587   3              }
 588   2      
 589   2      #if ENABLE_HDMI
 590   2              if(HdmiPollingCounter)
 591   2              {
 592   3                  if(HdmiPollingCounter > 10)
 593   3                      HdmiPollingCounter -= 10;
 594   3                  else
 595   3                      HdmiPollingCounter = 0;
 596   3              }
 597   2      
 598   2              if (gScInfo.InputTmdsType==TMDS_HDMI && (!(SrcFlags&(SyncLoss|bUnsupportMode))) )
 599   2              {
 600   3                  if(gScInfo.wAviPktLossCnt<AviPktLossBound)
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 11  

 601   3                      gScInfo.wAviPktLossCnt += 10;
 602   3              }
 603   2      #endif
 604   2      
 605   2      
 606   2      #if MS_DAC
 607   2              if(ToggleGainCntr)
 608   2              {
 609   3                  if(ToggleGainCntr > 10)
 610   3                      ToggleGainCntr -= 10;
 611   3                  else
 612   3                  {
 613   4                      ToggleGainCntr = 0;
 614   4                      bToggleGainFlag = 1;
 615   4                  }
 616   3                      
 617   3              }
 618   2      #endif
 619   2      
 620   2      
 621   2      #if ENABLE_MHL
                  #if((CHIP_ID == CHIP_TSUMC) ||(CHIP_ID == CHIP_TSUMD||CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSUMF))
                              mapi_mhl_PollingTimerhandler();
                  #endif
              #endif
 626   2      
 627   2      #if MS_DAC && ((CHIP_ID == CHIP_TSUMC) || (CHIP_ID == CHIP_TSUMD) || (CHIP_ID == CHIP_TSUM9)|| (CHIP_ID ==
             - CHIP_TSUMF))
 628   2      #if (!InitialDACByISR)
                              if( w16DAC_DePopCounter )
                              {
                                      if(w16DAC_DePopCounter > 10)
                                      {
                                              w16DAC_DePopCounter -= 10;
                                      }
                                      else
                                      {
                                              w16DAC_DePopCounter = 0;
                                              bDAC_DePopFlag = 1;
                                      }
                              }
              #endif
 642   2      #endif
 643   2      
 644   2      
 645   2              Clr_ms10Flag();
 646   2          }
 647   1          
 648   1          if(ms50Flag)
 649   1          {
 650   2      
 651   2              Clr_ms50Flag();
 652   2          }
 653   1      #if 0//ENABLE_FREESYNC
                  if(ms250Flag)
                  {
                      Clr_ms250Flag();
                      
                      //if(USER_PREF_FREE_SYNC)//need check it
                          Set_FreeSyncFlag();
                  }
              #endif
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 12  

 662   1      #if 0//ENABLE_FREESYNC
                      if(ms250Flag)
                      {
                          Clr_ms250Flag();
                          
                      }
              #endif
 669   1      
 670   1          if(SecondFlag)
 671   1          {
 672   2      
 673   2      #if ((ENABLE_FREESYNC)&&(CHIP_ID==CHIP_TSUMU))//mqsh 20170421 for RX480 dp freesync on sometime get DRRFla
             -g error
                  if((PowerOnFlag)&&(!SyncLossState())&&(!FreeRunModeFlag)&&(!InputTimingChangeFlag)&&(!UnsupportedModeF
             -lag)&&(UserprefFreeSyncMode==FreeSyncMenuItems_On)&&(CURRENT_INPUT_IS_DISPLAYPORT()))
                  {
                      if(DCOffOnCounter)
                      {
                        if((msRead2Byte(SC0_0F))!=0x02)
                          {
                           if(DPRxGetDRRFlag())
                           {
                                BYTE xdata ucDlyLine,u8SampleRangeVStartOffset; //SC0_7E
                  
                         if( ( CURRENT_SOURCE_IS_INTERLACE_MODE() )
                          || (g_SetupPathInfo.ucSCFmtIn == SC_FMT_IN_3D_FP)
                          || ((g_SetupPathInfo.wImgSizeOutV / g_SetupPathInfo.wImgSizeInV) >=3) )
                             ucDlyLine = 2;
                         else
                             ucDlyLine = 1;
                     
                      #if ENABLE_DUAL_LINK//for DP 1680x1050/60Hz flick
                         if(CURRENT_INPUT_IS_DISPLAYPORT())  // follow trunk code
                             ucDlyLine = 2;   
                      #endif
                                
                                msWriteByteMask(SC0_0F, 0x02, 0x0F); //Ylock line
                                u8SampleRangeVStartOffset = (msRead2Byte(SC0_7E)) + (4 - ucDlyLine); 
                                msWrite2Byte(SC0_05, u8SampleRangeVStartOffset); // set capture window vstart
                           }
                            DCOffOnCounter--;
                          }
                      }
                  }
              #endif
 705   2      
 706   2              
 707   2      
 708   2      #if FactoryLedFlicker_Enable
                      if(FactoryModeFlag)
                  {
                      LedCounter ++; 
                      if(LedCounter%2)
                      {
                              hw_SetGreenLed();
                              //hw_SetAmberLed();
                      }       
                      else
                      {
                              hw_ClrGreenLed();
                              //hw_ClrAmberLed();
                      }
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 13  

                  }
              #endif
 724   2      
 725   2      
 726   2      #if PowerSaveLedFlicker_Enable
                  if((PowerSavingFlag&&PowerOnFlag))
                  {
                      LedCounter ++; 
                      if(LedCounter%2)
                      {
                              hw_SetGreenLed();
                              //hw_SetAmberLed();
                      }       
                      else
                      {
                              hw_ClrGreenLed();
                              //hw_ClrAmberLed();
                      }
                  }
              #endif  
 742   2               
 743   2      
 744   2      
 745   2      #if EANBLE_NEW_DCR_Functing
 746   2             if(DCR_Counter!=0&&EanbleClearBalclightStartFlag)
 747   2                 if(--DCR_Counter==0)
 748   2                   Set_DoClearBalclightFlag();
 749   2      #endif
 750   2      
 751   2      
 752   2              if (!PowerSavingFlag)
 753   2              {
 754   3              #if Show_BackLightTimeValue
 755   3              if (BlacklitTime_S<0xFF)
 756   3               {
 757   4                      BlacklitTime_S++;
 758   4                              if (BlacklitTime_S>=60)
 759   4                              {
 760   5                                      BlacklitTime_S=0;
 761   5                                      BlacklitTime_M++;
 762   5      
 763   5                                      if (BlacklitTime_M%30==0)
 764   5                                      {
 765   6                                              if (BlacklitTime_M>=60)
 766   6                                              {
 767   7                                                      BlacklitTime_M=0;
 768   7      
 769   7      
 770   7                                                      if (BlacklitTime_H>=0xFFFF)
 771   7                                                      {
 772   8                                                              BlacklitTime_H=0xFFFE;
 773   8                                                      }
 774   7                                                      BlacklitTime_H++;
 775   7                                              }       
 776   6                                              BlacklitTime_S=18;//2½ÃÕýÊ±¼ä
 777   6                                              
 778   6                                              MonitorBackLightTime_M=BlacklitTime_M;
 779   6                                              MonitorBackLightTime_H=BlacklitTime_H;
 780   6                                              SaveMonitorSetting2();
 781   6                                      }
 782   5      
 783   5                              
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 14  

 784   5                              }
 785   4                      }
 786   3                      else
 787   3                              BlacklitTime_S=0;
 788   3                      #endif                  
 789   3              }
 790   2                      
 791   2      #if JRY_Color_Tool_Functing
 792   2              if (WhileCounte>0&&(ATEModeFlag))
 793   2              {
 794   3                      WhileCounte--;
 795   3      
 796   3                      if (WhileCounte==0)
 797   3                              Clr_ATEModeFlag();
 798   3              }
 799   2      #endif
 800   2      
 801   2      #if JRY_FDDCCI_WriteEDID
 802   2              DDCCILoadEDIDCount++;
 803   2      #endif
 804   2      
 805   2                      #if ESaverPowerDownFunc
 806   2                      if(ESaverPowerDownCounter)
 807   2                        {
 808   3                   if(--ESaverPowerDownCounter == 0)
 809   3                              {
 810   4                              {
 811   5                                      MenuPageIndex=PowerOffMenu;
 812   5                                      MenuItemIndex=0;
 813   5                                      PowerOffSystem();
 814   5                              }
 815   4                              }
 816   3                              // Osd_Draw4Num(1,2,ESaverPowerDownCounter);
 817   3                        }
 818   2                      #endif
 819   2      
 820   2      
 821   2              #if Enable_ButtonKeyLongPressFunction
                       if(g_HoldKeypadButton<BTN_EndBTN)
                           if(g_HoldKeyCounter<10)
                                  g_HoldKeyCounter++;
                      #endif
 826   2              
 827   2              if (OsdCounter)
 828   2              {  
 829   3                  if (--OsdCounter == 0)
 830   3                  {
 831   4                      Set_OsdTimeoutFlag();
 832   4                      #if DEBUG_HOTSWITCH
                                  printMsg("Set_OsdTimeoutFlag");
                              #endif
 835   4                  }
 836   3              }
 837   2                  
 838   2              if (HotKeyCounter)
 839   2              {
 840   3                  if (--HotKeyCounter == 0)
 841   3                  {
 842   4                      if (PressExitFlag)
 843   4                          Set_EnableShowDDCFlag();
 844   4                  }
 845   3              }
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 15  

 846   2      
 847   2      
 848   2      
 849   2      #if ENABLE_OVER_SCAN && AudioFunc       //121211 Modify
                              if (HotKeyPlusCounter)
                              {
                                      if (--HotKeyPlusCounter == 0)
                                      {
                                              if (PressPlusFlag)
                                                      Set_EnableExpansionMenuFlag();
                                      }
                              }
              #endif
 859   2              if (DoKeyCountFlag && PowerOnFlag)
 860   2              {
 861   3                  PowerKeyCounter++;
 862   3                  PowerKeyCounter%=2;// /3;For GPM Request
 863   3                  if(PowerKeyCounter==0)
 864   3                      Set_PowerOffFlag();
 865   3              }
 866   2      
 867   2      
 868   2              if (PowerDownCounter)
 869   2              {
 870   3                  if (--PowerDownCounter == 0)
 871   3                  {
 872   4                      Set_ForcePowerSavingFlag();
 873   4                  }
 874   3              }
 875   2                  
 876   2      
 877   2      #if USEFLASH
 878   2              UserPref_FlashSaveFlagCheck();//edit by lizzie,100429.for FlashSave every 1s,suggest by hungyi.cai 
 879   2      #endif
 880   2      
 881   2          Set_ChangePatternFlag();
 882   2          Clr_SecondFlag();
 883   2              
 884   2              #if ( defined(OffPower))//  130723 william For PowerSaving timer slowly  && EXT_TIMER0_1S==0 )         //
             -120919 Modify  20130510 update 
                      if (UserPrefAutoPowerOff && PowerOnFlag)
                      {
                              AutoPowerOffSTime++;
                              if ((AutoPowerOffSTime%60)==0)
                              { 
                                      AutoPowerOffSTime=0;
                                      AutoPowerOffMTime++;
                                      if ((!PowerSavingFlag) && (AutoPowerOffHTime == (UserPrefAutoPowerOff-1)))              //130123_3 Henry
                                      {
                                              if((AutoPowerOffMTime == 50)
                                                      )
                                                      ShowOffPowerWarningFlag = 1;
                                      }
                                      if ((AutoPowerOffMTime%60)==0)
                                      {
                                              AutoPowerOffMTime=0;
                                              if (AutoPowerOffHTime<UserPrefAutoPowerOff)
                                              {
                                                      AutoPowerOffHTime++;
                                                      if (AutoPowerOffHTime==UserPrefAutoPowerOff)
                                                      {
                                                              {
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 16  

                                                                      MenuPageIndex=PowerOffMenu;
                                                                      MenuItemIndex=0;
                                                                      PowerOffSystem();
                                                              }
                                                      }
                                              }                                                
                                      }
                              }                                
                      }
                      #endif
 917   2      
 918   2          }
 919   1      
 920   1      
 921   1      #if (EXT_TIMER0_1S)// 2012-05-23-1
 922   1          if (g_oneSecondFlag)
 923   1          {
 924   2              g_oneSecondFlag=0;
 925   2              
 926   2              // minute routine
 927   2              if(g_oneMinuteFlag)
 928   2              { 
 929   3                  g_oneMinuteFlag = 0;
 930   3      
 931   3      
 932   3      #if     0// 130723 william For PowerSaving timer slowly  OffPower
                          if(AUTO_POWER_OFF_ACTIVE)
                          {
                              AutoPowerOffMTime++;
              
                              if(AutoPowerOffMTime == 50)
                              {
                                  if((!PowerSavingFlag) &&( AutoPowerOffHTime == (UserPrefAutoPowerOff-1)))
                                  {
                                      ShowOffPowerWarningFlag = 1;
                                  }
                              }
                              else if ((AutoPowerOffMTime%60)==0)
                              {
                                  AutoPowerOffMTime=0;
                                  
                                  if (AutoPowerOffHTime<UserPrefAutoPowerOff)
                                  {
                                      AutoPowerOffHTime++;
                                      
                                      if (AutoPowerOffHTime==UserPrefAutoPowerOff)
                                      {
                                          MenuPageIndex=PowerOffMenu;
                                          MenuItemIndex=0;
                                          PowerOffSystem();
                                      }
                                  }                                            
                              }                
                          }
              #endif
 962   3              }
 963   2          }
 964   1      #endif
 965   1      
 966   1      
 967   1      
 968   1      }
C51 COMPILER V9.01   MAIN                                                                  08/18/2023 11:33:05 PAGE 17  

 969          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    751    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
