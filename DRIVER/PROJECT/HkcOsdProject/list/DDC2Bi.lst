C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE DDC2BI
OBJECT MODULE PLACED IN .\obj\DDC2Bi.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\..\KERNEL\SYSTEM\DDC2Bi.c OPTIMIZE(SIZE) BROWSE INCDIR(..\..\DRIVER\INC;
                    -..\..\KERNEL\SCALER\INC;..\..\KERNEL\SYSTEM\INC;..\..\LIB\INC;..\..\PANEL\INC;..\..\BOARD;..\..\DRIVER\INC;..\..\KERNEL\
                    -SYSTEM\INC\AOC2011;..\..\DRIVER\extDEVICE\INC;..\..\MODEL;..\..\CONFIG;..\..\PANEL;..\..\UI\F_LOGO\INC;..\..\UI\HkcOsd\I
                    -NC) DEFINE(ModelName=JRY_TESTBOARD_C_BOARD) DEBUG OBJECTEXTEND PRINT(.\list\DDC2Bi.lst) OBJECT(.\obj\DDC2Bi.obj)

line level    source

   1          #include "types.h"
   2          #include "board.h"
*** MESSAGE C320 IN LINE 337 OF ..\..\CONFIG\BOARD.H: "Please remember to disable the debug function!" 
   3          #include "global.h"
   4          #include "Menudef.h"
   5          #include "menufunc.h"
   6          #include "adjust.h"
   7          #include <math.h>
   8          #include "ms_reg.h"
   9          #include "msOSD.h"
  10          #include "msosdfunction.h"
  11          #include "autofunc.h"
  12          #include "drvadc.h"
  13          #include "ms_rwreg.h"
  14          #include "Debug.h"
  15          #include "misc.h"
  16          #include "mstar.h"
  17          #include "power.h"
  18          #include "keypaddef.h"
  19          #include "ddc2bi.h"
  20          #include "userpref.h"
  21          
  22          #include "msACE.h"
  23          #include "gamma.h"
  24          #include "msflash.h"
  25          #include "mcu.h"
  26          #include "ddc.h"
  27          #include "nvram.h"
  28          #include "GPIO_DEF.h"
  29          #ifdef TSUMXXT//#if( ChipID == ChipTSUMT )              //110311 Modify
              #include "msADC.h"
              #endif
  32          #if PanelminiLVDS || PANEL_VCOM_ADJUST  //110229 Modify
              #include "msMiniLVDSI2c.h"
              #endif
  35          #include "drvgpio.h"
  36          #include "PropFont.h"
  37          ////////////////////////////////////////////////////
  38          //#include "drvDDC2Bi.h" // the function changes to hal
  39          ///////////////////////////////////////////////////
  40          #include "MsDLC.h"      //120413 Modify
  41          #include "drvOSD.h"
  42          
  43          
  44          #if ENABLE_DeltaE
              #include "msAutoGamma_Setting.h"
              extern void drvGammaOnOff(BYTE u8Switch, BYTE u8Window);
              #endif
  48          #define CTEMP_6500K CTEMP_Warm1
  49          #define CTEMP_9300K CTEMP_Cool1
  50          #define CTEMP_7500K CTEMP_Normal
  51          
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 2   

  52          #define UserPrefRedColor6500K UserPrefRedColorWarm1
  53          #define UserPrefGreenColor6500K UserPrefGreenColorWarm1
  54          #define UserPrefBlueColor6500K UserPrefBlueColorWarm1
  55          
  56          #define UserPrefRedColor9300K UserPrefRedColorCool1
  57          #define UserPrefGreenColor9300K UserPrefGreenColorCool1
  58          #define UserPrefBlueColor9300K UserPrefBlueColorCool1
  59          
  60          #define UserPrefRedColor7500K UserPrefRedColorNormal
  61          #define UserPrefGreenColor7500K UserPrefGreenColorNormal
  62          #define UserPrefBlueColor7500K UserPrefBlueColorNormal
  63          
  64          extern Bool SetColor(void);
  65          extern Bool SetColorTemp();
  66          extern Bool CheckFactorySettingOutOfRange(void);
  67          void CheckModeSettingRange();
  68          void Init_FactorySetting(void);
  69          #if ENABLE_HDMI
  70          extern void SetColorBoostWin(BYTE mode);
  71          #else
              extern void SetColorBoostWindow(BYTE mode);
              #endif
  74          #if 0        
              extern Bool AdjustSuperResolution(void);
              #endif
  77          extern Bool xdata bFlashWriteFactory;
  78          
  79          extern WORD CRC16(BYTE nData, WORD nCRC);
  80          
  81          extern void DrawOsdMenu(void);
  82          
  83          #define SIO_ID1     SIORxBuffer[0]
  84          #define SIO_TYPE1   SIORxBuffer[1]
  85          #define SIO_TYPE2   SIORxBuffer[2]
  86          #define SIO_CMD1    SIORxBuffer[3]
  87          #define SIO_CMD2    SIORxBuffer[4]
  88          #define SIO_DATA1   SIORxBuffer[5]
  89          #define SIO_DATA2   SIORxBuffer[6]
  90          #define SIO_DATA3       SIORxBuffer[7]
  91          #define SIOData10   (SIO_DATA1-0x30)*256
  92          #define SIOData11   ((SIO_DATA1-0x41)+10)*256
  93          #define SIOData20   (SIO_DATA2-0x30)*16
  94          #define SIOData21   ((SIO_DATA2-0x41)+10)*16
  95          #define SIOData30   (SIO_DATA3-0x30)
  96          #define SIOData31   (SIO_DATA3-0x41)+10
  97          BYTE AlignControl(void);
  98          #define ASSETSTARTADDR                  0x600
  99          #define ASSETLENGTH                             64
 100          
 101          #if JRY_Color_Tool_Functing
 102          
 103          #define EDID_VGA                              0 
 104          #define EDID_DVI                                   1    
 105          #define EDID_HDMI                             2
 106          #define EDID_DP                             3
 107          
 108          #if JRY_FDDCCI_WriteEDID || WriteSN_Functiom_New
 109          WORD idata edid_cont=0;
 110          BYTE idata edid_pointer=0;
 111          #endif
 112          
 113          #if (ENABLE_HDCP&&JRY_FDDCCI_WriteHDCP)
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 3   

              #define HDCP_L128                               128
              #define HDCP_L33                                33
              WORD idata DDCCI_pointer=0;
              BYTE  idata   DDCCI_cont=0;
              BYTE  idata  Hdcpsave_offset=0 ;
              WORD idata Hdcp_pointer=0;
              WORD idata DDCCi_checksun=0;
              WORD  idata Tchecksun=0;
              WORD idata  checksun_verify=0;
              BYTE  idata Flash_HDCPcont=0;
              #endif
 125          
 126          Bool JRYColorToolControl (void)
 127          {       
 128   1      
 129   1              
 130   1              WhileCounte=5;
 131   1              
 132   1              if(ubAutoAlign==0)
 133   1              {
 134   2                      if((DDCBuffer[3]==0x35)&&(DDCBuffer[4]==0x1f)&&(DDCBuffer[5]==0))//enter align modeè¿›å…¥æ ¡å‡†æ¨¡å¼
 135   2                      {
 136   3                              Set_ATEModeFlag();
 137   3                              Set_FactoryModeFlag();
 138   3                              Set_BurninModeFlag();
 139   3                       #if !USEFLASH
                                      NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                               #else
 142   3                              UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
 143   3                       #endif
 144   3      
 145   3                              MenuPageIndex=RootMenu;
 146   3                              MenuItemIndex=0;  
 147   3                              
 148   3                              ubAutoAlign=1;
 149   3                              
 150   3                              DDCBuffer[0]=0x84;
 151   3                              DDCBuffer[1]=0x00;
 152   3                              DDCBuffer[2]=0x4F;
 153   3                              return 2;
 154   3                      }
 155   2                      else
 156   2                      {
 157   3                              return 0;
 158   3                      }
 159   2              }
 160   1      //å‘é€é¢œè‰²æŒ‡ä»¤
 161   1      if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x13)&&(DDCBuffer[5]==0))//auto color//è‡ªåŠ¨è°ƒæ•´é¢œè‰²       
 162   1      {
 163   2                       if(AutoColor()!=0)
 164   2                       {
 165   3                              DDCBuffer[1]=0x00;
 166   3                              DDCBuffer[2]=0x4F;
 167   3                       }
 168   2                       else
 169   2                       {
 170   3                              DDCBuffer[1]=0x03;
 171   3                              DDCBuffer[2]=0x58;
 172   3                       }      
 173   2                              DDCBuffer[0]=0x84;
 174   2                      
 175   2                              return 2;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 4   

 176   2      }
 177   1      //è®¾ç½®éœ€è¦è‡ªè°ƒçš„è‰²æ¸©
 178   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x14)&&(DDCBuffer[5]==0))//set CT
 179   1      {
 180   2                              SetFactoryColorTempCool1();
 181   2                              
 182   2                              DDCBuffer[0]=0x84;
 183   2                              DDCBuffer[1]=0x00;
 184   2                              DDCBuffer[2]=0x4F;
 185   2                              return 2;
 186   2      }
 187   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x14)&&(DDCBuffer[5]==1))//set CT
 188   1      {
 189   2                              SetFactoryColorTempWarm1();
 190   2                              
 191   2                              DDCBuffer[0]=0x84;
 192   2                              DDCBuffer[1]=0x00;
 193   2                              DDCBuffer[2]=0x4F;
 194   2                              return 2;
 195   2      }
 196   1      
 197   1      #if Adj_7500K_Temp      
              else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x14)&&(DDCBuffer[5]==3))//set CT
              {
                              
                                     SetFactoryColorTempNormal();
                                      
                                      DDCBuffer[0]=0x84;
                                      DDCBuffer[1]=0x00;
                                      DDCBuffer[2]=0x4F;
                                      return 2;
              }
              #endif
 209   1      //è¯»å–è‰²æ¸©RGB
 210   1      else if((DDCBuffer[3]==0x32)&&(DDCBuffer[4]==0x15))//read R gain
 211   1      {
 212   2                              DDCBuffer[0]=0x84;
 213   2                              DDCBuffer[1]=0x00;
 214   2                      if(UserPrefColorTemp==CTEMP_6500K)
 215   2                              DDCBuffer[2]=UserPrefRedColor6500K;//0x4F;
 216   2                      else if(UserPrefColorTemp==CTEMP_9300K)
 217   2                              DDCBuffer[2]=UserPrefRedColor9300K;//0x4F;
 218   2                      #if Adj_7500K_Temp      
                              else if(UserPrefColorTemp==CTEMP_7500K)
                                      DDCBuffer[2]=UserPrefRedColor7500K;//0x4F;
                              #endif
 222   2                      else 
 223   2                              DDCBuffer[2]=UserPrefRedColor;//0x4F;
 224   2                              return 2;
 225   2      }
 226   1      else if((DDCBuffer[3]==0x32)&&(DDCBuffer[4]==0x16))//read G gain
 227   1      {
 228   2                              DDCBuffer[0]=0x84;
 229   2                              DDCBuffer[1]=0x00;
 230   2                      if(UserPrefColorTemp==CTEMP_6500K)
 231   2                              DDCBuffer[2]=UserPrefGreenColor6500K;//0x4F;
 232   2                      else if(UserPrefColorTemp==CTEMP_9300K)
 233   2                              DDCBuffer[2]=UserPrefGreenColor9300K;//0x4F;
 234   2                      #if Adj_7500K_Temp      
                              else if(UserPrefColorTemp==CTEMP_7500K)
                                      DDCBuffer[2]=UserPrefGreenColor7500K;//0x4F;
                              #endif
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 5   

 238   2                      else 
 239   2                              DDCBuffer[2]=UserPrefGreenColor;//0x4F;
 240   2                              return 2;
 241   2      }
 242   1      else if((DDCBuffer[3]==0x32)&&(DDCBuffer[4]==0x17))//read B gain
 243   1      {
 244   2                              DDCBuffer[0]=0x84;
 245   2                              DDCBuffer[1]=0x00;
 246   2                      if(UserPrefColorTemp==CTEMP_6500K)
 247   2                              DDCBuffer[2]=UserPrefBlueColor6500K;//0x4F;
 248   2                      else if(UserPrefColorTemp==CTEMP_9300K)
 249   2                              DDCBuffer[2]=UserPrefBlueColor9300K;//0x4F;
 250   2                      #if Adj_7500K_Temp      
                              else if(UserPrefColorTemp==CTEMP_7500K)
                                      DDCBuffer[2]=UserPrefBlueColor7500K;//0x4F;
                              #endif
 254   2                      else 
 255   2                              DDCBuffer[2]=UserPrefBlueColor;//0x4F;
 256   2                              return 2;
 257   2      }
 258   1      //å†™å…¥è‰²æ¸©RGB
 259   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x15))//write R gain
 260   1      {
 261   2                              BYTE ucR_Gain;
 262   2                              ucR_Gain=DDCBuffer[5];
 263   2                              if((ucR_Gain >= 0) && (ucR_Gain <= 255))
 264   2                              {
 265   3                                      if(UserPrefColorTemp == CTEMP_6500K) 
 266   3                                      {
 267   4                                              UserPrefRedColor6500K=ucR_Gain;
 268   4                                              #if CT_sRGB_ENABLE
                                                      UserPrefRedColorSRGB=ucR_Gain;
                                                      #endif
 271   4                                      }
 272   3                                      else if(UserPrefColorTemp == CTEMP_9300K) 
 273   3                                              UserPrefRedColor9300K=ucR_Gain;
 274   3                                     #if Adj_7500K_Temp       
                                              else if(UserPrefColorTemp == CTEMP_7500K) 
                                                      UserPrefRedColor7500K=ucR_Gain;
                                             #endif
 278   3                                      else if(UserPrefColorTemp == CTEMP_USER) 
 279   3                                              UserPrefRedColor=ucR_Gain;
 280   3                                     mStar_AdjustRedColor(ucR_Gain,UserPrefContrast);
 281   3                                      DDCBuffer[0]=0x84;
 282   3                                      DDCBuffer[1]=0x00;
 283   3                                      DDCBuffer[2]=0x4F;
 284   3                              }
 285   2                              else
 286   2                              {
 287   3                                      DDCBuffer[0]=0x84;
 288   3                                      DDCBuffer[1]=0x03;
 289   3                                      DDCBuffer[2]=0x58;
 290   3                              }
 291   2                              return 2;
 292   2      }
 293   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x16))//write G gain
 294   1      {
 295   2                              BYTE ucG_Gain;
 296   2                              ucG_Gain=DDCBuffer[5];
 297   2                              if((ucG_Gain >= 0) && (ucG_Gain <= 255))
 298   2                              {
 299   3                                      if(UserPrefColorTemp == CTEMP_6500K) 
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 6   

 300   3                                      {
 301   4                                              UserPrefGreenColor6500K=ucG_Gain;
 302   4                                              #if CT_sRGB_ENABLE
                                                      UserPrefGreenColorSRGB=ucG_Gain;
                                                      #endif
 305   4                                      }
 306   3                                      else if(UserPrefColorTemp == CTEMP_9300K) 
 307   3                                              UserPrefGreenColor9300K=ucG_Gain;
 308   3                                      #if Adj_7500K_Temp      
                                              else if(UserPrefColorTemp == CTEMP_7500K) 
                                                      UserPrefGreenColor7500K=ucG_Gain;
                                              #endif
 312   3                                      else if(UserPrefColorTemp == CTEMP_USER) 
 313   3                                              UserPrefGreenColor=ucG_Gain;
 314   3                                     mStar_AdjustGreenColor(ucG_Gain,UserPrefContrast);
 315   3                                      
 316   3                                      
 317   3                                      DDCBuffer[0]=0x84;
 318   3                                      DDCBuffer[1]=0x00;
 319   3                                      DDCBuffer[2]=0x4F;
 320   3                              }
 321   2                              else
 322   2                              {
 323   3                                      DDCBuffer[0]=0x84;
 324   3                                      DDCBuffer[1]=0x03;
 325   3                                      DDCBuffer[2]=0x58;
 326   3                              }
 327   2                              return 2;
 328   2      }
 329   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x17))//write B gain
 330   1      {
 331   2                              BYTE ucB_Gain;
 332   2                              ucB_Gain=DDCBuffer[5];
 333   2                              if((ucB_Gain >= 0) && (ucB_Gain <= 255))
 334   2                              {
 335   3                                      if(UserPrefColorTemp == CTEMP_6500K) 
 336   3                                      {
 337   4                                              UserPrefBlueColor6500K=ucB_Gain;
 338   4                                              #if CT_sRGB_ENABLE
                                                      UserPrefBlueColorSRGB=ucB_Gain;
                                                      #endif
 341   4                                      }
 342   3                                      else if(UserPrefColorTemp == CTEMP_9300K) 
 343   3                                              UserPrefBlueColor9300K=ucB_Gain;
 344   3                                      #if Adj_7500K_Temp      
                                              else if(UserPrefColorTemp == CTEMP_7500K) 
                                                      UserPrefBlueColor7500K=ucB_Gain;
                                              #endif
 348   3                                      else if(UserPrefColorTemp == CTEMP_USER) 
 349   3                                              UserPrefBlueColor=ucB_Gain;
 350   3                                     mStar_AdjustBlueColor(ucB_Gain,UserPrefContrast);
 351   3                                      DDCBuffer[0]=0x84;
 352   3                                      DDCBuffer[1]=0x00;
 353   3                                      DDCBuffer[2]=0x4F;
 354   3                              }
 355   2                              else
 356   2                              {
 357   3                                      DDCBuffer[0]=0x84;
 358   3                                      DDCBuffer[1]=0x03;
 359   3                                      DDCBuffer[2]=0x58;
 360   3                              }
 361   2                              return 2;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 7   

 362   2      }
 363   1      //å­˜å‚¨è‰²æ¸©
 364   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x18)&&(DDCBuffer[5]==0))//save CT
 365   1      {
 366   2                        UserPrefColorTemp=CTEMP_9300K;
 367   2                      
 368   2                              #if USEFLASH
 369   2                              SaveFactorySetting();
 370   2                              #else
                                   //NVRam_WriteByte(NVR_MONITOR_ADDR(MonitorFlag), FactorySetting);  //need check tina
                                      #endif
 373   2                                                                                              
 374   2                               #if USEFLASH
 375   2                            SaveMonitorSetting();
 376   2                           #else      
                                   NVRam_WriteByte(nvrMonitorAddr(ColorTemp), UserPrefColorTemp);
                                      #endif
 379   2                              
 380   2                              DDCBuffer[0]=0x84;
 381   2                              DDCBuffer[1]=0x00;
 382   2                              DDCBuffer[2]=0x4F;
 383   2                              
 384   2                              return 2;
 385   2      }
 386   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x18)&&(DDCBuffer[5]==1))//save CT
 387   1      {
 388   2      
 389   2                      UserPrefColorTemp=CTEMP_6500K;
 390   2                      
 391   2                              #if USEFLASH
 392   2                              SaveFactorySetting();                   
 393   2                              #endif
 394   2                              
 395   2                              #if USEFLASH
 396   2                            SaveMonitorSetting();
 397   2                           #else      
                                   NVRam_WriteByte(nvrMonitorAddr(ColorTemp), UserPrefColorTemp);
                                      #endif
 400   2                              DDCBuffer[0]=0x84;
 401   2                              DDCBuffer[1]=0x00;
 402   2                              DDCBuffer[2]=0x4F;
 403   2                              return 2;
 404   2      }
 405   1      #if  Adj_7500K_Temp     
              else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x18)&&(DDCBuffer[5]==3))//save CT
              {
              
                                      UserPrefColorTemp=CTEMP_7500K;
              
                                      #if USEFLASH
                                      SaveFactorySetting();
                                      #endif
                                              
                                      #if USEFLASH
                                    SaveMonitorSetting();
                                   #else      
                                   NVRam_WriteByte(nvrMonitorAddr(ColorTemp), UserPrefColorTemp);
                                      #endif
                                      DDCBuffer[0]=0x84;
                                      DDCBuffer[1]=0x00;
                                      DDCBuffer[2]=0x4F;
                                      return 2;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 8   

              }
              #endif
 426   1      //è®¾ç½®äº®åº¦å’Œå¯¹æ¯”åº¦é»˜è®¤å€¼
 427   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x19)&&(DDCBuffer[5]==0))//set brightness and contrast defaul
             -t
 428   1      {
 429   2                              UserPrefBrightness=DefBrightness;
 430   2                              UserPrefContrast=DefContrast;
 431   2                              mStar_AdjustBrightness(UserPrefBrightness);
 432   2                              mStar_AdjustContrast( UserPrefContrast );
 433   2                              DDCBuffer[0]=0x84;
 434   2                              DDCBuffer[1]=0x00;
 435   2                              DDCBuffer[2]=0x4F;
 436   2                              return 2;
 437   2      }
 438   1      //è¯»è°ƒæ•´çš„äº®åº¦
 439   1      else if((DDCBuffer[3]==0x32)&&(DDCBuffer[4]==0x1A))//read adjust brightness 
 440   1      {
 441   2                              DDCBuffer[0]=0x84;
 442   2                              DDCBuffer[1]=0x00;
 443   2                              DDCBuffer[2]=UserPrefBrightness;
 444   2                              return 2;
 445   2      }
 446   1      //è¯»è°ƒæ•´çš„å¯¹æ¯”åº¦
 447   1      else if((DDCBuffer[3]==0x32)&&(DDCBuffer[4]==0x1B))//read adjust contrast
 448   1      {
 449   2                  UserPrefContrast=GetScale100Value(UserPrefContrast, MinContrastValue, MaxContrastValue);
 450   2                              DDCBuffer[0]=0x84;
 451   2                              DDCBuffer[1]=0x00;
 452   2                              DDCBuffer[2]=UserPrefContrast;
 453   2                              return 2;
 454   2      }
 455   1      //å†™è°ƒæ•´çš„äº®åº¦
 456   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x1A))//write adjust brightness 
 457   1      {
 458   2                              BYTE uctempData;
 459   2                              uctempData=DDCBuffer[5];
 460   2                              if((uctempData >= 0) && (uctempData <= 100))
 461   2                              {
 462   3                                      UserPrefBrightness=uctempData;
 463   3                                      mStar_AdjustBrightness(UserPrefBrightness);
 464   3                                      DDCBuffer[1]=0x00;
 465   3                                      DDCBuffer[2]=0x4F;
 466   3                              }
 467   2                              else
 468   2                              {
 469   3                                      DDCBuffer[1]=0x03;
 470   3                                      DDCBuffer[2]=0x58;
 471   3                              }
 472   2                              DDCBuffer[0]=0x84;
 473   2                              return 2;
 474   2      }
 475   1      //å†™è°ƒæ•´çš„å¯¹æ¯”åº¦
 476   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x1B))//write adjust contrast
 477   1      {
 478   2                              BYTE uctempData;
 479   2                              uctempData=DDCBuffer[5];
 480   2                              if((uctempData >= 0) && (uctempData <= 100))
 481   2                              {
 482   3                                      UserPrefContrast=uctempData;
 483   3                                      mStar_AdjustContrast(UserPrefContrast);
 484   3                                      
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 9   

 485   3                                      DDCBuffer[1]=0x00;
 486   3                                      DDCBuffer[2]=0x4F;
 487   3                              }
 488   2                              else
 489   2                              {
 490   3                                      DDCBuffer[1]=0x03;
 491   3                                      DDCBuffer[2]=0x58;
 492   3                              }
 493   2                              DDCBuffer[0]=0x84;
 494   2                              return 2;
 495   2      }
 496   1      //è®¾ç½®é»˜è®¤è¯­è¨€æˆ–é€‰æ‹©é‡ç½®è¯­è¨€
 497   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x1C))//set default language or select reset language
 498   1      {
 499   2                              UserPrefLanguage=DefLanguage;
 500   2                              
 501   2                              DDCBuffer[0]=0x84;
 502   2                              DDCBuffer[1]=0x00;
 503   2                              DDCBuffer[2]=0x4F;
 504   2                              return 2;
 505   2      }
 506   1      //è¿›å…¥çƒ§å½•æ¨¡å¼
 507   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x1D)&&(DDCBuffer[5]==0))//enter burn mode
 508   1      {
 509   2                              return 0;
 510   2      }
 511   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x1D)&&(DDCBuffer[5]==1))//exit burn mode
 512   1      {
 513   2                              return 0;
 514   2      }
 515   1      //è¿›å…¥æ ¡å‡†æ¨¡å¼
 516   1      else if((DDCBuffer[3]==0x35)&&(DDCBuffer[4]==0x1F)&&(DDCBuffer[5]==0))//enter align mode
 517   1      {
 518   2                              Set_ATEModeFlag();
 519   2                              Set_FactoryModeFlag();
 520   2                              Set_BurninModeFlag();
 521   2                       #if !USEFLASH
                                  NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                               #else
 524   2                       UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
 525   2                       #endif
 526   2      
 527   2                              DDCBuffer[0]=0x84;
 528   2                              DDCBuffer[1]=0x00;
 529   2                              DDCBuffer[2]=0x4F;
 530   2                              return 2;
 531   2      }
 532   1      //// å·¥åŽ‚æ¨¡å¼å¼€å¯
 533   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x21)&&(DDCBuffer[5]==0))//factory mode on
 534   1      {
 535   2                              DDCBuffer[0]=0x84;
 536   2                              DDCBuffer[1]=0x00;
 537   2                              DDCBuffer[2]=0x4F;
 538   2                              return 2;
 539   2      }
 540   1      //// å·¥åŽ‚æ¨¡å¼å…³é—­
 541   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x21)&&(DDCBuffer[5]==1))//factory mode off
 542   1      {
 543   2                      ubAutoAlign=0;
 544   2                      if(FactoryModeFlag)
 545   2                      {       
 546   3                               #if USEFLASH
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 10  

 547   3                            SaveMonitorSetting();
 548   3                           #else      
                                              NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                                      #endif
 551   3                               MenuPageIndex=RootMenu;
 552   3                               MenuItemIndex=0; 
 553   3                               Osd_Hide();                    
 554   3                               SaveUserPrefSetting(0);
 555   3                              
 556   3                      }
 557   2                      else
 558   2                      {
 559   3                              SaveUserPrefSetting(0);//SaveUserPref();
 560   3                      }
 561   2      }
 562   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x23)&&(DDCBuffer[5]==0))//change source vga
 563   1      {
 564   2                              DDCBuffer[0]=0x84;
 565   2                              DDCBuffer[1]=0x00;
 566   2                              DDCBuffer[2]=0x4F;
 567   2                              return 2;
 568   2      }
 569   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x23)&&(DDCBuffer[5]==1))//change source dvi
 570   1      {
 571   2                              DDCBuffer[0]=0x84;
 572   2                              DDCBuffer[1]=0x00;
 573   2                              DDCBuffer[2]=0x4F;
 574   2                              return 2;
 575   2      }
 576   1      #if WriteSN_Functiom_New
              
                  else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x30))//3DDC³¤¶È
                 {
                                edid_cont=((DDCBuffer[5])*128);
                                 edid_pointer=0;
                                  if((DDCBuffer[5])<3)
                                      {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x00;
                                              DDCBuffer[2]=0x4F;
                                              return 2;
                                      }
                                  else
                                      {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;                               
                                      }
                      }
                      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x31))//3DDC½ÓÊÕ
                              {
                                      BYTE  j,i=0;
                                      j=DDCBuffer[5];
                                      if (edid_pointer<edid_cont)
                                       {
                                       for(i=0;i<j;i++)
                                            {
                                               DDC1[edid_pointer]=DDCBuffer[6+i];
                                               edid_pointer++;
                                            }
                                              DDCBuffer[0]=0x84;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 11  

                                              DDCBuffer[1]=0x00;
                                              DDCBuffer[2]=0x4F;
                                              return 2;
                                       }
                                      else
                                      {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;
                                     }                                
                              }
                       else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x32))   //3ddC Ð£Ñé
                              {
                                       BYTE  checksun=0;
                                       WORD  i;
                                      if ((edid_cont==128)||(edid_cont==256))
                                      {
                                              for(i=0;i<128;i++)
                                              {
                                                      checksun+=DDC1[i];                              
                                              }
                                                      if(checksun==0)
                                                      {
                                                              DDCBuffer[0]=0x84;
                                                              DDCBuffer[1]=0x00;
                                                              DDCBuffer[2]=0x4F;
                                                              return 2;
                                                      }
                                      }
              
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;
              
                              }
                       else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x33))//3ddc±£´æ
                              {
                                       BYTE  checksun;
                                       BYTE  EDID_TYPE=0;
                                         #if USEFLASH
                                       WORD  i;
                                        #endif
              
                                      //Osd_Show();
                                      #if ENABLE_VGA
                                       if(DDCBuffer[5]==0)                            
                                         EDID_TYPE=EDID_VGA;  
                                       #elif ENABLE_DVI
                                       if (DDCBuffer[5]==1)
                                         EDID_TYPE=EDID_DVI;
                                       #elif ENABLE_HDMI
                                       if (DDCBuffer[5]==2)
                                         EDID_TYPE=EDID_HDMI;
                                       #endif
                                      else
                                        {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 12  

                                        }
                                              
                                      #if USEFLASH
              
                                        #if ENABLE_VGA
                                                      Flash_Write_Factory_KeySet(FLASH_KEY_DDCA, FALSE,  DDCAKEY_SIZE, DDC1, DDCAKEY_S
             -IZE);        
                                        #elif ENABLE_DVI
                                                      Flash_Write_Factory_KeySet(FLASH_KEY_DDCD, FALSE,  DDCDKEY_SIZE, DDC1, DDCDKEY_SIZE);   
                                        #elif ENABLE_HDMI
                                                      Flash_Write_Factory_KeySet(FLASH_KEY_DDCH, FALSE,  DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE);
                                        #endif
                                      
                                      checksun=DDC1[0x7F];  //2  Ö»ÐèÐ£Ñé128 ×Ö½Ú
                                      for(i=0;i<edid_cont;i++) DDC1[i]=0;
                                     
                                        #if ENABLE_VGA
                                               Flash_Read_Factory_KeySet(FLASH_KEY_DDCA, TRUE, 0, DDCAKEY_SIZE, DDC1, DDCAKEY_S
             -IZE);
                                        #elif ENABLE_DVI
                                                      Flash_Read_Factory_KeySet(FLASH_KEY_DDCD, TRUE, 0,   DDCDKEY_SIZE, DDC1, DDCDKEY_SIZE); 
                                        #elif ENABLE_HDMI
                                                      Flash_Read_Factory_KeySet(FLASH_KEY_DDCH, TRUE, 0,   DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE); 
                                        #endif
              
                                     #endif     
                                                       
                                           if(DDC1[(0x7F)]==checksun)
                                              {       
              
              
                                              Set_DDCCIReadLoadEDIDFlag();
                                              //SaveMonitorSetting();
                                              WhileCounte=1;
                                              Power_TurnOffLed();             //3ÃðµÆÖ¸Ê¾
                                      
                                                      DDCBuffer[0]=0x84;
                                                      DDCBuffer[1]=0x00;
                                                      DDCBuffer[2]=0x4F;
                                                      return 2;
                                              }
                                            else
                                              {
                                                      DDCBuffer[0]=0x84;
                                                      DDCBuffer[1]=0x03;
                                                      DDCBuffer[2]=0x58;
                                                      return 2;
                                              }
                              }
              //è®¡ç®—é•¿åº¦
              #elif  JRY_FDDCCI_WriteEDID
 720   1          else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x30))//DDCé•¿åº¦
 721   1                      {
 722   2                              #if LoadAllPortSeriealnumberByOneVGAPort        //é€šè¿‡ä¸€ä¸ª VGA ç«¯å£åŠ è½½æ‰€æœ‰ç«¯å£åºåˆ—å·             
 723   2                                      Clr_DDCCOneVGAPortLoadEDIDFlag();               
 724   2                              #endif
 725   2                      
 726   2                        edid_cont=((DDCBuffer[5])*128);
 727   2                         edid_pointer=0;
 728   2                          if((DDCBuffer[5])<3)
 729   2                              {
 730   3                                      DDCBuffer[0]=0x84;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 13  

 731   3                                      DDCBuffer[1]=0x00;
 732   3                                      DDCBuffer[2]=0x4F;
 733   3                                      return 2;
 734   3                              }
 735   2                          else
 736   2                              {
 737   3                                      DDCBuffer[0]=0x84;//é•¿åº¦ä¸º4
 738   3                                      DDCBuffer[1]=0x03;//3ä»£è¡¨get
 739   3                                      DDCBuffer[2]=0x58;
 740   3                                      return 2;                               
 741   3                              }
 742   2                      }
 743   1      
 744   1              else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x31))//DDCæŽ¥æ”¶
 745   1                      {
 746   2                              BYTE  j,i=0;
 747   2                              j=DDCBuffer[5];
 748   2                              if (edid_pointer<edid_cont)
 749   2                               {
 750   3                               for(i=0;i<j;i++)
 751   3                                    {
 752   4                                       DDC1[edid_pointer]=DDCBuffer[6+i];
 753   4                                       edid_pointer++;
 754   4                                    }
 755   3                                      DDCBuffer[0]=0x84;
 756   3                                      DDCBuffer[1]=0x00;
 757   3                                      DDCBuffer[2]=0x4F;
 758   3                                      return 2;
 759   3                               }
 760   2                              else
 761   2                                {
 762   3                                      DDCBuffer[0]=0x84;
 763   3                                      DDCBuffer[1]=0x03;
 764   3                                      DDCBuffer[2]=0x58;
 765   3                                      return 2;
 766   3                               }                              
 767   2                      }
 768   1               else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x32))   //2    ddC æ ¡éªŒ
 769   1                      {
 770   2                               BYTE  checksun=0;
 771   2                               WORD  i;
 772   2                              if ((edid_cont==128)||(edid_cont==256))
 773   2                                      {
 774   3                                      for(i=0;i<edid_cont;i++)
 775   3                                              {
 776   4                                              checksun+=DDC1[i];
 777   4                                              
 778   4                                              }
 779   3                                              if(checksun==0)
 780   3                                                      {
 781   4                                                      DDCBuffer[0]=0x84;
 782   4                                                      DDCBuffer[1]=0x00;
 783   4                                                      DDCBuffer[2]=0x4F;
 784   4                                                      return 2;
 785   4                                                      }
 786   3      
 787   3                                      }
 788   2      
 789   2                                      DDCBuffer[0]=0x84;
 790   2                                      DDCBuffer[1]=0x03;
 791   2                                      DDCBuffer[2]=0x58;
 792   2                                      return 2;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 14  

 793   2      
 794   2                      }
 795   1               else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x33))//DDCä¿å­˜
 796   1                      {
 797   2                               BYTE  checksun;
 798   2                               BYTE  EDID_TYPE=0;
 799   2                                 #if USEFLASH
 800   2                               WORD  i;
 801   2                                #endif
 802   2      
 803   2                              //Osd_Show();
 804   2                              if(DDCBuffer[5]==0)                             
 805   2                                 EDID_TYPE=EDID_VGA;                          
 806   2                              else if (DDCBuffer[5]==1)
 807   2                                 EDID_TYPE=EDID_DVI;
 808   2                              else if (DDCBuffer[5]==2)
 809   2                                 EDID_TYPE=EDID_HDMI;
 810   2                              else if (DDCBuffer[5]==3)
 811   2                                 EDID_TYPE=EDID_DP;                   
 812   2                              #if USEFLASH
 813   2                              
 814   2                                if(EDID_TYPE==EDID_VGA)
 815   2                                      {
 816   3                                              Flash_Write_Factory_KeySet(FLASH_KEY_DDCA, FALSE,  DDCAKEY_SIZE, DDC1, DDCAKEY_S
             -IZE);        
 817   3                                      }
 818   2                           else if (EDID_TYPE==EDID_DVI)
 819   2                                      {
 820   3                                              Flash_Write_Factory_KeySet(FLASH_KEY_DDCD, FALSE,  DDCDKEY_SIZE, DDC1, DDCDKEY_SIZE);           
 821   3                             }
 822   2                              #if ENABLE_HDMI
 823   2                            else if (EDID_TYPE==EDID_HDMI)
 824   2                              {
 825   3                                              Flash_Write_Factory_KeySet(FLASH_KEY_DDCH, FALSE,  DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE);
 826   3                              }
 827   2                              #endif    
 828   2                              #if DP_WRITE_SN
                                        else if (EDID_TYPE==EDID_DP)
                                              {
                                                      Flash_Write_Factory_KeySet(FLASH_KEY_HDCP, FALSE, DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE);    
                                              }
                                      #endif
 834   2                              
 835   2                              checksun=DDC1[edid_cont-1];
 836   2              
 837   2                              for(i=0;i++;i<edid_cont)
 838   2                                      DDC1[i]=0;
 839   2                             
 840   2                              if(EDID_TYPE==EDID_VGA)
 841   2                                      {
 842   3                                       Flash_Read_Factory_KeySet(FLASH_KEY_DDCA, TRUE, 0, DDCAKEY_SIZE, DDC1, DDCAKEY_S
             -IZE);
 843   3                                      }
 844   2                             else if (EDID_TYPE==EDID_DVI)
 845   2                              {
 846   3                                              Flash_Read_Factory_KeySet(FLASH_KEY_DDCD, TRUE, 0,   DDCDKEY_SIZE, DDC1, DDCDKEY_SIZE); 
 847   3                              }
 848   2                              #if ENABLE_HDMI//(!(CHIP_ID == CHIP_TSUM9 || CHIP_ID == CHIP_TSUMF) )
 849   2                                else if (EDID_TYPE==EDID_HDMI)
 850   2                                      {
 851   3                                              Flash_Read_Factory_KeySet(FLASH_KEY_DDCH, TRUE, 0,   DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE); 
 852   3                                      }
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 15  

 853   2                              #endif
 854   2                              #if  0//DP_WRITE_SN
                                        else if (EDID_TYPE==EDID_DP)
                                              {
                                                      Flash_Read_Factory_KeySet(FLASH_KEY_DDCDP, TRUE, 0,   DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE);        
                                              }
                                      #endif
 860   2                              #elif 0//else
                                      
                                               if(EDID_TYPE==EDID_VGA)
                                               NVRam_WriteTbl( RM_MHL_EDID_BASEADDR , DDC1, 128 );
                                               else if (EDID_TYPE==S_EDID_DVI)
                                               NVRam_WriteTbl( RM_MHL_EDID_BASEADDR+128 , DDC1, 128 );
              
                                               checksun=DDC1[edid_cont-1];
                                               DDC1[edid_cont-1]=0;
                                               
                                              if(EDID_TYPE==EDID_VGA)
                                               NVRam_ReadTbl( RM_MHL_EDID_BASEADDR , &DDC1, 128 );
                                              else if (EDID_TYPE==S_EDID_DVI)
                                              NVRam_ReadTbl( RM_MHL_EDID_BASEADDR+128 , &DDC1, 128 );
                                     #endif     
 875   2                                               
 876   2                                   if(DDC1[(edid_cont-1)]==checksun)
 877   2                                      {       
 878   3                                      #if VGA_Write_EEPROM
                                                      if (EDID_TYPE==EDID_VGA)
                                                      {
                                                              Set_Load_VGAEDID_Flag();
                                                      }
                                              #endif
 884   3      
 885   3                                      #if LoadAllPortSeriealnumberByOneVGAPort                         
 886   3                                              if (EDID_TYPE==EDID_VGA)
 887   3                                              {
 888   4                                                      Set_DDCCOneVGAPortLoadEDIDFlag();
 889   4                                              }                                               
 890   3                                      #endif
 891   3                                      
 892   3                                      #if DVI_Write_EEPROM
                                                      if (EDID_TYPE==EDID_DVI)
                                                      {
                                                              Set_Load_DVIEDID_Flag();
                                                      }
                                              #endif
 898   3                                      
 899   3                                      #if HDMI_Write_EEPROM
 900   3                                              if (EDID_TYPE==EDID_HDMI)
 901   3                                              {
 902   4                                                      Set_Load_HDMIEDID_Flag();
 903   4                                                      #if HDMI2_Write_EEPROM
                                                              Set_Load_HDMI2EDID_Flag();
                                                              #endif
 906   4                                              }
 907   3                                      #endif
 908   3      
 909   3                                      Set_DDCCIReadLoadEDIDFlag();
 910   3                                      DDCCILoadEDIDCount=0;
 911   3                                      
 912   3                                              DDCBuffer[0]=0x84;
 913   3                                              DDCBuffer[1]=0x00;
 914   3                                              DDCBuffer[2]=0x4F;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 16  

 915   3                                              return 2;
 916   3                                      }
 917   2                                    else
 918   2                                      {
 919   3                                              DDCBuffer[0]=0x84;
 920   3                                              DDCBuffer[1]=0x03;
 921   3                                              DDCBuffer[2]=0x58;
 922   3                                              return 2;
 923   3                                      }
 924   2                      }
 925   1      #endif
 926   1      
 927   1      #if (ENABLE_HDCP&&JRY_FDDCCI_WriteHDCP)
              #message "please check , dont  have this function"
              #elif 0
                      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x34))//HDCP ³¤¶È
                              {
                                      if((DDCBuffer[5])==6)
                                              {
                                              //µ±Ç°Åú´Î[6]
                                              //·ÖÈýÅú£¬µÚÒ»/¶þÅú128BYTE,
                                              //µÚÈýÅú33YBTE.
                                              //µ±ÎªµÚÒ»Åú´ÎÊ±ÇåÁãÐ£ÑéºÍ¡£
                                              if(DDCBuffer[6]==0)
                                           {            
                                                       DDCCi_checksun=0;
                                               Flash_HDCPcont=0;
                                           }
                                              // 3¸öÅú´Î£¬µÚÒ»´Î´«0£¬µÚ¶þ´Î´«1£¬µÚÈý´Î´«2
                                              Hdcpsave_offset=DDCBuffer[6];
                                              //DDCCI_cont±¾Åú´óÐ¡[7]£»
                                              DDCCI_cont=DDCBuffer[7];
                                              //Hdcp_pointer±¾Åú´ÎµÄOFFSET ÆðÊ¼Î»ÖÃ[8][9]
                                              Hdcp_pointer=DDCBuffer[8];
                                              Hdcp_pointer=Hdcp_pointer<<8;
                                              Hdcp_pointer=Hdcp_pointer|DDCBuffer[9];
                                              //Tchecksun±¾Åú´ÎµÄChecksun
                                              Tchecksun=DDCBuffer[10];
                                              Tchecksun=Tchecksun<<8;
                                              Tchecksun=Tchecksun|DDCBuffer[11];
                                              
                                              DDCCI_pointer=0;
                                              //DDCCI_pointer=0;
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x00;
                                              DDCBuffer[2]=0x4F;
                                              return 2;
                                              }
                                      else
                                              {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;                               
                                              }
                              }
              
                      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x35))//HDCP  ½ÓÊÕ
                              {
                                      BYTE  j,i=0;
                                      j=DDCBuffer[5];
                                      if(DDCCI_pointer<DDCCI_cont)
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 17  

                                              {
                                              //´«4Åú´Î£¬Ã¿Åú´Î32BYTE
                                              for(i=0;i<j;i++)
                                                      {
                                                      
                                                        if(Flash_HDCPcont==0)
                                                      {               
                                                      DDC1[DDCCI_pointer]=DDCBuffer[6+i];
                                                      DDCCi_checksun+=DDC1[DDCCI_pointer];
                                                       }
                                                   else if(Flash_HDCPcont==1)
                                                      {
                                                        DDC1[DDCCI_pointer+128]=DDCBuffer[6+i];
                                                      DDCCi_checksun+=DDC1[DDCCI_pointer+128];
                                                       }
                                                   else if(Flash_HDCPcont==2)
                                                     {   
                                                        DDC1[DDCCI_pointer+256]=DDCBuffer[6+i];
                                                              DDCCi_checksun+=DDC1[DDCCI_pointer+256];
                                                      }
                                               
                                                      DDCCI_pointer++;
                                                      }
                                              if(DDCCI_pointer<=(DDCCI_cont-1))//2<=  ±£Ö¤¿¨ÔÚ×îºóÒ»´Î·¢ËÍÐ£ÑéÂë
                                                      {
              
                                                              DDCBuffer[0]=0x84;
                                                              DDCBuffer[1]=0x00;
                                                              DDCBuffer[2]=0x4F;
                                                              return 2;
                                                      }
                                              else if((DDCCI_pointer==DDCCI_cont)&&(Tchecksun==DDCCi_checksun))
                                                      {
                      //////////////////////////////ÖÁ´Ë->±¾Åú´Î½ÓÊÕÊý¾ÝOK£¬¿ÉÒÔÒÔHdcp_pointerÎªOFFSET ½øÐÐ±£´æ////////////////
             -/////////////////////
                                                              //Flash_Write_Factory_KeySet(FLASH_KEY_HDCP, Hdcp_pointer,  DDCCI_cont, RX_EDID
             -, DDCCI_cont);        
                                                      if(Flash_HDCPcont==2)
                                                              {
                                                              #if USEFLASH    
                                                                     Flash_Write_Factory_KeySet(FLASH_KEY_HDCP, 0, HDCPKEY_SIZE, DDC1, HDCPKE
             -Y_SIZE);        
                                                              #else
                                                                      NVRam_WriteTbl( RM_HDCP_KEY_BASEADDR , DDC1, 128 );
                                                                      NVRam_WriteTbl( RM_HDCP_KEY_BASEADDR+128 , DDC1+128, 128 );
                                                                      NVRam_WriteTbl( RM_HDCP_KEY_BASEADDR+256 , DDC1+256, 33 );      
                                                              #endif
                                                              }
                                                             Flash_HDCPcont++;
                                                     
                                                              DDCBuffer[0]=0x84;
                                                              DDCBuffer[1]=DDCCi_checksun&0xff;
                                                              DDCBuffer[2]=DDCCi_checksun>>8;
                                                              return 2;
                                                      }
                                              else
                                                      {
                                                      DDCBuffer[0]=0x84;
                                                      DDCBuffer[1]=0x03;
                                                      DDCBuffer[2]=0x58;
                                                      return 2;                               
                                                      }
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 18  

              
                                              }               
                                      else
                                              {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;                               
                                              }
                              }
                      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x36))//HDCP Ð£Ñé
                              {
                                WORD  wCount ; 
                             BYTE   i=0;
                              //ÔÚ´Ë´¦¶Ô±£´æµÄÊý¾Ý½øÐÐ¶ÁÈ¡£¬Èç¹ûÐ£ÑéºÍÓë´ËÇ°½ÓÊÕµÄÐ£ÑéºÍÏàµÈÔòOK,·ñÔòNG.
                               checksun_verify=0;
              
                          for(i=0;i<20;i++)
                              DDC1[i]=0;
                           
                               #if USEFLASH   
                                      Flash_Read_Factory_KeySet(FLASH_KEY_HDCP, TRUE, 0, HDCPKEY_SIZE, DDC1, HDCPKEY_SIZE);
                              #else
                                      NVRam_ReadTbl( RM_HDCP_KEY_BASEADDR , &DDC1, 128 );
                                      NVRam_ReadTbl( RM_HDCP_KEY_BASEADDR+128 , &DDC1+128, 128 );
                                      NVRam_ReadTbl( RM_HDCP_KEY_BASEADDR+256 , &DDC1+256, 33 );
                              #endif
                              
                                      for(wCount=0; wCount<289; wCount++)
                                      {
                                              checksun_verify+=DDC1[wCount];
                                      }
              
                                      if(DDCCi_checksun==checksun_verify)
                                              {
                                                  Set_LoadHDCPKeyFlag();
              
                                                      DDCBuffer[0]=0x84;
                                                      DDCBuffer[1]=0x00;
                                                      DDCBuffer[2]=0x4f;
                                                      return 2;
                                              }
                                      else
                                              {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;                               
                                              }
                              }
              #endif
1087   1      
1088   1               else if((DDCBuffer[3]==0x35)&&(DDCBuffer[4]==0x1F)&&(DDCBuffer[5]==1))//exit align mode
1089   1                      {
1090   2                              ubAutoAlign=0;
1091   2      
1092   2                              if(FactoryModeFlag)
1093   2                              {
1094   3                                      Osd_Hide();
1095   3                                      Clr_FactoryModeFlag();  
1096   3                                      MenuPageIndex=RootMenu;
1097   3                              }               
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 19  

1098   2                      #if USEFLASH
1099   2                              SaveMonitorSetting();
1100   2                      #else   
                                      NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                              #endif
1103   2                              DDCBuffer[0]=0x84;
1104   2                              DDCBuffer[1]=0x00;
1105   2                              DDCBuffer[2]=0x4F;
1106   2                              return 2;
1107   2                  }
1108   1      
1109   1      else
1110   1      {
1111   2                              DDCBuffer[0]=0x84;
1112   2                              DDCBuffer[1]=0x03;
1113   2                              DDCBuffer[2]=0x58;
1114   2                              return 2;
1115   2      }
1116   1                      return 2;
1117   1      }
1118          #endif
1119          
1120          #if ENABLE_DP_INPUT     //121130 Modify
              #if DPENABLEMCCS
              BYTE data ucfinal_status,g_ucDDC_TxRecord ;  // use idata to speedup
              WORD data DDC2BI_INT_STS, DDC2BI_R_BUF, DDC2BI_W_BUF, DDC2BI_INT_CLR;
              code BYTE dpNullMsg[3]={0x6e, 0x80, 0xbe};
              static BYTE u8DDC_RxRecord = 0;
              #endif
              #endif
1128          //BYTE u8BackupOutDE_H,u8BackupOutDE_L;
1129          //#endif
1130          
1131          BYTE code MODEL_TYPE[] = 
1132          {
1133              Model
1134          };
1135          
1136          extern  BYTE xdata MenuPageIndex;
1137          extern  BYTE xdata MenuItemIndex;
1138          
1139          #if Enabe_DDCCI_FUNCTION
1140          BYTE code CAP_VCP[]=
1141          {
1142          "("
1143          "vcp(02 04 05 06 08 0E 10 12 14( 04 05 08 0B) 16 18 1A 1E 20 30 3E "
1144          #if 0//AudioFunc
              "62 "
              "8D "
              #endif
1148          #if Dual
1149          "60(01 03) "
1150          #endif
1151          "C8 C9 "
1152          #if Enable_DDCCI_OSDEnable_EN
              "CA "
              #endif
1155          #if 1
1156          "CC(01 02 03 04 05 06 07 09 0A 0B 0D 0E 12 14 16 1E) "
1157          #endif
1158          "B0 B6 D6 DF F8)"
1159          "prot(monitor)"
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 20  

1160          "type(LCD)"
1161          "cmds(01 02 03 07 0C F3)"
1162          "mccs_ver(2.1)"
1163          "asset_eep(64)"
1164          "mpu_ver("FWVersion")"
1165          "model("Model")"
1166          "mswhql(1)"
1167          ")"
1168          };
1169          #if Dual
1170          BYTE code DVI_CAP_VCP[]=
1171          {
1172          "("
1173          "vcp(02 04 05 08 10 12 14( 04 05 08 0B) 16 18 1A 60(01 03)"
1174          #if AudioFunc
1175          "62 "
1176          "8D "
1177          #endif
1178          #if Dual
1179          "60(01 03) "
1180          #endif
1181          " C8 C9 "
1182          #if 1
1183          "CC(01 02 03 04 05 06 07 09 0A 0B 0D 0E 12 14 16 1E) "
1184          #endif
1185          "B0 B6 D6 DF "
1186          #if ENABLE_FREESYNC
              "ED "
              #endif
1189          #if Enable_DDCCI_OSDEnable_EN
              "CA "
              #endif
1192          "F8)"
1193          "prot(monitor)"
1194          "type(LCD)"
1195          "cmds(01 02 03 07 0C F3)"
1196          "mccs_ver(2.1)"
1197          "asset_eep(64)"
1198          "mpu_ver("FWVersion")"
1199          "model("Model")"
1200          "mswhql(1)"
1201          ")"
1202          };
1203          #endif
1204          #else
              BYTE code CAP_VCP[]=
              {
              "6C 6E 70 C8 C9 "
              };
              #if Dual
              BYTE code DVI_CAP_VCP[]=
              {
              "6C 6E 70 C8 C9 "
              };
              #endif
              #endif
1216          
1217          void DDC2Bi_InitRx(void)
1218          {
1219   1          rxStatus = DDC2B_CLEAR;
1220   1          rxIndex = 0;
1221   1      }
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 21  

1222          void DDC2Bi_Init( void )
1223          {
1224   1          drvDDC2Bi_Init();
1225   1      }
1226          void DDC2Bi_GetTxBuffer( void )
1227          {
1228   1          BYTE i;
1229   1          for( i = MAX_TXWAIT_DELAY; i > 0; i-- )
1230   1              if( txStatus == DDC2B_MSGON )
1231   1              {
1232   2                  Delay1ms( 1 );
1233   2              }
1234   1          txStatus = DDC2B_CLEAR;
1235   1      }
1236          BYTE DDC2Bi_ComputeChecksum( BYTE count )
1237          {
1238   1          BYTE CheckSum;
1239   1          BYTE i = 0;
1240   1          CheckSum = INITTxCK;
1241   1          for( ; count > 0; count-- )
1242   1              CheckSum ^= DDCBuffer[i++];
1243   1          return CheckSum;
1244   1      }
1245          void DDC2Bi_MessageReady( void )
1246          {
1247   1          drvDDC2Bi_MessageReady();
1248   1      }
1249          //è§£æžå‘½ä»¤
1250          void DDC2Bi_ParseCommand( void )
1251          {
1252   1          drvDDC2Bi_ParseCommand();
1253   1      }
1254          void DDC2Bi_CommandHandler( void )
1255          {
1256   1          if( rxStatus == DDC2B_COMPLETED )//å¦‚æžœæŽ¥å—å®Œæˆ
1257   1          {
1258   2              DDC2Bi_ParseCommand();//è§£æžå‘½ä»¤
1259   2              Clr_RxBusyFlag();//æ¸…é™¤æŽ¥å—å¿™ç¢Œæ ‡å¿—ä½
1260   2              DDC2Bi_InitRx();//åˆå§‹åŒ–
1261   2          }
1262   1      }
1263          void DoDDCCI( BYTE Source ) // Annie 2006.7.5
1264          {
1265   1          drvDoDDCCI(Source);
1266   1      }
1267          void ISR_DDC2Bi(void)
1268          {//åˆ¤æ–­ç«¯å£ç±»åž‹
1269   1      #if CHIP_ID == CHIP_TSUMC || CHIP_ID == CHIP_TSUMD||CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSUMF
1270   1          if( ADC_INT_FLAG &( BIT3 | BIT4 ) )//ADCæ•°æ®è¯»å†™ä¸­æ–­æ ‡å¿—ä½
1271   1          {
1272   2              DoDDCCI( InputCombo_A0 );//DDC/CIå¤„ç†å‡½æ•°
1273   2              CLR_ADC_INT_FLAG();//æ¸…ç©ºæ ‡å¿—ä½
1274   2          }
1275   1        #if DDC_Port_D0
1276   1          else if( DDCDVI0_INT_FLAG &( BIT3 | BIT4 ) )
1277   1          {
1278   2              DoDDCCI( InputCombo_D0 );
1279   2              CLR_DVI0_INT_FLAG();
1280   2          }
1281   1        #endif
1282   1        #if DDC_Port_D1
                  else if( DDCDVI1_INT_FLAG &( BIT3 | BIT4 ) )
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 22  

                  {
                      DoDDCCI( InputCombo_D1 );
                      CLR_DVI1_INT_FLAG();
                  }
                #endif
1289   1        #if DDC_Port_D2
                  else if( DDCDVI2_INT_FLAG &( BIT3 | BIT4 ) )
                  {
                      DoDDCCI( InputCombo_D2 );
                      CLR_DVI2_INT_FLAG();
                  }
                #endif
1296   1      
1297   1      #else // CHIP_ID != CHIP_TSUMC
                  if( ADC_INT_FLAG &( BIT3 | BIT4 ) )
                  {
                      DoDDCCI( Input_VGA );
                      CLR_ADC_INT_FLAG();
                  }
                #if INPUT_TYPE!=INPUT_1A
                  else if( DDCDVI_INT_FLAG &( BIT3 | BIT4 ) )
                  {
                      DoDDCCI( Input_Digital );
                      CLR_DVI_INT_FLAG();
                  }
                #endif
                #if ENABLE_HDMI
                  else if( DDCHDMI_INT_FLAG & ( BIT3 | BIT4 ) )
                  {
                      DoDDCCI( Input_HDMI );
                      CLR_HDMI_INT_FLAG();
                  }
                #endif
              #endif // #if CHIP_ID == CHIP_TSUMC
1318   1      }
1319          
1320          
1321          #if  ENABLE_DP_INPUT    //121130 Modify
              #if  DPENABLEMCCS
              //================= DP =====================
              #if CHIP_ID == CHIP_TSUMC || CHIP_ID == CHIP_TSUMD//130607 xiandi
              void DDC2BI_DP(void)
              {
              
                  BYTE u8AUXCH_RxCmd;
                  BYTE u8DDC_Length;
                  #define u8DDC_RxOnGoing u8DDC_RxRecord
              
                  u8AUXCH_RxCmd = (msRegs[REG_0638 + Aux])&0x0F;
                  u8DDC_Length = msRegs[REG_063A+ Aux];
                  //===============//<write>PC Read Command============================
                   if(u8AUXCH_RxCmd & _BIT0)    //DP Tx
                  {
              
                      if (u8DDC_Length)
                      {
                          if(rxStatus == DDC2B_CLEAR && txLength)
                          {
                              while(u8DDC_Length-- && txLength)
                              {
                                  if(g_ucDDC_TxRecord)
                                  {
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 23  

                                      msRegs[REG_06D3 + Aux]=DDCBuffer[g_ucDDC_TxRecord-1];
                                      txLength--;
                                  }
                                  else
                                      msRegs[REG_06D3 + Aux]=DDC2B_DEST_ADDRESS;
              
                                      g_ucDDC_TxRecord++;
                              }
                          }
                          else
                          {
                              while(u8DDC_Length--)
                              {
                                   msRegs[REG_06D3 + Aux]= dpNullMsg[g_ucDDC_TxRecord++];
                              }
                          }
                      }
              
                  }
                  //===============//<write>PC Write Command============================
                  else if(u8AUXCH_RxCmd==0x00 || u8AUXCH_RxCmd==0x04)    //DP Rx
                                 {
                          if (u8DDC_Length)
                          {
                              if (!u8DDC_RxOnGoing)
                              {
                                  BYTE xdata temp;
                                  msRegs[REG_06FC + Aux]= msRegs[REG_06FC + Aux]|_BIT2;
                                  temp=msRegs[REG_0675 + Aux];
                                  rxIndex=0;
                                  u8DDC_RxOnGoing=TRUE;
                                  u8DDC_Length--;
                              }
                              while(u8DDC_Length--)
                              {
                                   BYTE xdata temp1=10;
                                      msRegs[REG_06FC + Aux]= msRegs[REG_06FC + Aux]|_BIT2;
                                      while(temp1--){};
                                      temp1=10;
                                      DDCBuffer[rxIndex++] = msRegs[REG_0675 + Aux];
                              }
                          }
              
                          if (u8AUXCH_RxCmd==0x00)
                          {
                              u8DDC_RxOnGoing=FALSE;
                              g_ucDDC_TxRecord=0;
                              rxStatus = DDC2B_COMPLETED;
                              txLength=0;
                          }
              
                  }
                          msRegs[REG_0679 + Aux]= msRegs[REG_0679 + Aux]|_BIT7;//Clear Interrupt
                          msRegs[REG_0679 + Aux]= 0x00;
              
                  #undef u8DDC_RxOnGoing
              
              
              }
              void msDP_DDC2BI(void)
              {
                   if(msRegs[REG_0678 + Aux]&_BIT7)   //MCCS Interrupt
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 24  

                  {
                      DDC2BI_DP() ;
                  }
              }
              #elif CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSUMF
              //================= DP =====================
              
              void DDC2BI_DP(void)     //Rockman
              {
              
                      BYTE u8AUXCH_RxCmd;
                      BYTE u8DDC_Length;
                      #define u8DDC_RxOnGoing u8DDC_RxRecord
                 
                      u8AUXCH_RxCmd = (msRegs[REG_0638 + Aux])&0x0F;
                      u8DDC_Length = msRegs[REG_063A+ Aux];
                      //===============//<write>PC Read Command============================
                       if(u8AUXCH_RxCmd & _BIT0)    //DP Tx
                      {
              
                          if (u8DDC_Length)
                          {   
                              
                              if(rxStatus == DDC2B_CLEAR && txLength)
                              {
                                  while(u8DDC_Length-- && txLength)
                                  {
                                      if(g_ucDDC_TxRecord)
                                      {
                                          msRegs[REG_06F3]=DDCBuffer[g_ucDDC_TxRecord-1];
                                          //msRegs[REG_06F3]= test[g_ucDDC_TxRecord-1];
                                          txLength--;
                                      }
                                      else
                                          msRegs[REG_06F3] =DDC2B_DEST_ADDRESS;
              
                                          msRegs[REG_06F2 ] = BIT0;
                                          while( ! (((msRegs[REG_06F2])&BIT2)))               // Wait
                                        {}
                                        msRegs[REG_06F1 ] = BIT1;                                    // Clear   
                                       g_ucDDC_TxRecord++;
                                  }
                              }
                              else
                              {
                                  while(u8DDC_Length--)
                                  {
                                       msRegs[REG_06F3]= dpNullMsg[g_ucDDC_TxRecord++];
                                       msRegs[REG_06F2 ] = BIT0;
                                          while( ! (((msRegs[REG_06F2])&BIT2)))               // Wait
                                        {}
                                        msRegs[REG_06F1 ] = BIT1;                                    // Clear   
              
                                        
                                  }
                              }
                          }
              
                      }
                      //===============//<write>PC Write Command============================
                      else if(u8AUXCH_RxCmd==0x00 || u8AUXCH_RxCmd==0x04)    //DP Rx
                                     {
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 25  

                              if (u8DDC_Length)
                              {
                                  if (!u8DDC_RxOnGoing)
                                  {
                                      BYTE xdata temp;
                                      msRegs[REG_06F0]= msRegs[REG_06F0]|_BIT0;
                                       while( ! (((msRegs[REG_06F0])&BIT2)))          // Wait
                                        {}
                                       msRegs[REG_06F0 ] = BIT1;                                     // Clear
                                      temp=msRegs[REG_0675];
                                      rxIndex=0;
                                      u8DDC_RxOnGoing=TRUE;
                                      u8DDC_Length--;
                                  }
                                  while(u8DDC_Length--)
                                  {
                                       BYTE xdata temp1=10;
                                          msRegs[REG_06F0]= msRegs[REG_06F0]|_BIT0;
                                          while( ! (((msRegs[REG_06F0])&BIT2)))               // Wait
                                           {}
                                           msRegs[REG_06F0 ] = BIT1;  
                                          DDCBuffer[rxIndex++] = msRegs[REG_0675];
                                          //DDCData[rxIndex++] = msRegs[REG_0675];
                                  }
                              }
              
                              if (u8AUXCH_RxCmd==0x00)
                              {
                                  u8DDC_RxOnGoing=FALSE;
                                  g_ucDDC_TxRecord=0;
                                  rxStatus = DDC2B_COMPLETED;
                                  txLength=0;
                              }
              
                      }
                              msRegs[REG_0679 + Aux]= msRegs[REG_0679 + Aux]|_BIT7;//Clear Interrupt
                              msRegs[REG_0679 + Aux]= 0x00;
              
                      #undef u8DDC_RxOnGoing
              
              
              }
              
              void msDP_DDC2BI(void)
              {
                   if(msRegs[REG_0678 + Aux]&_BIT7)   //MCCS Interrupt
                  {
                      DDC2BI_DP() ;
                  }
              }
              
              
              #else
              void DDC2BI_DP(void)
              {
              
                      BYTE u8AUXCH_RxCmd;
                      BYTE u8DDC_Length;
                      #define u8DDC_RxOnGoing u8DDC_RxRecord
              
                      u8AUXCH_RxCmd = msRegs[REG_1FF4];
                      u8DDC_Length = msRegs[REG_1FF6];
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 26  

                      //===============//<write>PC Read Command============================
                       if(u8AUXCH_RxCmd & _BIT4)    //DP Tx
                      {
                          if (u8DDC_Length)
                          {
                              if(rxStatus == DDC2B_CLEAR && txLength)
                              {
                                  while(u8DDC_Length-- && txLength)
                                  {
                                      if(g_ucDDC_TxRecord)
                                      {
                                          msRegs[REG_1FF9]=DDCBuffer[g_ucDDC_TxRecord-1];
                                          txLength--;
                                      }
                                      else
                                          msRegs[REG_1FF9]=DDC2B_DEST_ADDRESS;
                                          g_ucDDC_TxRecord++;
                                  }
                              }
                              else
                              {
                                  while(u8DDC_Length--)
                                  {
                                      msRegs[REG_1FF9]= dpNullMsg[g_ucDDC_TxRecord++];
                                  }
                              }
                          }
                      }
                       
                      //===============//<write>PC Read Command============================
                      else if(u8AUXCH_RxCmd==0x00 || u8AUXCH_RxCmd==0x40)    //DP Rx
                      {
                              if (u8DDC_Length)
                              {
                                  if (!u8DDC_RxOnGoing)
                                  {
                                      BYTE xdata temp;
                                      msRegs[REG_1FFA]= msRegs[REG_1FFA]|_BIT2;
                                      temp=msRegs[REG_1FF8];
                                      rxIndex=0;
                                      u8DDC_RxOnGoing=TRUE;
                                      u8DDC_Length--;
                                  }
                                  while(u8DDC_Length--)
                                  {
                                       BYTE xdata temp1=10;
                                      msRegs[REG_1FFA]= msRegs[REG_1FFA]|_BIT2;
                                          while(temp1--){};
                                          temp1=10;
                                      DDCBuffer[rxIndex++] = msRegs[REG_1FF8];
                                          //DDCBuffer_Temp[rxIndex++]= msRegs[REG_1FF8];
                                  }
                              }
              
                              if (u8AUXCH_RxCmd==0x00)
                              {
                                  u8DDC_RxOnGoing=FALSE;
                                  g_ucDDC_TxRecord=0;
                                  rxStatus = DDC2B_COMPLETED;
                                  txLength=0;
                              }
              
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 27  

                      }
                              msRegs[REG_1FEA]=msRegs[REG_1FEA]|_BIT7;//Clear Interrupt
                              msRegs[REG_1FFA]= 0x00;
              
                      #undef u8DDC_RxOnGoing
              
              
              }
              void msDP_DDC2BI(void)
              {
                  if(msRegs[REG_1FE6]&_BIT7)   //MCCS Interrupt
                  {
                      DDC2BI_DP() ;
                              
                  }
              }
              #endif
              #endif
              #endif
1613          #if ENABLE_DeltaE
              
              /////////////////////////////////////////////////////////////////////
              // 
              // AUTO-GAMMA
              /////////////////////////////////////////////////////////////////////
              ////Auto-Gamma Varible Declaration///////////
              BYTE BackupOutDE_L; 
              BYTE BackupOutDE_H; 
              BYTE g_CheckSumResult;
              CSTransferSettingType xdata g_CS_Setting[2];
              BYTE xdata bToolWriteGamma=0;
              
              WORD xdata u16ChkSum_Addr = 0;
              code BYTE* tAllFGamma3x3Matrix[2] =
              {
                   g_CS_Setting[0].CM,  
                   g_CS_Setting[1].CM,  
              };
              
              code BYTE tSRGB_CM[18] = { 0xfb, 0x03, 0x12, 0x00, 0xdf, 0x1f,
                                                                 0xfa, 0x1f, 0xd0, 0x03, 0x30, 0x00,
                                                                 0x05, 0x00, 0x53, 0x00, 0xa7, 0x03,};
              
              code BYTE tAdobe_CM[18] = {0x62,0x03,0x0B,0x00,0x08,0x00,0x16,0x00,0x39,0x03,0x10,0x00,0x0D,0x00,
                                                            0x02,0x00,0xF0,0x03,};
              
              
               void msWriteFGammaTbl(BOOL bWindow)
              {
              #if ENABLE_USE_NewDeltaE
               XDATA BYTE ucTrigger,j ;
                  //XDATA BYTE wLevel;
                  XDATA WORD wData[2],k;
                  XDATA BYTE i;
                  XDATA BYTE ucBank, *ucTab1;
                  ucBank = scReadByte( 0 );
                  msWriteByte(SC0_00, 0x0E);
                  if(bWindow)
                      msWriteBit(SCE_22, 0, _BIT0);
                  else
                      msWriteBit(SCE_02, 0, _BIT0);
              
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 28  

                      for(j = 0 ; j < 3; j++)
                      {
                              ucTab1 = tAllFrontEndGammaTab[0];
                              if(j == 0)      // R
                                  ucTrigger = 0;
                              else if(j == 1) // G
                                  ucTrigger = _BIT2;
                              else if(j == 2) // B
                                  ucTrigger = _BIT3;
                              else if(j == 3) // R/G/B
                                  ucTrigger = _BIT2|_BIT3;
              
                              msWrite2Byte(SCE_C0, 0x00);//LUT table R/W address
                              msWriteByteMask(SCE_C2, _BIT1|_BIT0|ucTrigger , _BIT0|_BIT1|_BIT2|_BIT3); // wrtie enable, ise burst wri
             -te
                              msWriteByteMask(SCE_C2, 0 , BIT4);
                      /*
                              // From level 0 ~ 255
                              for( i = 0;i <128; i++ )
                              {
                              // Cal data
                                      for( wLevel =0;wLevel<2;wLevel++)
                                      {
                                              if(wLevel ==1)
                                                  wData = (((WORD)ucTab1[i*3+2]) <<4 |((ucTab1[i*3]&0xF0)>>4));
                                              else
                                                  wData = (((WORD)ucTab1[i*3+1]) <<4 |(ucTab1[i*3]&0x0F));
                                              // Write gamma data;
                                              printData(" %x  ", wData);
                                              scWrite2Byte(SCE_C4, wData);//msWriteWord( SCE_C5, wData ); //scWriteWord(SCE_C5, wData);
                                      }
                              }
                      */
                      for( k = 0;k <384; k=k+3 )
                      {
                          wData[0] = ucTab1[k] | ((ucTab1[k+2]&0x0F)<<8) ;
                          wData[1] = ucTab1[k+1] | ((ucTab1[k+2]&0xF0)<<4) ;
              
                          for(i = 0; i < 2 ; i++)
                          {
                              //printData(" %x  ", wData[i]);
                              msWrite2Byte(SCE_C4, wData[i]);
                          }
                      }
              
              
                          msWriteByteMask(SCE_C2, 0x00, BIT1 | BIT0); //msWriteByteMask(SC25_F0, 0x00, 0xC0);
                      }
                  scWriteByte( 0, ucBank );
              #else
                  XDATA BYTE ucTrigger,j ;
                  //XDATA BYTE wLevel;
                  XDATA WORD wData[2],k;
                  XDATA BYTE i;
                  XDATA BYTE  *ucTab1;
              
                  if(bWindow)
                      msWriteByteMask(SCE_22, 0, _BIT0);
                  else
                      msWriteByteMask(SCE_02, 0, _BIT0);
              
                      for(j = 0 ; j < 3; j++)
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 29  

                      {
                              ucTab1 = tAllFrontEndGammaTab[0];
                              if(j == 0)      // R
                                  ucTrigger = 0;
                              else if(j == 1) // G
                                  ucTrigger = _BIT2;
                              else if(j == 2) // B
                                  ucTrigger = _BIT3;
                              else if(j == 3) // R/G/B
                                  ucTrigger = _BIT2|_BIT3;
              
                              msWrite2Byte(SCE_C0, 0x00);//LUT table R/W address
                              msWriteByteMask(SCE_C2, _BIT1|_BIT0|ucTrigger , _BIT0|_BIT1|_BIT2|_BIT3); // wrtie enable, ise burst wri
             -te
                              msWriteByteMask(SCE_C2, 0 , BIT4);
                    
                      for( k = 0;k <384; k=k+3 )
                      {
                          wData[0] = (WORD)ucTab1[k] | ((WORD)(ucTab1[k+2]&0x0F)<<8) ;
                          wData[1] = (WORD)ucTab1[k+1] | ((WORD)(ucTab1[k+2]&0xF0)<<4) ;
                          for(i = 0; i < 2 ; i++)
                          {
                              //printData(" %x  ", wData[i]);
                              msWrite2Byte(SCE_C4, wData[i]);
                          }
                      }        
                          msWriteByteMask(SCE_C2, 0x00, BIT1 | BIT0); //msWriteByteMask(SC25_F0, 0x00, 0xC0);
                      }
              #endif
              }
              
              void msWriteFixGammaTbl(BOOL bWindow)
              {
              #if ENABLE_USE_NewDeltaE
                XDATA BYTE ucTrigger,j,i ;
                  XDATA WORD wData[2],k;
                  XDATA BYTE ucBank, *ucTab1;
                  ucBank = scReadByte( 0 );
                  msWriteByte(SC0_00, 0x0E);
                  if(bWindow)
                      msWriteBit(SCE_22, 0, _BIT2);
                  else
                      msWriteBit(SCE_02, 0, _BIT2);
              
                      for(j = 0 ; j < 3; j++)
                      {
                              ucTab1 = tAllxvYccFixGammaTab[0];
                              if(j == 0)      // R
                                  ucTrigger = 0;
                              else if(j == 1) // G
                                  ucTrigger = _BIT2;
                              else if(j == 2) // B
                                  ucTrigger = _BIT3;
                              else if(j == 3) // R/G/B
                                  ucTrigger = _BIT2|_BIT3;
              
                              msWrite2Byte(SCE_E0, 0x00);//LUT table R/W address
                              msWriteByteMask(SCE_E2, _BIT1|_BIT0|ucTrigger , _BIT0|_BIT1|_BIT2|_BIT3); // wrtie enable, ise burst wri
             -te
                              msWriteByteMask(SCE_E2, 0 , BIT4);
                      /*
                      for( k = 0;k <512; k=k+2 )
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 30  

                      {
                          wData = (WORD)(ucTab1[k+1] << 8)| ucTab1[k] ;
                          //printData(" %x  ", wData);
                          scWrite2Byte(SCE_E4, wData);
                      }
                      */
                      for( k = 0;k <384; k=k+3 )
                      {
                          wData[0] = ucTab1[k] | ((ucTab1[k+2]&0x0F)<<8) ;
                          wData[1] = ucTab1[k+1] | ((ucTab1[k+2]&0xF0)<<4) ;
              
                          for(i = 0; i < 2 ; i++)
                          {
                              //printData(" %x  ", wData[i]);
                              msWrite2Byte(SCE_E4, wData[i]);
                          }
                      }
                          msWriteByteMask(SCE_E2, 0x00, BIT1 | BIT0); //msWriteByteMask(SC25_F0, 0x00, 0xC0);
                      }
                  scWriteByte( 0, ucBank );
              #else
                  XDATA BYTE ucTrigger,j,i ;
                  XDATA WORD wData[2],k;
                  XDATA BYTE  *ucTab1; 
              
                  if(bWindow)
                      msWriteByteMask(SCE_22, 0, _BIT2);
                  else
                      msWriteByteMask(SCE_02, 0, _BIT2);
              
                      for(j = 0 ; j < 3; j++)
                      {
                              ucTab1 = tAllxvYccFixGammaTab[0];
                              if(j == 0)      // R
                                  ucTrigger = 0;
                              else if(j == 1) // G
                                  ucTrigger = _BIT2;
                              else if(j == 2) // B
                                  ucTrigger = _BIT3;
                              else if(j == 3) // R/G/B
                                  ucTrigger = _BIT2|_BIT3;
              
                              msWrite2Byte(SCE_E0, 0x00);//LUT table R/W address
                              msWriteByteMask(SCE_E2, _BIT1|_BIT0|ucTrigger , _BIT0|_BIT1|_BIT2|_BIT3); // wrtie enable, ise burst wri
             -te
                              msWriteByteMask(SCE_E2, 0 , BIT4);
              
                      for( k = 0;k <384; k=k+3 )
                      {
                          wData[0] = (WORD)ucTab1[k] | ((WORD)(ucTab1[k+2]&0x0F)<<8) ;
                          wData[1] = (WORD)ucTab1[k+1] | ((WORD)(ucTab1[k+2]&0xF0)<<4) ;
                          //wData[0] = 0;
                           //wData[1] = 0;
                          for(i = 0; i < 2 ; i++)
                          {
                              //printData(" %x  ", wData[i]);
                              msWrite2Byte(SCE_E4, wData[i]);
                          }
                      }
                          msWriteByteMask(SCE_E2, 0x00, BIT1 | BIT0); //msWriteByteMask(SC25_F0, 0x00, 0xC0);
              
                      }
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 31  

              #endif
              }
              
              void msWriteFGammaCM(BYTE bWindow, BYTE idxGamma)
              {
                  XDATA BYTE idx;
                  XDATA WORD ucAddr;
                  XDATA BYTE* pcTab;
              
                  if( bWindow == 0 )
                  {
                      ucAddr = SCE_04 ;
                  }
                  else
                  {
                      ucAddr = SCE_24;
                  }
              
                  pcTab =  tAllFGamma3x3Matrix[idxGamma];
              
                  for (idx = 0; idx < 18; idx++)
                      {
                      msWriteByte( ucAddr + idx, pcTab[idx]);
                       //printData("w-cm %x  ", pcTab[idx]);  
                  }
                  
              }
              
              void LoadPostGamma(BYTE GmaTblSize)
              {
                  XDATA WORD i, BaseAddr,  GammaTbl[4], DiffValue0, DiffValue1 ,SumValue , wRGBGamAddStart = 0 ;
                  XDATA BYTE NvrValue, j , ucTrigger, ChannelIndex = 0;
              
                  //BaseAddr = AddrOfPostGamma;
                  BaseAddr = BGammaTblAddr;
                  msWrite2Byte(SC8_20, 0x00);
                  msWriteByteMask( SC8_22, 0x03,BIT1|BIT0);// Main Window
               
                  for(ChannelIndex= 0 ; ChannelIndex < 3;ChannelIndex++)
                  {
                      switch(ChannelIndex){
                           case 0:{ucTrigger = 0;}break;
                           case 1:{ucTrigger = _BIT2;}break;
                           case 2:{ucTrigger =_BIT3;}break;
                      }              
                       wRGBGamAddStart = (WORD)GmaTblSize * ChannelIndex ;
                       msWriteByteMask( SC8_22, ucTrigger , BIT2|BIT3);
              
                       for(j=0; j<4; j++)
                          GammaTbl[j] = 0;
              
                       SumValue = 0;
              
                       for (i=0; i < GmaTblSize; i++)
                       {   
                           NvrValue = 0;
                           NVRam_ReadByte(BaseAddr + wRGBGamAddStart + i, &NvrValue);   
                                       
                          DiffValue1 = NvrValue & 0x0F;       
                          DiffValue0 = (NvrValue & 0xF0) >>4;
                          if(i==0)
                              GammaTbl[0] = 0;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 32  

                          else
                          {
                              GammaTbl[0] = GammaTbl[3] ;       
                              GammaTbl[0] = GammaTbl[0] + DiffValue0 ; 
                          }
                          GammaTbl[1] = GammaTbl[0] + DiffValue0 ;  
                          GammaTbl[2] = GammaTbl[1] + DiffValue1 ;
                          GammaTbl[3] = GammaTbl[2] + DiffValue1 ;
                          for(j=0; j<4; j++)
                          {
                              if(GammaTbl[j] > 1023)
                                  GammaTbl[j] = 1023;
                              //printData(" GammaTbl=  %x", GammaTbl[j]);
                             msWrite2Byte(SC8_24, GammaTbl[j]);
                          }
                         
                      }
                  }
                  msWriteByteMask( SC8_22, 0, BIT1 | BIT0 );
              }
              
              #if 0
              void ReadSrgbDefaultValue(int CMIndex)//Hans120316
              {
                  XDATA BYTE j,idx,chkSum =0 ;
              
                      for(j=0;j<18;j++)
                      {
                          if(CMIndex == 0)
                          {
                              g_CS_Setting[0].CM[j] = tSRGB_CM[j];
                              chkSum ^= tSRGB_CM[j];
                          }
                          else
                          {
                              g_CS_Setting[1].CM[j] = tAdobe_CM[j];
                              chkSum ^= tAdobe_CM[j];
                          }
                      }
              
                  //if(CMIndex)
                  //    NVRam_WriteByte(RM_COLORSPACE_TRANS_ChkSum_ADDR+1, chkSum);
                  //else
                  //    NVRam_WriteByte(RM_COLORSPACE_TRANS_ChkSum_ADDR, chkSum);
              
                  for(idx = 0 ; idx < 18 ;idx++)
                    NVRam_WriteByte( (RM_COLORSPACE_TRANS_BASEADDR + idx) + (sizeof(CSTransferSettingType)*CMIndex), g_C
             -S_Setting[CMIndex].CM[idx]  );
              
              }
              #endif
              
              void LoadDeltaEColorMode(BOOL bWindow, BYTE ModeIndex, BOOL Enable)//Hans 120223 need modify
              {
                  XDATA BYTE idx; 
                  msWriteByteMask(SCE_02,  0, _BIT2|_BIT1 | _BIT0);  // fix-gamma/color-matrix/de-gamma disable.
                  msWriteByteMask(SC8_3F, 0, _BIT7); 
                  
                  // disable noise masking
                  msWriteByte(SC7_D0, 0);
                  msWriteByte(SC7_D2, 0);
                  
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 33  

                  if(Enable)
                  {
                      //DeGamma
                      msWriteFGammaTbl(bWindow);
                      //Color Matrix
                      for(idx = 0 ; idx < 18 ;idx++)
                          {
                            NVRam_ReadByte((RM_COLORSPACE_TRANS_BASEADDR + idx)+ (sizeof(CSTransferSettingType)*ModeInde
             -x), &g_CS_Setting[ModeIndex].CM[idx]);
                           // printData("NVRAM value ==>%x",g_CS_Setting[ModeIndex].CM[idx]  );
                          }
                      
                      msWriteFGammaCM(bWindow, ModeIndex);
                      //FixGamma
                      msWriteFixGammaTbl(bWindow); //Hans120412
                      //Post Gamma
                     //LoadPostGamma(bWindow,1, BGammaTblAddr,BGammaTblAddr1, GammaTblSize);
                     msWriteByteMask(SCE_02,  _BIT2|_BIT1 | _BIT0, _BIT2|_BIT1 | _BIT0);  // fix-gamma/color-matrix/de-g
             -amma enable.  
                       msWriteByteMask(SC8_3F, _BIT7, _BIT7);
                   
                   drvGammaOnOff(_DISABLE, MAIN_WINDOW );
                   drvGammaOnOff(_DISABLE, SUB_WINDOW );
                   mStar_WaitForDataBlanking();
                   LoadPostGamma(GammaTblSize);
                   Delay1ms(50);
                   //mStar_WaitForDataBlanking();
                   drvGammaOnOff(_ENABLE, MAIN_WINDOW );
                   drvGammaOnOff(_ENABLE, SUB_WINDOW );
                      
                      //AUTOGAMMA_PUTSTR("\r\n Load DE color table");
                  }
              }
              
              #endif
1994          //===================================================
1995          #ifdef UseVGACableReadWriteAllPortsEDID
              typedef enum
              {
                  VGA1_EDID_DDC2BI = BIT7,
                  DVI1_EDID_DDC2BI = BIT5,
                  HDMI1_EDID_DDC2BI = BIT3,
                  HDMI2_EDID_DDC2BI = BIT2,
                  DP1_EDID_DDC2BI = BIT1,
                  MHL_EDID_DDC2BI = BIT5,
                  HDMI1_EDID20_EDID_DDC2BI = BIT7,
                  HDMI2_EDID20_EDID_DDC2BI = BIT6,
                      #if 0//OSD_ENABLE_FREESYNC
                      VCP_TPV_PORT_DP1_SECOND = BIT2,
                      #endif
              
              } drvFactoryInputPortEDID;
              
              WORD appFactorySetEdidWriteStart( BYTE ucControl )
              {
                  BYTE xdata ucInputEDID_High, ucInputEDID_Low;
                  ucInputEDID_High = 0x00;
                  ucInputEDID_Low  = 0x00;
                  //Monitor Feedback: 6f 6e 83 02 EDIDPort Status chksum
                  //Return Input Types Information
                  //
              #if ENABLE_VGA  
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 34  

                              ucInputEDID_High|=VGA1_EDID_DDC2BI;
              #endif
                  
              #if ENABLE_DVI        
                      ucInputEDID_High|=DVI1_EDID_DDC2BI;
              #endif
                  
              #if ENABLE_HDMI       
                      ucInputEDID_High|=HDMI1_EDID_DDC2BI;
              #endif
                  
              #if ENABLE_HDMI2  
                      ucInputEDID_High|=HDMI2_EDID_DDC2BI;
              #endif
                  
                  
              #if ENABLE_DP_INPUT         
                      ucInputEDID_High|=DP1_EDID_DDC2BI;
              #endif
                  
                  
              
              
              
                     
              
              
                  
                  //BIT0=0,EDID Saved in EEPRom;BIT0=1,EDID Saved in Flash
                  //BIT1:(0:Write Disable;1:Write Enable)
                  if( ucControl == 0x01 )
                  {
                      //hw_ClrBlacklit();
                      //SET_FACTORY_MODE_FLAG();
                    //  hw_ClrDDC_WP();
                      //Set_WriteEnableFlag();
                      ucInputEDID_Low = ucInputEDID_Low | BIT1;
              
                  }
                  else
                  {
                      //CLR_FACTORY_MODE_FLAG();
                      hw_SetDDC_WP();
                      //Clr_WriteEnableFlag();
                      //SET_DFM_LOADEDIDKEY_FLAG();
                      #if  0//!USER_PREF_EDID_USEFLASH         
                      ReadNVRAMBlock(ADDR_EDID_BLOCK, CNT_EDID_BLOCK);
                      #endif 
                      //LoadAligmentEDID();
                      ucInputEDID_Low = ucInputEDID_Low & ~(BIT1);
                  }
              
                  return (( WORD )ucInputEDID_High << 8 | ucInputEDID_Low );
              }
              #endif
2076          //è§£æžæ•°æ®å¹¶æ‰§è¡Œç›¸å…³æ“ä½œ
2077          #if Enabe_DDCCI_FUNCTION
2078          
2079          BYTE AlignControl(void)
2080          {
2081   1          BYTE CommandCode, CPCode, ValueL, RetValueH, RetValueL, PageValue;
2082   1          BYTE TPValue;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 35  

2083   1          WORD WordValue, ValueH;
2084   1              WORD XDATA g_wFDCRCValue = 0;
2085   1          #if DDCCI_ENABLE
2086   1              WORD WordAddr;
2087   1          #endif
2088   1      #if JRY_Color_Tool_Functing
2089   1          BYTE  XDATA Resault;
2090   1       #endif
2091   1          CommandCode = DDCBuffer[1];//åˆ¤æ–­SET(0x03)è¿˜æ˜¯GET(0x01)
2092   1          PageValue = 0;
2093   1      
2094   1              if( (MenuPageIndex != BurninMenu)
2095   1                &&(MenuPageIndex != UnsupportedModeMenu)
2096   1                &&(MenuPageIndex != LogoMenu))
2097   1              {
2098   2                  #if ENABLE_FREESYNC
                         #if FreeSyncMenu_Enable
                         if((MenuPageIndex == FreeSyncMenu))//||(MenuPageIndex == SFreesyncMenu))
                              Set_OSDFreeSyncActionFlag();
                         else
                       #endif
                   #endif                             
2105   2                {
2106   3           #if ENABLE_FREESYNC                
                       if(MenuPageIndex != InputInfoMenu)
                   #endif             
2109   3                 {
2110   4                      Osd_Hide(); //20151211 for TPV Request
2111   4                      MenuPageIndex=RootMenu;
2112   4                      MenuItemIndex=0;        
2113   4                      Set_LoadOSDDataFlag();///é‡æ–°loadfontçš„flag
2114   4                 }
2115   3                }
2116   2              /*      Osd_Hide(); //20151211 for TPV Request
2117   2                      MenuPageIndex=RootMenu;
2118   2                      MenuItemIndex=0;        */      
2119   2              }
2120   1      
2121   1          #if DDCCI_ENABLE
2122   1              if (!DDCciFlag)//DDCCIç¦ç”¨flag
2123   1              //We can adjust the W/B By DDC2BI When DDCCI Is Disable
2124   1          #endif //When DDCCI_ENABLE=0,we use below to disable DDCCI and Use it to adjust W/B
2125   1          {
2126   2              if (CommandCode == SETVCPFeature || CommandCode == GETVCPFeature)
2127   2              {
2128   3                  CPCode = DDCBuffer[2];//åˆ¤æ–­éœ€è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œå¦‚CPCode=0x10ä¸ºäº®åº¦è°ƒèŠ‚
2129   3                  if (CPCode != 0xFE)
2130   3                      return FALSE;
2131   3              }
2132   2              else
2133   2                  return FALSE;
2134   2          }
2135   1          #if DDCCI_ENABLE_DEBUG
              
                      Osd_Show();
                      Osd_Draw4Num(15,0,DDCBuffer[1]);
                      Osd_Draw4Num(15,1,DDCBuffer[2]);
                      Osd_Draw4Num(15,2,DDCBuffer[3]);
                      Osd_Draw4Num(15,3,DDCBuffer[4]);
                      Osd_Draw4Num(15,4,DDCBuffer[5]);
                      //Delay1ms(1000);
                  #endif
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 36  

2145   1      
2146   1          //111----------------------------------------------------------Start
2147   1          if (CommandCode == SETVCPFeature)
2148   1          // 1-1
2149   1          {
2150   2              CPCode = DDCBuffer[2];//åˆ¤æ–­éœ€è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œå¦‚CPCode=0x10ä¸ºäº®åº¦è°ƒèŠ‚
2151   2              RetValueH = DDCBuffer[3];//DATAé«˜ä½
2152   2              RetValueL = DDCBuffer[4];//DATAä½Žä½
2153   2              WordValue = ((WORD)DDCBuffer[3] << 8) | ((WORD)DDCBuffer[4]);//æŠŠé«˜ä½å’Œåœ°ä½ç»„åˆæˆä¸€ä¸ªWO
             -RDåž‹æ•°æ®
2154   2      #if 0//def WH_REQUEST //20120904
                                              if((MenuPageIndex >= MainMenu && MenuPageIndex <= InputInfoMenu)
                                                      )
                                              {
                                                      {
                                                              ClrOSDWindosw(SUB_WIN_00);
                                                              ClrOSDWindosw(SUB_WIN_01);
                                                              ClrOSDWindosw(SUB_WIN_02);
                                                              ClrOSDWindosw(SUB_WIN_03);
                                                              MenuPageIndex=RootMenu;
                                                              MenuItemIndex=0;
                                                              Osd_Hide();
                                                      }
                                              }
              #endif
2169   2          }
2170   1          else if (CommandCode == GETVCPFeature)
2171   1          // 1-2
2172   1          {
2173   2              CPCode = DDCBuffer[2];
2174   2          }
2175   1          else if (CommandCode == ModeChangeRequest)
2176   1          // 1-3 xx
2177   1          {
2178   2              CPCode = DDCBuffer[2];
2179   2              ValueH = DDCBuffer[3];
2180   2          }
2181   1          else if (CommandCode == GETPagedVCP)
2182   1          // 1-4
2183   1          {
2184   2              PageValue = DDCBuffer[2];
2185   2              CPCode = DDCBuffer[3];
2186   2          }
2187   1          else if (CommandCode == SETPagedVCP)
2188   1          // 1-5
2189   1          {
2190   2              PageValue = DDCBuffer[2];
2191   2              CPCode = DDCBuffer[3];
2192   2              RetValueH = DDCBuffer[4];
2193   2              RetValueL = DDCBuffer[5];
2194   2              WordValue = ((WORD)DDCBuffer[4] << 8) | ((WORD)DDCBuffer[5]);
2195   2          }
2196   1          #if DDCCI_ENABLE
2197   1              else if (CommandCode == CapabilitiesRequest)
2198   1              // 1-6
2199   1              {
2200   2                  RetValueH = DDCBuffer[2];
2201   2                  RetValueL = DDCBuffer[3];
2202   2                  WordAddr = ((WORD)DDCBuffer[2] << 8) | ((WORD)DDCBuffer[3]);
2203   2                  #if Dual
2204   2              if( CURRENT_INPUT_IS_TMDS()//SrcInputType == Input_Digital || SrcInputType == Input_Digital2
2205   2      #if ENABLE_DP_INPUT
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 37  

                              || CURRENT_INPUT_IS_DISPLAYPORT()
              #endif  
2208   2                              )
2209   2                          WordValue = sizeof(DVI_CAP_VCP);
2210   2                      else
2211   2                  #endif
2212   2                      WordValue = sizeof(CAP_VCP);
2213   2                  if (WordAddr >= WordValue)
2214   2                  {
2215   3                      DDCBuffer[0] = 0x83;
2216   3                      DDCBuffer[1] = 0xE3;
2217   3                      return 3;
2218   3                  }
2219   2                  #define CapLen CPCode
2220   2                  CapLen = (WordAddr + 32 >= WordValue) ? (WordValue - WordAddr): 32;
2221   2                  DDCBuffer[0] = CapLen + 3+0x80;
2222   2                  DDCBuffer[1] = 0xE3;
2223   2                  DDCBuffer[2] = RetValueH;
2224   2                  DDCBuffer[3] = RetValueL;
2225   2                  for (ValueL = 4; ValueL < CapLen + 4; ValueL++)
2226   2                  {
2227   3                      #if Dual
2228   3                  if( CURRENT_INPUT_IS_TMDS()//SrcInputType == Input_Digital || SrcInputType == Input_Digital2 
2229   3                      #if ENABLE_DP_INPUT
                              || CURRENT_INPUT_IS_DISPLAYPORT()//SrcInputType == Input_Displayport
                              #endif  
2232   3                      )
2233   3                              DDCBuffer[ValueL] = DVI_CAP_VCP[WordAddr + ValueL - 4];
2234   3                          else
2235   3                      #endif
2236   3                          DDCBuffer[ValueL] = CAP_VCP[WordAddr + ValueL - 4];
2237   3                  }
2238   2                  #undef CapLen
2239   2                  return DDCBuffer[0] &~0x80;
2240   2              }
2241   1          #endif
2242   1          else if (CommandCode == EnableApp)
2243   1          // 1-7 xx
2244   1          {
2245   2              DDCBuffer[0] = 0x80;
2246   2              return 0; //0xFE;
2247   2          }
2248   1          else if (CommandCode == AppTest)
2249   1          // 1-8 xx
2250   1          {
2251   2              DDCBuffer[0] = 0x80;
2252   2              return 0; //0xFD;
2253   2          }
2254   1      #if ENABLE_DeltaE
              
              //*******************************************************************************************
              //MSTART COMMAND***************************************************************************
              //*******************************************************************************************
                      else if ( CommandCode == MStar_Command )
                      {
                               switch(DDCBuffer[2]){
                                      case MS_ColorEngine_OnOff : {
                                       if ( DDCBuffer[3] == 0x00 ){ 
                                                       bToolWriteGamma=1;
                                        //Color Engine Off
                                       msWriteByteMask(SCE_02,  0, _BIT2|_BIT1 | _BIT0);      // fix-gamma/color-matrix/de-gamma disable.
                                              msWriteByteMask(SC8_3F, 0, _BIT7);                                                       
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 38  

                                              }else{                            
                                                      bToolWriteGamma=0;
                                       msWriteByteMask(SCE_02,  _BIT2|_BIT1 | _BIT0, _BIT2|_BIT1 | _BIT0);  // fix-gamma/color-matrix/de-gamm
             -a enable.  
                                              msWriteByteMask(SC8_3F, _BIT7, _BIT7);   
                                              }
                                      }break;
                                      
                               case MS_AutoGamma_OnOff : {
                                       if ( DDCBuffer[3] == 0x00 ){ 
                                        //Off  
                                        msWriteByte( SC0_32, 0x00);
                                        msWriteByte( SC0_1C, BackupOutDE_L);
                                        msWriteByte( SC0_1D, BackupOutDE_H );
                                              }else{                            
                                        //On
                                        BackupOutDE_L = msReadByte(SC0_1C); 
                                        BackupOutDE_H = msReadByte(SC0_1D);
                                                        msWriteByte( SC0_32, 0x01);
                                        msWriteByte( SC0_1C,  msReadByte(SC0_18));
                                        msWriteByte( SC0_1D, 0x00 );
                                              }
                                      }break;
              
                               case MS_AutoGamma_SetBGColor : {
                                       msWriteByte( SC0_33, DDCBuffer[3] ); // Set Red frame color
                                              msWriteByte( SC0_34, DDCBuffer[4] ); // Set Green frame color
                                              msWriteByte( SC0_35, DDCBuffer[5] ); // Set Blue frame   color
                                      }break;
                          #if ENABLE_USE_NewDeltaE
                      case MS_GET_MODEL_NAME :
                          {
                              int i=0,model_len = 0;
              
                              while(tool_model_panel_name[model_len])
                                  ++model_len;
                              ++model_len; //for the \0
              
                              DDCBuffer[0] =model_len;
                              for( i = 0 ; i < model_len-1 ; ++i)
                                    DDCBuffer[i+1] = tool_model_panel_name[i];
                              DDCBuffer[model_len] = 0x00;
                              return model_len;
              
                          }
                          break;
                               case MS_WR_PostGamma :
                          {
                                         XDATA WORD addr, j;
                                      XDATA BYTE Sum, cnt, GmaMode, GmaChannel;
                                      XDATA WORD CheckSum_addr=0,WordAddr;
                                      Sum=0;
                                      g_CheckSumResult =0 ;
                          GmaMode = DDCBuffer[3] ; // gamma mode
                          GmaChannel = DDCBuffer[4] ; // gamma channel
                                      cnt = DDCBuffer[5] ; // data size
                                      addr = (WORD)(DDCBuffer[6] << 8 );
                                      addr += DDCBuffer[7]; // start addr-hi, lo
                          if (GmaMode == 0)
                          {
                                      WordAddr = BGammaTblAddr + GmaChannel*GammaTblSize + addr;
                          }
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 39  

                          #if 0
                          else if (GmaMode == 1)
                          {
                              WordAddr = BGammaTblAddr1 + GmaChannel*GammaTblSize + addr;
                              if (cnt == 40)
                                  CheckSum_addr=BGammaCheckSumStartAddr1+GmaChannel*2;
                              else if (cnt == 24)
                                  CheckSum_addr=BGammaCheckSumStartAddr1+GmaChannel*2+1;
                          }
                          else if (GmaMode == 2)
                          {
                              WordAddr = BGammaTblAddr2 + GmaChannel*GammaTblSize + addr;
                              if (cnt == 40)
                                  CheckSum_addr=BGammaCheckSumStartAddr2+GmaChannel*2;
                              else if (cnt == 24)
                                  CheckSum_addr=BGammaCheckSumStartAddr2+GmaChannel*2+1;
                          }
                          else if (GmaMode == 3)
                          {
                              WordAddr = BGammaTblAddr3 + GmaChannel*GammaTblSize + addr;
                              if (cnt == 40)
                                  CheckSum_addr=BGammaCheckSumStartAddr3+GmaChannel*2;
                              else if (cnt == 24)
                                  CheckSum_addr=BGammaCheckSumStartAddr3+GmaChannel*2+1;
                          }
                          else if (GmaMode == 4)
                          {
                              WordAddr = BGammaTblAddr4 + GmaChannel*GammaTblSize + addr;
                              if (cnt == 40)
                                  CheckSum_addr=BGammaCheckSumStartAddr4+GmaChannel*2;
                              else if (cnt == 24)
                                  CheckSum_addr=BGammaCheckSumStartAddr4+GmaChannel*2+1;
                          }
                          #endif
                                      for(j=0; j< cnt; j++)
                                      {
                                              Sum ^=  DDCBuffer[8+j] ;   
                                      }
                          //hw_ClrGreenLed();
                          NVRam_WriteTbl(WordAddr, &DDCBuffer[8], cnt);
                          //hw_SetGreenLed();
                          g_CheckSumResult = Sum;
                          NVRam_WriteByte(CheckSum_addr, g_CheckSumResult);
                      }
                          break;
                               
                               case MS_LoadColorMode : {                                              
                                         LoadDeltaEColorMode(MAIN_WINDOW, sRGB_MODE, TRUE); //AdobeRGB_MODE
                               }break;
                               #else
              
                               case MS_WR_PostGamma : {                               
                                         XDATA WORD addr, j;
                                      XDATA BYTE Sum, cnt, GmaMode, GmaChannel;
                                      XDATA WORD CheckSum_addr=0,WordAddr;
              
                                      Sum=0;
                                      g_CheckSumResult =0 ;
                                      GmaMode = DDCBuffer[3] & 0x01; // gamma mode
                                      GmaChannel = DDCBuffer[4] & 0x03 ; // gamma channel
                                      cnt = DDCBuffer[5] ; // data size
                                      addr = (WORD)(DDCBuffer[6] << 8 );
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 40  

                                      addr += DDCBuffer[7]; // start addr-hi, lo
                                       //msRegs[0x5004]=0x55;
                                      //if(GmaMode == 0)
                                      //{
                                              //WordAddr = BGammaTblAddr + GmaChannel*GammaTblSize + addr;
                                              //if(cnt == 40)
                                                      //CheckSum_addr=BGammaCheckSumStartAddr+GmaChannel*2;
                                              //else if(cnt == 36)//Hans120316
                                                      //CheckSum_addr=BGammaCheckSumStartAddr+GmaChannel*2+1;
                                      //}
                                      //if(GmaMode == 1)
                                      //{
                                              //WordAddr = BGammaTblAddr1 + GmaChannel*GammaTblSize + addr;
                                              //u16ChkSum_Addr = BGammaCheckSumStartAddr10+GmaChannel*2;
              
                                      //}
                                      WordAddr = BGammaTblAddr + GmaChannel*GammaTblSize + addr;
                                      for(j=0; j< cnt; j++)
                                      {
                                              Sum ^=  DDCBuffer[8+j] ;   
                                NVRam_WriteByte(WordAddr + j, DDCBuffer[8+j]);                
                                      }
                                              
                                      //NVRam_WriteTbl(WordAddr, &DDCBuffer[8], cnt);
                      
                                      g_CheckSumResult ^= Sum;
                                      //NVRam_WriteByte(u16ChkSum_Addr, g_CheckSumResult);
                               }break;
                               
                               case MS_LoadColorMode : {                                              
                                         LoadDeltaEColorMode(MAIN_WINDOW, AdobeRGB_MODE, TRUE);                  
                               }break;
                              #endif
                                       case MS_LoadPostGamma : {                                              
                                         LoadPostGamma(GammaTblSize);
                               }break;
                                       
                               case MS_WR_ColorMatrix : { 
                                 BYTE  cnt, type,i;
                                      cnt = DDCBuffer[4];
                                      type = DDCBuffer[3];
                                      g_CheckSumResult = 0;
                               for(i = 0 ; i < 18 ; i++)
                                      {
                                              //tAllFGamma3x3Matrix[type][i] = DDCBuffer[5+i];
                                              g_CS_Setting[type].CM[i] = DDCBuffer[5+i];
                                              g_CheckSumResult ^= DDCBuffer[5+i];
                                              NVRam_WriteByte( (RM_COLORSPACE_TRANS_BASEADDR + i) + (sizeof(CSTransferSettingType)*type), g_CS_Setti
             -ng[type].CM[i]);
                                      }
                                      //if(type)
                                      //        NVRam_WriteByte(RM_COLORSPACE_TRANS_ChkSum_ADDR+1, g_CheckSumResult);
                                      //else
                                      //        NVRam_WriteByte(RM_COLORSPACE_TRANS_ChkSum_ADDR, g_CheckSumResult);             
                               }break;
                               
                               case MS_Read_ACK : {
                                              DDCBuffer[0] = 0x81;
                                DDCBuffer[1] =  g_CheckSumResult; 
                                g_CheckSumResult = 0;
                                return 1;
                               }break;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 41  

              
                               case MS_WR_BLOCK : {
                                              bToolWriteGamma = DDCBuffer[3] ;
                                      }break;
                       }
                                      
                              
                              
                      }
              #endif
2462   1      
2463   1          else if (CommandCode == GetTimingRequest)
2464   1          // 1-9
2465   1          {
2466   2              DDCBuffer[0] = 0x06;
2467   2              DDCBuffer[1] = 0x4E;
2468   2              DDCBuffer[2] = SyncPolarity(SrcFlags);
2469   2              if (UnsupportedModeFlag)
2470   2                  DDCBuffer[2] |= 0x80;
2471   2              if (!InputTimingStableFlag)
2472   2                  DDCBuffer[2] |= 0x40;
2473   2              WordValue = HFreq(SrcHPeriod) *10;
2474   2              DDCBuffer[3] = WordValue >> 8;
2475   2              DDCBuffer[4] = WordValue &0x00FF;
2476   2              WordValue = VFreq(WordValue, SrcVTotal);
2477   2              DDCBuffer[5] = WordValue >> 8;
2478   2              DDCBuffer[6] = WordValue &0x00FF;
2479   2              return 6;
2480   2          }
2481   1          if (CommandCode == GETVCPFeature || CommandCode == GETPagedVCP)
2482   1          {
2483   2              SIORxBuffer[0] = DDCBuffer[3];//CmdByte  0xE1
2484   2              SIORxBuffer[1] = DDCBuffer[4];//ExtByte eg:0x11->ECO Mode
2485   2              SIORxBuffer[2] = DDCBuffer[5];
2486   2              SIORxBuffer[3] = DDCBuffer[6];
2487   2              SIORxBuffer[4] = DDCBuffer[7];
2488   2              SIORxBuffer[5] = DDCBuffer[8];
2489   2              SIORxBuffer[6] = DDCBuffer[9];
2490   2              SIORxBuffer[7] = DDCBuffer[10];
2491   2              }
2492   1              else if(CommandCode == SETVCPFeature)
2493   1          {//For I-Menu
2494   2          //S-6Ea-51a-PktLena-Pre1Bytea-Pre2Bytea-CmdBytea-ExtBytea-DATA1a-DATA2a-CHKa-P
2495   2      
2496   2              #ifdef UseVGACableReadWriteAllPortsEDID
                        #if 1  ///yuanzhi 20100428_1 for µ¥¿ÚÉÕÂ¼²»Í¨ÎÊÌâ.
                        if((DDCBuffer[2]==0xFE&&DDCBuffer[3]==0xEF)
                              ||((DDCBuffer[3]==0xE1)&&(DDCBuffer[4]==0xA2)&&(DDCBuffer[5]==0x01))
                           )// && DDCBuffer[4]==0x20)
                        #else
                        if(DDCBuffer[2]==0xFE&&DDCBuffer[3]==0xEF)// && DDCBuffer[4]==0x20)
                        #endif
                              {
                                ;
                              }
                        else
                      #endif
2509   2              {
2510   3              SIORxBuffer[0] = DDCBuffer[3];//CmdByte  0xE1
2511   3              SIORxBuffer[1] = DDCBuffer[4];//ExtByte eg:0x11->ECO Mode
2512   3              SIORxBuffer[2] = DDCBuffer[5];//DATA1   Value High
2513   3              SIORxBuffer[3] = DDCBuffer[6];//DATA2   Value Low
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 42  

2514   3              SIORxBuffer[4] = DDCBuffer[7];
2515   3              SIORxBuffer[5] = DDCBuffer[8];
2516   3              SIORxBuffer[6] = DDCBuffer[9];
2517   3              SIORxBuffer[7] = DDCBuffer[10];
2518   3                }
2519   2              }
2520   1          //111----------------------------------------------------------End
2521   1          //GetValue------------------------------------------------------Start
2522   1          if (CommandCode == GETVCPFeature || CommandCode == GETPagedVCP)
2523   1          {
2524   2              //Initial-----------------------Start
2525   2              if (CommandCode == GETVCPFeature)
2526   2              {
2527   3                  if(CPCode==TPV_App_Command)//åˆ¤æ–­CPCodeå‘½ä»¤æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œ
2528   3                      {
2529   4                      DDCBuffer[0] = 0x88;
2530   4                      DDCBuffer[1] = 0x02;
2531   4                      DDCBuffer[2] = 0x00;
2532   4                      DDCBuffer[3] = IMenu_Application;
2533   4                      //DDCBuffer[4] = SIORxBuffer[1];//ExtByte
2534   4                      }
2535   3                      #ifdef UseVGACableReadWriteAllPortsEDID
                           else if((CPCode==0xFE)&&(DDCBuffer[3]==0xEF))
                                              {
                                                ;
                                              }
                              #endif
2541   3                  else
2542   3                      {
2543   4                  DDCBuffer[0] = 0x88;
2544   4                  DDCBuffer[1] = 0x02;
2545   4                  DDCBuffer[2] = 0x00;
2546   4                  DDCBuffer[3] = CPCode;
2547   4                  DDCBuffer[4] = 0x01;
2548   4                  ValueH = 0x00;
2549   4                  ValueL = 0xFF;
2550   4                  RetValueH = 0x00;
2551   4                  TPValue = 0x01;
2552   4              }
2553   3              }
2554   2              else
2555   2              {
2556   3                  DDCBuffer[0] = 0x89;
2557   3                  DDCBuffer[1] = 0xC7;
2558   3                  DDCBuffer[2] = 0x00;
2559   3                  DDCBuffer[3] = PageValue;
2560   3                  DDCBuffer[4] = CPCode;
2561   3                  DDCBuffer[5] = 0x01;
2562   3                  ValueH = 0x00;
2563   3                  ValueL = 0xFF;
2564   3                  RetValueH = 0x00;
2565   3                  TPValue = 0x01;
2566   3              }
2567   2              //Initial-----------------------End
2568   2              //Setting---------------------------------Start
2569   2              if (CPCode == NewControl && PageValue == 0)
2570   2              {
2571   3                   /*if(DDCCINewControlFlag)
2572   3                  RetValueL = 2;
2573   3                  else*/
2574   3                  RetValueL = 1;
2575   3                  ValueL = 2;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 43  

2576   3              }
2577   2         #if ENABLE_HDMI_DRR_MCCS
                      else if(CPCode == VCP_FREESYNC_MODE)
                      {   
                          TPValue = 0x00;
                          ValueH = 0x00;
                          ValueL = 0x01;
                          RetValueH = 0x00;
                  #if ENABLE_FREESYNC
                          if(UserprefFreeSyncMode)
                              {
                              RetValueL=1;
                              }
                          else
                  #endif
                              {
                              RetValueL =0;// USER_PREF_FREESYNCMODE;
                              }
                      }
              #endif
2596   2              else if (CPCode == ALL_Reset && PageValue == 0)
2597   2              {
2598   3                  RetValueL = 0;
2599   3                  ValueL = 1;
2600   3              }
2601   2              
2602   2              else if(CPCode == BriCon_Reset && PageValue == 0)   // 2-2
2603   2              {RetValueL = 0;
2604   3              ValueL = 1;
2605   3              }
2606   2              else if (CPCode == Geometry_Reset && PageValue == 0 && SrcInputType < Input_Digital)
2607   2              // 2-2
2608   2              {
2609   3                  RetValueL = 0;
2610   3                  ValueL = 1;
2611   3              }
2612   2              else if (CPCode == Color_Reset && PageValue == 0)
2613   2              // 2-3
2614   2              {
2615   3                  RetValueL = 0;
2616   3                  ValueL = 1;
2617   3              }
2618   2              else if( CPCode == ADJ_Clock && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_Di
             -gital )
2619   2              // 2-4
2620   2              {
2621   3                  RetValueH = 0;
2622   3                  RetValueL = GetClockValue();
2623   3                  ValueH = 0;
2624   3                  ValueL = 100;
2625   3                  TPValue = 0x00;
2626   3              }
2627   2              else if (CPCode == ADJ_Brightness && PageValue == 0)
2628   2              // 2-5
2629   2              {
2630   3                  ValueL = MaxBrightnessValue - MinBrightnessValue;
2631   3                  RetValueL = UserPrefBrightness - MinBrightnessValue;
2632   3                  TPValue = 0x00;
2633   3              }
2634   2              else if (CPCode == ADJ_Contrast && PageValue == 0)
2635   2              // 2-6
2636   2              {
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 44  

2637   3                  ValueL = ((WORD)(MaxContrastValue - MinContrastValue) *100) / (MaxContrastValue - MinContrastV
             -alue);
2638   3                  RetValueL = ((WORD)(UserPrefContrast - MinContrastValue) *100) / (MaxContrastValue - MinContra
             -stValue); //Benz 2007.4.15   20:32:03100;// UserPrefContrast - MinContrastValue;
2639   3                  TPValue = 0x00;
2640   3              }
2641   2              else if (CPCode == Select_Color_Preset && PageValue == 0)
2642   2              // 2-7
2643   2              {
2644   3                  //Benz 2007.4.15   12:09:45
2645   3                  ValueL = 0x0D; //0x0B
2646   3                  if (UserPrefColorTemp == CTEMP_6500K)
2647   3                      RetValueL = 0x05;
2648   3                              #if CT_sRGB_ENABLE
                          else if (UserPrefColorTemp == CTEMP_SRGB)
                              RetValueL = 0x01;
                                      #endif
2652   3                              #if CT_7500K_ENABLE
                          else if (UserPrefColorTemp == CTEMP_Normal)
                              RetValueL = 0x04;
                                      #endif
2656   3                  else if (UserPrefColorTemp == CTEMP_9300K)
2657   3                      RetValueL = 0x08;
2658   3                  else if (UserPrefColorTemp == CTEMP_USER)
2659   3                      RetValueL = 0x0B;
2660   3                  TPValue = 0x00;
2661   3              }
2662   2              #if ColorTool_Clear_Time
2663   2              
2664   2              else if(CPCode == GetUserTime&& PageValue == 0)
2665   2              {
2666   3                      #if  Show_BackLightTimeValue
2667   3                              
2668   3                      TPValue = 0x00;
2669   3                      ValueH          =BlacklitTime_H;
2670   3                      ValueL          =0;
2671   3                      RetValueH       =BlacklitTime_M;
2672   3                      RetValueL       =BlacklitTime_S;        
2673   3                      
2674   3                      #endif
2675   3              }
2676   2                      //*/
2677   2              else if(CPCode == CleanUsedTime && PageValue == 0)
2678   2              {
2679   3                      if (PowerOnFlag)
2680   3                              Set_DDCCResetTimeFlag();
2681   3              }
2682   2                      
2683   2              else if(CPCode == AutoColorDDCCI&& PageValue == 0)
2684   2              {
2685   3                      
2686   3                              if(SrcInputType== Input_VGA)
2687   3                              {                       
2688   4                                      Set_DDCCIAutoColorFlag();
2689   4                              }
2690   3              }
2691   2                      
2692   2              #endif
2693   2      
2694   2              else if ((CPCode == ADJ_Red_Gain) && PageValue == 0)
2695   2              // 2-8
2696   2              {
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 45  

2697   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
2698   3                      #if 0
                          if (UserPrefColorTemp == CTEMP_SRGB)
                              RetValueL = (WORD)(UserPrefRedColorSRGB - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_USER)
                              RetValueL = (WORD)(UserPrefRedColorUser - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_6500K)
                              RetValueL = (WORD)(UserPrefRedColor6500K - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_Normal)
                              RetValueL = (WORD)(UserPrefRedColorNormal - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_9300K)
                              RetValueL = (WORD)(UserPrefRedColor9300K - MinColorValue)*100/MaxColorValue;
                              #else
2710   3                      RetValueL =GetRedColorValue();
2711   3                      #endif
2712   3                  TPValue = 0x00;
2713   3              }
2714   2              else if ((CPCode == ADJ_Green_Gain) && PageValue == 0)
2715   2              // 2-9
2716   2              {
2717   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
2718   3                      #if 0
                          if (UserPrefColorTemp == CTEMP_SRGB)
                              RetValueL = (WORD)(UserPrefGreenColorSRGB - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_USER)
                              RetValueL = (WORD)(UserPrefGreenColorUser - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_6500K)
                              RetValueL = (WORD)(UserPrefGreenColor6500K - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_Normal)
                              RetValueL = (WORD)(UserPrefGreenColorNormal - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_9300K)
                              RetValueL = (WORD)(UserPrefGreenColor9300K - MinColorValue)*100/MaxColorValue;
                              #else
2730   3                      RetValueL =GetGreenColorValue();
2731   3                      #endif
2732   3                  TPValue = 0x00;
2733   3              }
2734   2              else if ((CPCode == ADJ_Blue_Gain) && PageValue == 0)
2735   2              // 2-10
2736   2              {
2737   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
2738   3                      #if 0
                          if (UserPrefColorTemp == CTEMP_SRGB)
                              RetValueL = (WORD)(UserPrefBlueColorSRGB - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_USER)
                              RetValueL = (WORD)(UserPrefBlueColorUser - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_6500K)
                              RetValueL = (WORD)(UserPrefBlueColor6500K - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_Normal)
                              RetValueL = (WORD)(UserPrefBlueColorNormal - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_9300K)
                              RetValueL = (WORD)(UserPrefBlueColor9300K - MinColorValue)*100/MaxColorValue;
                              #else
2750   3                      RetValueL =GetBlueColorValue();
2751   3                      #endif
2752   3                  TPValue = 0x00;
2753   3              }
2754   2              else if( CPCode == Auto_Setup && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_D
             -igital )
2755   2              // 2-11
2756   2              {
2757   3                  RetValueL = 0;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 46  

2758   3                  ValueL = 1;
2759   3              }
2760   2              #if !ColorTool_Clear_Time
                      else if( CPCode == Auto_Color && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_D
             -igital )
                      // 2-11
                      {
                          RetValueL = 0;
                          ValueL = 1;
                      }
                      #endif
2768   2              else if( CPCode == ADJ_HorizontalPos && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < 
             -Input_Digital )
2769   2              // 2-12
2770   2              {
2771   3                      //110527 Modify
2772   3                  ValueH = 0; 
2773   3                  ValueL = 100; 
2774   3                  RetValueH = 0;
2775   3                  RetValueL = GetHPositionValue();
2776   3                  TPValue = 0x00;
2777   3              }
2778   2              else if (CPCode == ADJ_VerticalPos && PageValue == 0 && SrcInputType < Input_Digital)
2779   2              // 2-13
2780   2              {
2781   3              #if 0
                          ValueH = (MaxVStart - MinVStart) >> 8;
                          ValueL = (MaxVStart - MinVStart) &0x00FF;
                          RetValueH = (UserPrefVStart - MinVStart) >> 8;
                          RetValueL = (UserPrefVStart - MinVStart) &0x00FF;
                          TPValue = 0x00;
                      #else
2788   3                  RetValueH = 0x00;
2789   3                  RetValueL = GetVPositionValue();
2790   3                  ValueH = 0x0;
2791   3                  ValueL = 100;
2792   3                  TPValue = 0x00;
2793   3              #endif
2794   3              }
2795   2              else if( CPCode == ADJ_Phase && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_Di
             -gital )
2796   2              // 2-14
2797   2              {
2798   3                  RetValueH = 0x00;
2799   3                  RetValueL = GetFocusValue();
2800   3                  ValueH = 0x0;
2801   3                  ValueL = 100;
2802   3                  TPValue = 0x00;
2803   3              }
2804   2              else if (CPCode == Select_InputSource)
2805   2              {
2806   3                  ValueH = 0x00;
2807   3                  ValueL = 0x04;
2808   3                  if(CURRENT_INPUT_IS_VGA())//( SrcInputType < Input_Digital ) //if (SrcInputType != Input_Digit
             -al)
2809   3                      RetValueL = 0x01;
2810   3                  else
2811   3                      RetValueH = 0x03;
2812   3                  TPValue = 0x00;
2813   3              }
2814   2              #if AudioFunc
2815   2                  else if (CPCode == ADJ_SpeakerVolume && PageValue == 0)
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 47  

2816   2                  {
2817   3                      ValueH = 0;
2818   3                      ValueL = 100;
2819   3                      RetValueL = UserPrefVolume;
2820   3                      RetValueH = 0;
2821   3                      TPValue = 0x00;
2822   3                  }
2823   2      
2824   2                  else if (CPCode == AudioMute && PageValue == 0)
2825   2                  {
2826   3                      ValueH = 0;
2827   3                      ValueL = 100;
2828   3                      RetValueL = UserPrefMuteState?1:2;
2829   3                      RetValueH = 0;
2830   3                      TPValue = 0x00;
2831   3                  }                   
2832   2              #endif
2833   2              #if ENABLE_FACTORY_BLACKLEVEL  ||   ENABLE_DDCCI_BLACKLEVEL     
                      else if (CPCode == ADJ_Red_Blacklevel && PageValue == 0)
                      {
                          ValueH = 0x00;
                          ValueL = 100;
                          RetValueL = UserprefRedBlackLevel;
                          TPValue = 0;
                      }
                      else if (CPCode == ADJ_Green_Blacklevel && PageValue == 0)
                      {
                          ValueH = 0x00;
                          ValueL = 100;
                          RetValueL = UserprefGreenBlackLevel;
                          TPValue = 0;
                      }
                      else if (CPCode == ADJ_Blue_Blacklevel && PageValue == 0)
                      {
                          ValueH = 0x00;
                          ValueL = 100;
                          RetValueL = UserprefBlueBlackLevel;
                          TPValue = 0;
                      }
                      #endif  
2856   2              else if (CPCode == H_Frequency && PageValue == 0)
2857   2              {
2858   3                  ValueH = 0xFF;
2859   3                  ValueL = 0xFF;
2860   3                  WordValue = HFreq(SrcHPeriod) *10;
2861   3                  RetValueH = WordValue >> 8;
2862   3                  RetValueL = WordValue &0x00ff;
2863   3                  TPValue = 0x01;
2864   3              }
2865   2              else if (CPCode == V_Frequency && PageValue == 0)
2866   2              {
2867   3                  ValueH = 0xFF;
2868   3                  ValueL = 0xFF;
2869   3                  WordValue = HFreq(SrcHPeriod) *10;
2870   3                  WordValue = VFreq(WordValue, SrcVTotal);
2871   3                  RetValueH = WordValue >> 8;
2872   3                  RetValueL = WordValue &0x00ff;
2873   3                  TPValue = 0x01;
2874   3              }
2875   2              else if (CPCode == FlatPanellayout)
2876   2              {
2877   3                  ValueL = 8;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 48  

2878   3                  RetValueL = 1;
2879   3              }
2880   2              else if (CPCode == MonitorType && PageValue == 0)
2881   2              // 2-20
2882   2              {
2883   3                  RetValueH = 0;
2884   3                  RetValueL = 3;
2885   3                  ValueH = 0x00;
2886   3                  ValueL = 0x08;
2887   3                  TPValue = 0x00;
2888   3               }
2889   2              else if (CPCode == DisplayControlType)
2890   2              // Jeff add it in 2004¦~7¤ë13¤é¤U¤È 04:46:32
2891   2              {
2892   3                  ValueH = 0xFF;
2893   3                  ValueL = 0x16;
2894   3                  RetValueH = 0;
2895   3                  RetValueL = 5; // Mean Mstar
2896   3              }
2897   2              else if (CPCode == FWLevel)
2898   2              {
2899   3                  ValueH = 0xFF;
2900   3                  ValueL = 0xFF;
2901   3                  RetValueL = Version;
2902   3                  RetValueH = Version>>16;
2903   3              }
2904   2      #if Enable_DDCCI_OSDEnable_EN
                      else if (CPCode == OSDEnable)
                      {
                          ValueH = 0x00;
                          ValueL = 0x02;      
                          if(DDCOSDDisEnableFlag)
                              RetValueL=1;  //F/W Version
                          else                
                              RetValueL=2;  //F/W Version
                      }
              #endif          
2915   2              else if (CPCode == ADJ_Language && PageValue == 0)
2916   2              // 2-17
2917   2              {
2918   3                  #if 1
2919   3                      ValueL = LANG_Nums;
2920   3                      if (UserPrefLanguage == LANG_Spanish)
2921   3                      RetValueL = LanSpanishCode;
2922   3                      else if (UserPrefLanguage == LANG_France)
2923   3                      RetValueL = LanFrenchCode;
2924   3                      else if (UserPrefLanguage == LANG_German)
2925   3                      RetValueL = LanGermanCode;
2926   3                      else if (UserPrefLanguage == LANG_Italian)
2927   3                      RetValueL = LanItalianCode;
2928   3                      else if (UserPrefLanguage == LANG_Russia)
2929   3                      RetValueL = LanRussianCode;
2930   3                      else if (UserPrefLanguage == LANG_Swedish)
2931   3                      RetValueL = LanSwedishCode;
2932   3                      else if (UserPrefLanguage == LANG_Polish)
2933   3                      RetValueL = LanPolishCode;                      
2934   3                      else if (UserPrefLanguage == LANG_Czech)
2935   3                      RetValueL = LanCzechCode;
2936   3                      else if (UserPrefLanguage == LANG_Portugues)
2937   3                      RetValueL = LanPortugueseCode_Brazil;
2938   3                      else if (UserPrefLanguage == LANG_SChina)
2939   3                      RetValueL = LanSChineseCode;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 49  

2940   3                      else if (UserPrefLanguage == LANG_TChina)
2941   3                      RetValueL = LanTChineseCode;
2942   3                      else if (UserPrefLanguage == LANG_Korea)
2943   3                      RetValueL = LanKoreanCode;
2944   3                      else if (UserPrefLanguage ==LANG_Japan )
2945   3                      RetValueL = LanJapaneseCode;
2946   3                      else if (UserPrefLanguage == LanDutchCode)      //120105 Modify
2947   3                      RetValueL = LANG_Dutch;
2948   3                      else if (UserPrefLanguage == LANG_Finnish)      //120105 Modify
2949   3                      RetValueL = LanFinnishCode;                     
2950   3                      else if (UserPrefLanguage == LANG_English)
2951   3                      RetValueL = LanEnglistCode;                             
2952   3                      RetValueH = 0x00;
2953   3                  #endif
2954   3              }
2955   2              
2956   2              #if 0//ENABLE_FREESYNC
                      else if (CPCode == VCP_FREESYNC_MODE)
                      {                        
                          //ValueH = 0x00;
                          //ValueL = VCP_FREESYNC_MODE_MAX_VALUE;
              
                          ValueH = 0x00;
                          ValueL = VCP_FREESYNC_MODE_ENABLE;
                          RetValueH = 0x00;
                          RetValueL = VCP_FREESYNC_MODE_ENABLE;
              
                      }
                      #endif  
2969   2              else if (CPCode == VCPVersion && PageValue == 0)
2970   2              {
2971   3                  RetValueL = 1;
2972   3                  RetValueH = 2;
2973   3                  ValueH = 0xFF;
2974   3                  ValueL = 0xFF;
2975   3              }
2976   2                  else if (CPCode == 0xFE)
2977   2                  {
2978   3             if (SIORxBuffer[0]=='R')
2979   3                  {
2980   4                      if (SIORxBuffer[1]=='M' && SIORxBuffer[2]=='N'&&SIORxBuffer[3]=='0')
2981   4                      {
2982   5                          TPValue=SIORxBuffer[3];
2983   5                          ValueH = SIORxBuffer[4];
2984   5                          if(SIORxBuffer[4]>='0'&&SIORxBuffer[4]<='3')
2985   5                          {   
2986   6                              BYTE i;
2987   6                                 i=SIORxBuffer[4]-'0';
2988   6                              ValueL = MODEL_TYPE[3*i];
2989   6                              RetValueH = MODEL_TYPE[3*i+1];
2990   6                              RetValueL = MODEL_TYPE[3*i+2];
2991   6                          }
2992   5                      } 
2993   4               #ifdef ReduceDDC
                              else if((SIORxBuffer[1]=='E' && SIORxBuffer[2]=='D'&&SIORxBuffer[3]=='I'))//'R' 'E'     'D'     'I'     'D'     'W'     'A'     
             -'Y'
                              #ifdef OnlyVGAEDIDInFlash
                              {//'R'  'E'     'D'     'I'     'D'     'V'     'G'     'A'
                                  TPValue='I';
                                  ValueH = 'D';
                                  ValueL = 'V';
                                  RetValueH = 'G';
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 50  

                                  RetValueL = 'A';
                              }
                              #else
                              {//'R'  'E'     'D'     'I'     'D'     'F'     'L'     'H'
                                  TPValue='I';
                                  ValueH = 'D';
                                  ValueL = 'F';
                                  RetValueH = 'L';
                                  RetValueL = 'H';
                              }
                              #endif
                      #endif 
3013   4              #if HDCPKEY_IN_Flash
3014   4                      else if((SIORxBuffer[1]=='H' && SIORxBuffer[2]=='D'&&SIORxBuffer[3]=='C'))
3015   4                      {
3016   5                          ValueH = TCRCvalue / 256;
3017   5                          ValueL = TCRCvalue % 256;
3018   5                          RetValueH = 0x88;
3019   5                          RetValueL = 0x02;
3020   5      
3021   5                                      Clr_WriteHDCPcodeFlag();
3022   5                  }
3023   4              #endif 
3024   4              }
3025   3                      #ifdef  UseVGACableReadWriteAllPortsEDID
                                      else if(DDCBuffer[3]==0xEF)//else if(SIORxBuffer[0]==0xEF)
                                      {
                                              BYTE i,Length;
                                              WORD Addr;
              
                                              Length = DDCBuffer[7];
                                              Addr=(DDCBuffer[5]<<8)+DDCBuffer[6];
                                              if((DDCBuffer[4]>=VGA1&&DDCBuffer[4] <=MHL_HDMI2)||(DDCBuffer[4]>=EEPROM&&DDCBuffer[4] <=PanelSettingD
             -evice))        //130614 xiandi
                                              {
                                                      ReadDevice(DDCBuffer[4],  Addr,( BYTE* )&SIORxBuffer,Length);//Read EDID or HDCP KEY
                                                      for(i = 0; i < Length; i++)
                                                      {
                                                              DDCBuffer[i+1] = SIORxBuffer[i];
                                                      }
                                              }
                                              else
                                              {
                                                      ;
                                              }
                                              DDCBuffer[0]= 0x80+Length;
                                              return Length;
                                      }
                              #endif
3049   3                      
3050   3                 #if HDCPKEY_IN_Flash
3051   3                      else if(SIORxBuffer[0]==0xE1 &&  SIORxBuffer[1]==0xE2 &&  SIORxBuffer[2]==0x00 && SIORxBuffer[3]==0x00)
3052   3                      {
3053   4                          ValueH = TCRCvalue / 256;
3054   4                          ValueL = TCRCvalue % 256;
3055   4                          RetValueH = 0x00;
3056   4                          RetValueL = 0x00;
3057   4                                      Clr_WriteHDCPcodeFlag();
3058   4                      }
3059   3              #endif 
3060   3      
3061   3              }
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 51  

3062   2      /***********************************************Zhifeng.Wu***********************************************/
3063   2              #define I_Menu_Command  SIORxBuffer[1]
3064   2      
3065   2               //For TPV Application
3066   2              else if (CPCode == TPV_App_Command&& PageValue == 0)
3067   2              {
3068   3                      if(SIORxBuffer[0]==IMenu_Application)//For AOC I-Menu Application
3069   3                      {
3070   4                              //For Other Luminance Menu
3071   4                              if(I_Menu_Command==ECO_Mode)
3072   4                              {
3073   5                               RetValueH = 0;
3074   5                               RetValueL = UserPrefECOMode;
3075   5                               ValueH = 0;
3076   5                               ValueL = ECO_Nums-1;
3077   5                              }
3078   4      #if Enable_Gamma
                                      else if(I_Menu_Command==Gamma)
                                      {
                                       RetValueH = 0;
                                       RetValueL = UserPrefGamaMode;
                                       ValueH = 0;
                                       ValueL = GAMA_Nums-1;
                                      }
              #endif                  
3087   4                              else if(I_Menu_Command==DCR)
3088   4                              {
3089   5                               RetValueH = 0;
3090   5                               RetValueL = UserPrefDcrMode;
3091   5                               ValueH = 0;
3092   5                               ValueL = 1;
3093   5                              }
3094   4                              else if(I_Menu_Command==PB_Hue)
3095   4                              {
3096   5                              }
3097   4                              else if(I_Menu_Command==PB_Saturation)
3098   4                              {
3099   5                              }
3100   4                      }
3101   3              }
3102   2              #undef  I_Menu_Command
3103   2      /*******************************************************************************************************/
3104   2              
3105   2              else if ( CPCode == PowerMode )
3106   2              {
3107   3                  ValueL = 4;
3108   3                  if ( !PowerOnFlag )
3109   3                  {
3110   4                      RetValueL = 4;
3111   4                  }
3112   3                  else if ( PowerSavingFlag )
3113   3                  {
3114   4                      RetValueL = 2;
3115   4                  }
3116   3                  else
3117   3                  {
3118   4                      RetValueL = 1;
3119   4                  }
3120   3              }               
3121   2              else
3122   2              {
3123   3                  DDCBuffer[2] = 0x01;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 52  

3124   3                  RetValueL = 0x00;
3125   3                  ValueH = 0xFF;
3126   3                  ValueL = 0xFF;
3127   3              }
3128   2              //Setting---------------------------------End
3129   2              //Transmission----------------------------Start
3130   2              if (CommandCode == GETVCPFeature)
3131   2              {
3132   3                  if(CPCode==TPV_App_Command)
3133   3                      {
3134   4                              DDCBuffer[5] = ValueH;
3135   4                              DDCBuffer[6] = ValueL;
3136   4                              DDCBuffer[7] = RetValueH;
3137   4                              DDCBuffer[8] = RetValueL;
3138   4                      }
3139   3                      else
3140   3                      {
3141   4                  DDCBuffer[4] = TPValue;
3142   4                  DDCBuffer[5] = ValueH;
3143   4                  DDCBuffer[6] = ValueL;
3144   4                  DDCBuffer[7] = RetValueH;
3145   4                  DDCBuffer[8] = RetValueL;
3146   4                      }
3147   3                  return 8;
3148   3              }
3149   2              else
3150   2              {
3151   3                  DDCBuffer[5] = TPValue;
3152   3                  DDCBuffer[6] = ValueH;
3153   3                  DDCBuffer[7] = ValueL;
3154   3                  DDCBuffer[8] = RetValueH;
3155   3                  DDCBuffer[9] = RetValueL;
3156   3                  return 9;
3157   3              }
3158   2              //Transmission----------------------------End
3159   2          }
3160   1          //GetValue------------------------------------------------------Start
3161   1          //SetValue------------------------------------------------------Start
3162   1          else if (CommandCode == SETVCPFeature || CommandCode == SETPagedVCP)
3163   1          {
3164   2              DDCBuffer[2] = 0x00; // Result Code
3165   2              ValueH = 0x00;
3166   2              ValueL = 0xFF;
3167   2              TPValue = 0x01;
3168   2              if (CPCode == NewControl && PageValue == 0)
3169   2              {
3170   3                  //Clr_DDCCINewControlFlag();
3171   3                  ValueL = 2;
3172   3              }
3173   2              else if (CPCode == ALL_Reset && PageValue == 0)
3174   2              // 3-1
3175   2              {
3176   3                  if (WordValue != 0)
3177   3                  {
3178   4                      Osd_Hide();//petit 20131024 only for I-Menu reset.
3179   4                      ResetAllSetting();
3180   4                      // wait for checking
3181   4                      //msWriteByte(BCR, 0x80);
3182   4                      //msWriteByte(BCG, 0x80);
3183   4                      //msWriteByte(BCB, 0x80);
3184   4                  }
3185   3                  ValueL = 1;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 53  

3186   3              }
3187   2              
3188   2              else if(CPCode == BriCon_Reset&& PageValue == 0)   // 3-2
3189   2              { 
3190   3                  if(WordValue != 0 )
3191   3                  {
3192   4                      UserPrefBrightness=DefBrightness;
3193   4                      UserPrefContrast=DefContrast;
3194   4      
3195   4      
3196   4                  
3197   4      
3198   4              mStar_AdjustBrightness( UserPrefBrightness);
3199   4              mStar_AdjustContrast(UserPrefContrast); //120413 Modify
3200   4              }
3201   3              ValueL = 1;
3202   3              }        
3203   2              else if( CPCode == Geometry_Reset && PageValue == 0 && INPUT_IS_VGA(rxInputPort))   //else if (CPC
             -ode == Geometry_Reset && PageValue == 0 && rxInputPort != Input_Digital)
3204   2              {
3205   3                  if( WordValue != 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_Digital )   //if (WordValu
             -e != 0 && SrcInputType != Input_Digital)
3206   3                      ResetGeometry();
3207   3                  ValueL = 1;
3208   3                  TPValue = 0x00;
3209   3              }
3210   2              else if (CPCode == Color_Reset && PageValue == 0)
3211   2              // 3-3
3212   2              {
3213   3                  UserPrefRedColorUser = DefRedColor;
3214   3                  UserPrefGreenColorUser= DefGreenColor;
3215   3                  UserPrefBlueColorUser= DefBlueColor;
3216   3                      #if ENABLE_FACTORY_BLACKLEVEL  ||   ENABLE_DDCCI_BLACKLEVEL     
                          UserprefRedBlackLevel = DefRedBlackLevel;
                          UserprefGreenBlackLevel = DefGreenBlackLevel;
                          UserprefBlueBlackLevel = DefBlueBlackLevel;
                          mStar_AdjustUserPrefBlacklevel(UserprefRedBlackLevel, UserprefGreenBlackLevel, UserprefBlueBla
             -ckLevel);
                              #endif
3222   3                  UserPrefColorTemp = CTEMP_Warm1; //CTEMP_9300K 20051115 wmz
3223   3                  if (WordValue != 0)
3224   3                      SetColorTemp();//Setcolortemp();
3225   3                  //Benz 2007.4.15   19:31:44SetColor();
3226   3                  ValueL = 1;
3227   3              }
3228   2              else if( CPCode == ADJ_Clock && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_Di
             -gital )
3229   2              // 3-4
3230   2              {
3231   3                  //if( SrcInputType < Input_Digital ) //if (SrcInputType != Input_Digital)
3232   3                  {
3233   4                      UserPrefHTotal = ((WordValue *(MaxClock - MinClock) + 50) / 0x64 + MinClock);
3234   4                      drvADC_AdjustHTotal( UserPrefHTotal );                          
3235   4                      #if USEFLASH //Modify Request TPV FW Sting  20170110
3236   4                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3237   4                      #else
                              NVRam_WriteByte(nvrModeAddr(HTotal), UserPrefHTotal);
                              #endif
3240   4                  }
3241   3                  TPValue = 0x00;
3242   3              }
3243   2              else if (CPCode == ADJ_Brightness && PageValue == 0)//åˆ¤æ–­ä¿®æ”¹äº®åº¦å€¼
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 54  

3244   2              // 3-5
3245   2              {       
3246   3                      #if CT_sRGB_ENABLE
                              if((UserPrefECOMode == ECO_Standard)&&(UserPrefColorTemp!=CTEMP_SRGB)&&(!UserPrefDcrMode))      //120609 Modi
             -fy
                              #else
3249   3                      if((UserPrefECOMode == ECO_Standard)&&(!UserPrefDcrMode))       //120609 Modify
3250   3                      #endif
3251   3                      {
3252   4                          UserPrefBrightness = RetValueL + MinBrightnessValue;
3253   4                          mStar_AdjustBrightness(UserPrefBrightness);
3254   4                      
3255   4                      }
3256   3                  ValueL = MaxBrightnessValue - MinBrightnessValue;
3257   3                  TPValue = 0x00;
3258   3              }
3259   2              else if (CPCode == ADJ_Contrast && PageValue == 0)
3260   2              // 3-6
3261   2              {
3262   3                  //Osd_Hide();
3263   3                              #if CT_sRGB_ENABLE
                              if((UserPrefECOMode == ECO_Standard)&&(UserPrefColorTemp!=CTEMP_SRGB)&&(!UserPrefDcrMode))      //1206
             -09 Modify
                                      #else
3266   3                              if((UserPrefECOMode == ECO_Standard)&&(!UserPrefDcrMode))       //120609 Modify
3267   3                              #endif
3268   3                      {
3269   4                          if (RetValueL <= (MaxContrastValue - MinContrastValue))
3270   4                          {
3271   5                              UserPrefContrast = (WORD)(RetValueL *(MaxContrastValue - MinContrastValue)) / 100+MinCont
             -rastValue;
3272   5      
3273   5                              mStar_AdjustContrast(UserPrefContrast);
3274   5                          }
3275   4                      }
3276   3                  ValueL = 100;
3277   3                  TPValue = 0x00;
3278   3              }
3279   2              else if (CPCode == Select_Color_Preset && PageValue == 0)
3280   2              // 3-7
3281   2              {
3282   3      
3283   3                   if (RetValueL == 0x05)
3284   3                      UserPrefColorTemp = CTEMP_6500K;
3285   3                           #if CT_sRGB_ENABLE
                          else if (RetValueL == 0x01)
                              UserPrefColorTemp = CTEMP_SRGB;
                                       #endif
3289   3                              #if CT_7500K_ENABLE
                          else if (RetValueL == 0x04)
                              UserPrefColorTemp = CTEMP_Normal;
                                      #endif
3293   3                  else if (RetValueL == 0x08)
3294   3                      UserPrefColorTemp = CTEMP_9300K;
3295   3                  else if (RetValueL == 0x0B)
3296   3                      UserPrefColorTemp = CTEMP_USER;
3297   3                              #if CT_sRGB_ENABLE
                                      if( UserPrefColorTemp == CTEMP_SRGB )   //121220 Modify
                                      {
                                              if( UserPrefECOMode != ECO_Standard )
                                              {
                                                      UserPrefECOMode = ECO_Standard;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 55  

                                              }
              #if Enable_Gamma                                
                                              if( UserPrefGamaMode != GAMA1 )
                                              {
                                                      UserPrefGamaMode = GAMA1;
                                                                              #if Enable_Gamma
                                                      mStar_SetupGamma( GAMA1 );
                                                                              #endif
                                              }
              #endif                          
                                              if(UserPrefDcrMode)
                                              {
                                                      UserPrefDcrMode = 0;
                                                      SetECO();
                                                      msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
                                              }
                                      }
                                      #endif
3321   3                      SetColorTemp();//Setcolortemp();
3322   3                  ValueL = 0x0D; //0x0B
3323   3                  TPValue = 0x00;
3324   3              }
3325   2                      
3326   2              else if (CPCode == ADJ_Red_Gain && PageValue == 0)
3327   2              // 3-8
3328   2              {
3329   3                  if (UserPrefColorTemp == CTEMP_USER)
3330   3                  {
3331   4                      UserPrefRedColorUser=UserPrefRedColor = (WORD)RetValueL*( MaxColorValue - MinColorValue )/
             -100 + MinColorValue;          //120215 Modify
3332   4                      mStar_AdjustRedColor(UserPrefRedColor, UserPrefContrast);                                                                                                                       //120215 Modify
3333   4                  }
3334   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
3335   3                  TPValue = 0x00;
3336   3              }
3337   2              else if (CPCode == ADJ_Green_Gain && PageValue == 0)
3338   2              // 3-9
3339   2              {
3340   3                  if (UserPrefColorTemp == CTEMP_USER)
3341   3                  {
3342   4                      UserPrefGreenColorUser = UserPrefGreenColor = (WORD)RetValueL*( MaxColorValue - MinColorVa
             -lue )/100 + MinColorValue;            //120215 Modify
3343   4                      mStar_AdjustGreenColor(UserPrefGreenColor, UserPrefContrast);                                                                                                                           //120215 Modi
             -fy
3344   4                  }
3345   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
3346   3                  TPValue = 0x00;
3347   3              }
3348   2              else if (CPCode == ADJ_Blue_Gain && PageValue == 0)
3349   2              // 3-10
3350   2              {
3351   3                  if (UserPrefColorTemp == CTEMP_USER)
3352   3                  {
3353   4                      UserPrefBlueColorUser = UserPrefBlueColor = (WORD)RetValueL*( MaxColorValue - MinColorValu
             -e )/100 + MinColorValue;              //120215 Modify
3354   4                      mStar_AdjustBlueColor(UserPrefBlueColor, UserPrefContrast);                                                                                                                             //120215 Modify
3355   4                  }
3356   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
3357   3                  TPValue = 0x00;
3358   3              }
3359   2              else if( CPCode == Auto_Setup && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_D
             -igital )
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 56  

3360   2              // 3-11
3361   2              {
3362   3                  if( WordValue != 0 )   //if (WordValue != 0 && SrcInputType != Input_Digital)
3363   3                      AutoConfig();
3364   3                  ValueL = 1;
3365   3              }
3366   2              else if( CPCode == Auto_Color && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_D
             -igital )
3367   2              // 3-12
3368   2              {
3369   3                  if( WordValue != 0 )   //if (WordValue != 0 && SrcInputType != Input_Digital)
3370   3                      mStar_AutoColor();
3371   3                      #if Show_BackLightTimeValue
3372   3                      BlacklitTime_S = 0;
3373   3                      BlacklitTime_M = 0;
3374   3                      BlacklitTime_H = 0;
3375   3                      MonitorBackLightTime_S=BlacklitTime_S;
3376   3                      MonitorBackLightTime_M= BlacklitTime_M; 
3377   3                      MonitorBackLightTime_H=BlacklitTime_H;  
3378   3                   #if USEFLASH
3379   3                      //SaveMonitorSetting2();                        
3380   3                      UserPref_EnableFlashSaveBit( bFlashForceSaveMonitor2Bit );
3381   3                      //UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
3382   3                      #else   
                                 NVRam_WriteByte(NVRAM_ADDR_MointorMember(MonitorFlag), MonitorFlags);
                                  NVRam_WriteByte(nvrMonitorAddr(BacklighttimeS), MonitorBackLightTime_S);
                                  NVRam_WriteByte(nvrMonitorAddr(BacklighttimeM), MonitorBackLightTime_M);
                                  NVRam_WriteByte(nvrMonitorAddr(BacklighttimeH), MonitorBackLightTime_H);
              
                              #endif
3389   3                    #endif
3390   3      
3391   3                  ValueL = 1;
3392   3              }
3393   2              else if( CPCode == ADJ_HorizontalPos && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < 
             -Input_Digital )
3394   2              // 3-12
3395   2              {
3396   3                  //if( SrcInputType < Input_Digital ) //if (SrcInputType != Input_Digital)
3397   3                  {
3398   4                      UserPrefHStart = (WORD)(WordValue)*(MaxHStart-MinHStart)/100 + MinHStart;
3399   4                      mStar_AdjustHPosition(UserPrefHStart);
3400   4                                      #if USEFLASH //Modify Request TPV FW Sting  20170110
3401   4                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3402   4                                      #else
                                              NVRam_WriteByte(nvrModeAddr(HStart), UserPrefHStart);
                                              #endif
3405   4                  }
3406   3                  TPValue = 0x00;
3407   3              }
3408   2              else if( CPCode == ADJ_VerticalPos && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < In
             -put_Digital )
3409   2              // 3-13
3410   2              {
3411   3                          UserPrefVStart = (WORD)WordValue*(MaxVStart-MinVStart)/100 + MinVStart;
3412   3                          mStar_AdjustVPosition(UserPrefVStart);
3413   3                                      
3414   3                      #if USEFLASH //Modify Request TPV FW Sting
3415   3                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3416   3                      #else
                              NVRam_WriteByte(nvrModeAddr(VStart), UserPrefVStart);
                              #endif
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 57  

3419   3                      TPValue = 0x00;
3420   3              }
3421   2              else if( CPCode == ADJ_Phase && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_Di
             -gital )
3422   2              // 3-14
3423   2              {
3424   3                  //if( SrcInputType < Input_Digital ) //if (SrcInputType != Input_Digital)
3425   3                  {
3426   4                                      UserPrefPhase = WordValue*(MAX_PHASE_VALUE+1)/100 + 0.5;
3427   4                                      if(UserPrefPhase>MAX_PHASE_VALUE)
3428   4                                              UserPrefPhase=MAX_PHASE_VALUE;
3429   4                      drvADC_SetPhaseCode( UserPrefPhase );
3430   4                                      
3431   4                      #if USEFLASH //Modify Request TPV FW Sting  20170110
3432   4                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3433   4                      #else
                              NVRam_WriteByte(nvrModeAddr(Phase), UserPrefPhase);
                              #endif
3436   4                  }
3437   3                  TPValue = 0x00;
3438   3              }
3439   2              else if (CPCode == DDCCI_Settings && PageValue == 0 )
3440   2              // 3-14
3441   2              {
3442   3                  if(CURRENT_INPUT_IS_VGA())//( SrcInputType < Input_Digital ) //if (SrcInputType != Input_Digit
             -al)
3443   3                  {
3444   4                      #if USEFLASH
3445   4                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3446   4                      #else
                              SaveModeSetting();
                              #endif
3449   4                  }
3450   3      
3451   3                  #if USEFLASH
3452   3                UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit);
3453   3                  #else
                          SaveMonitorSetting();
                          #endif
3456   3                  
3457   3                  TPValue = 0x00;
3458   3              }
3459   2              else if (CPCode == Select_InputSource && PageValue == 0)
3460   2              {
3461   3                  // Osd_Hide();
3462   3                  if (RetValueL == 0x01 || RetValueL == 0x02)
3463   3                  {
3464   4                     #if ENABLE_VGA_INPUT
3465   4                          ChangeSourceToAnalog();
3466   4                       #endif
3467   4                  }
3468   3                  if (RetValueL == 0x03 || RetValueL == 0x04)
3469   3                  {
3470   4                      #if Dual
3471   4                              #if INPUT_TYPE != INPUT_1A1H && INPUT_TYPE != INPUT_1A1DP
                                  ChangeSourceToDigital();
                                      #endif
3474   4                      #endif
3475   4                  }
3476   3                              #if ENABLE_HDMI //130821 xiandi
3477   3                              if (RetValueL == 0x11)
3478   3                              {
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 58  

3479   4                                  
3480   4                    #if Dual
3481   4                      #if INPUT_TYPE == INPUT_1A1H1DP //131031 xiandi
                              ChangeSourceToDigital();
                              #else
3484   4                      ChangeSourceToHDMI();
3485   4                      #endif
3486   4                    #endif
3487   4                              }
3488   3                              #endif
3489   3                              #if ENABLE_DP_INPUT     //130821 xiandi
                                      if (RetValueL == 0x0F)
                                      {
                                              ChangeSourceToDP();
                                      }
                                      #endif
3495   3                  TPValue = 0x00;
3496   3              }
3497   2              #if AudioFunc
3498   2                  else if (CPCode == ADJ_SpeakerVolume && PageValue == 0)
3499   2                  {
3500   3                      //Osd_Hide();
3501   3                      UserPrefVolume = RetValueL;
3502   3                              if(UserPrefMuteState)
3503   3                           {
3504   4                                 SwitchMute(MIA_DecValue);    // UserPrefMuteState=0;
3505   4                           }                          
3506   3                      mStar_AdjustVolume(UserPrefVolume);
3507   3                      TPValue = 0x00;
3508   3                  }
3509   2                  else if (CPCode == AudioMute && PageValue == 0)
3510   2                  {
3511   3                      //Osd_Hide();
3512   3                      if(RetValueL==0x01) 
3513   3                         {
3514   4                              UserPrefMuteState = 1;
3515   4                              SwitchMute(MIA_Nothing);    
3516   4                        }                     
3517   3                       else if(RetValueL==0x02) 
3518   3                         {
3519   4                              UserPrefMuteState = 0;
3520   4                              mStar_AdjustVolume(UserPrefVolume);
3521   4                        }             
3522   3                              
3523   3                      TPValue = 0x00;
3524   3                  }                   
3525   2              #endif
3526   2      #if Enable_DDCCI_OSDEnable_EN
                      else if(CPCode == OSDEnable&& PageValue == 0)
                      {
                          if(RetValueL==1)
                              Set_DDCOSDDisEnableFlag();
                          if(RetValueL==2)
                              Clr_DDCOSDDisEnableFlag();
                          TPValue = 0x00;
                      }
              #endif          
3536   2                      
3537   2                #if ENABLE_FACTORY_BLACKLEVEL  ||   ENABLE_DDCCI_BLACKLEVEL           
                      else if ((CPCode == ADJ_Red_Blacklevel || CPCode == ADJ_Green_Blacklevel || CPCode == ADJ_Blue_Bla
             -cklevel) && PageValue == 0)
                      {
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 59  

                          if (CPCode == ADJ_Red_Blacklevel)
                              UserprefRedBlackLevel = RetValueL;
                          else if (CPCode == ADJ_Green_Blacklevel)
                              UserprefGreenBlackLevel = RetValueL;
                          else if (CPCode == ADJ_Blue_Blacklevel)
                              UserprefBlueBlackLevel = RetValueL;
                          mStar_AdjustUserPrefBlacklevel(UserprefRedBlackLevel, UserprefGreenBlackLevel, UserprefBlueBla
             -ckLevel);
                          SaveMonitorSetting();
                      }
                      #endif  
3550   2              else if (CPCode == ADJ_Language && PageValue == 0)
3551   2              // 3-17
3552   2              {
3553   3                  //     UserPrefLanguage = RetValueL-1;
3554   3                  #if 1
3555   3                      if (RetValueL == LanSpanishCode)
3556   3                      {
3557   4                      UserPrefLanguage = LANG_Spanish;
3558   4                      }
3559   3      
3560   3                      else if (RetValueL == LanFrenchCode)
3561   3                      {
3562   4                      UserPrefLanguage = LANG_France;
3563   4                      }
3564   3      
3565   3                      else if (RetValueL == LanGermanCode)
3566   3                      {
3567   4                      UserPrefLanguage = LANG_German;
3568   4                      }
3569   3      
3570   3                      else if (RetValueL == LanItalianCode)
3571   3                      {
3572   4                      UserPrefLanguage = LANG_Italian;
3573   4                      }
3574   3      
3575   3                      else if (RetValueL == LanRussianCode)
3576   3                      {
3577   4                      UserPrefLanguage = LANG_Russia;
3578   4                      }
3579   3      
3580   3                      else if (RetValueL == LanSwedishCode)
3581   3                      {
3582   4                      UserPrefLanguage = LANG_Swedish;
3583   4                      }
3584   3      
3585   3                      else if (RetValueL == LanPolishCode)
3586   3                      {
3587   4                      UserPrefLanguage = LANG_Polish;
3588   4                      }
3589   3      
3590   3                      else if (RetValueL == LanCzechCode)
3591   3                      {
3592   4                      UserPrefLanguage = LANG_Czech;
3593   4                      }
3594   3      
3595   3                      else if (RetValueL == LanPortugueseCode_Brazil)
3596   3                      {
3597   4                      UserPrefLanguage = LANG_Portugues;
3598   4                      }
3599   3      
3600   3                      else if (RetValueL == LanSChineseCode)
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 60  

3601   3                      {
3602   4                      UserPrefLanguage = LANG_SChina;
3603   4                      }
3604   3      
3605   3                      else if (RetValueL == LanTChineseCode)
3606   3                      {
3607   4                      UserPrefLanguage = LANG_TChina;
3608   4                      }
3609   3      
3610   3                      else if (RetValueL == LanKoreanCode)
3611   3                      {
3612   4                      UserPrefLanguage = LANG_Korea;
3613   4                      }
3614   3      
3615   3                      else if (RetValueL == LanJapaneseCode)
3616   3                      {
3617   4                      UserPrefLanguage = LANG_Japan;
3618   4                      }
3619   3      
3620   3                      else if (RetValueL == LanDutchCode)     //120105 Modify
3621   3                      {
3622   4                      UserPrefLanguage = LANG_Dutch;
3623   4                      }
3624   3      
3625   3                      else if (RetValueL == LanFinnishCode)   //120105 Modify
3626   3                      {
3627   4                      UserPrefLanguage = LANG_Finnish;
3628   4                      }
3629   3                      else if (RetValueL ==LanEnglistCode)
3630   3                      // default
3631   3                      {
3632   4                      UserPrefLanguage = LANG_English; 
3633   4                      }       
3634   3                                      
3635   3                      ValueL = LANG_Nums;
3636   3                      TPValue = 0x00;
3637   3                  #endif
3638   3              }
3639   2              else if (CPCode == SyncType && PageValue == 0)
3640   2              // 2-19
3641   2              {
3642   3                  ValueL = 3;
3643   3                  RetValueL = 0;
3644   3              }
3645   2              else if( CPCode == PowerMode && PageValue == 0 )        //120301 Modify
3646   2              {
3647   3                  if( RetValueL == 0x01 )
3648   3                  {
3649   4                      if(!PowerOnFlag)
3650   4                      {
3651   5                                              PowerOnSystem();
3652   5                                              #if USEFLASH
3653   5                                              UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
3654   5                                              #else
                                                      NVRam_WriteByte( nvrMonitorAddr( MonitorFlag ), MonitorFlags );
                                                      #endif
3657   5                      }
3658   4                  }
3659   3                              else if( RetValueL == 0x04 )
3660   3                              {
3661   4                      if(PowerOnFlag)
3662   4                              {
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 61  

3663   5                                              PowerOffSystem();
3664   5                                              #if USEFLASH
3665   5                                              UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
3666   5                                              #else
                                                      NVRam_WriteByte( nvrMonitorAddr( MonitorFlag ), MonitorFlags );
                                                      #endif
3669   5                      }
3670   4                              }
3671   3                  TPValue = 0x00;
3672   3              }
3673   2      
3674   2               
3675   2      /***********************************************Zhifeng.Wu***********************************************/
3676   2      /*      #define I_Menu_Command      SIORxBuffer[1]
3677   2              #define I_Menu_Set_Value_H  SIORxBuffer[2]
3678   2              #define I_Menu_Set_Value        SIORxBuffer[3]
3679   2               //For TPV Application
3680   2              else if (CPCode == TPV_App_Command&& PageValue == 0)
3681   2              {
3682   2                      if(SIORxBuffer[0]==IMenu_Application)//For AOC I-Menu Application
3683   2                      {
3684   2                              //For Other Luminance Menu
3685   2                              if((I_Menu_Command==ECO_Mode)&&(!UserPrefDcrMode))      //121122 Modify
3686   2                              {
3687   2                                      {
3688   2      
3689   2                                              ICE_MAIN_CTRL(0);                               
3690   2                                              ICE_SUB_CTRL(0);                                
3691   2                                      }
3692   2      
3693   2                                      if(UserPrefColorTemp==CTEMP_SRGB)
3694   2                                      {
3695   2                                              UserPrefColorTemp=CTEMP_Warm1;
3696   2                                      }
3697   2                                      UserPrefECOMode=I_Menu_Set_Value;
3698   2                                      SetECO();
3699   2                              }
3700   2                              #if CT_sRGB_ENABLE
3701   2                              else if((I_Menu_Command==Gamma)&&(UserPrefColorTemp!=CTEMP_SRGB)&&(!UserPrefDcrMode))   //120609 Modify
3702   2                              {
3703   2                                  #if Enable_Gamma
3704   2                                      UserPrefGamaMode=I_Menu_Set_Value;
3705   2                                      mStar_SetupGamma( UserPrefGamaMode );   //120308 Modify
3706   2                                      #endif
3707   2                              }
3708   2                              #endif
3709   2                              else if(I_Menu_Command==DCR)
3710   2                              {
3711   2                                  #if CT_sRGB_ENABLE
3712   2                                      if (UserPrefColorTemp == CTEMP_SRGB)
3713   2                                              UserPrefColorTemp = CTEMP_Warm1;
3714   2                                       #endif
3715   2                                      if(UserPrefDcrMode!=I_Menu_Set_Value)//duqq080806 test
3716   2                                              AdjustDcrMode(1);                                                
3717   2                              }
3718   2                              
3719   2                              //For Picture Boost Items
3720   2                      
3721   2                      #if ESaverPowerDownFunc
3722   2                              else if(I_Menu_Command==PB_AutoPowerDown)
3723   2                              {
3724   2                                  ESaverPowerDownCounter=0;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 62  

3725   2                                      if((!I_Menu_Set_Value_H)&&(!I_Menu_Set_Value))
3726   2                                      {
3727   2                          ESaverPowerDownCounter=0;
3728   2                                      }
3729   2                                      else
3730   2                                      {   
3731   2                                              ESaverPowerDownCounter=((WORD)I_Menu_Set_Value_H << 8) | ((WORD)I_Menu_Set_Value);
3732   2                                      }
3733   2                                      //Osd_Show();
3734   2                                      //Osd_Draw4Num(1,1,ESaverPowerDownCounter);
3735   2                              }
3736   2                      #endif
3737   2                      }
3738   2                      
3739   2              }
3740   2              #undef  I_Menu_Command
3741   2              #undef  I_Menu_Set_Value_H
3742   2              #undef  I_Menu_Set_Value
3743   2      */
3744   2      /*******************************************************************************************************/
3745   2              else if (CPCode == 0xFE && PageValue == 0)
3746   2              {
3747   3                      #ifdef UseVGACableReadWriteAllPortsEDID
                                      if(DDCBuffer[3]==0xEF)
                                      {
                                              BYTE i,Length;
                                              WORD Addr;
                                              Addr=(DDCBuffer[5]<<8)+DDCBuffer[6];
                                              Length=DDCBuffer[0]-0x86;
                                      //      if(DDCBuffer[4]==HDMI1)
                                              {
                                                      for(i=0;i<Length;i++)
                                                      {
                                                              SIORxBuffer[i] = DDCBuffer[i+7];
                                                      }
                                              }
                      
                                              if((DDCBuffer[4]>=VGA1&&DDCBuffer[4] <=MHL_HDMI2)||(DDCBuffer[4]>=EEPROM&&DDCBuffer[4] <=PanelSettingD
             -evice))        //130614 xiandi
                                                      {
                                                      
                                                                      EnableReadDDCType=DDCBuffer[4];
                                                                      for(i=0; i<Length; i++)
                                                                      {
                                                                              NVRam_WriteByte(Addr+i, SIORxBuffer[i]);
                                                                       }      
                                                                      EnableReadDDCType=I2C_EEPROM;
                                                                      //*/
                                                              //WriteDevice(DDCBuffer[4] ,Addr,Length);//Write EDID or HDCP KEY
                                                      }
                                              else
                                              {
                                                      return 0;
                                              }
                                              DDCBuffer[0]=0x83;
                                              DDCBuffer[1]=0x00;
                                              DDCBuffer[2]=DDCBuffer[6];//(Addr<<8);
                                              DDCBuffer[3]=Length;
                                              return 3;
                                      }
                                      else if((DDCBuffer[3]==0xE1)&&(DDCBuffer[4]==0xA2))
                                      {
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 63  

                                              if(DDCBuffer[6]==0x01)
                                              {
                                                      ///hw_ClrDDC_WP();//EDID In Flash should not disable ddc ram.
                                                      Set_WriteDeviceFlag();
                                                      g_wFDCRCValue = appFactorySetEdidWriteStart( DDCBuffer[6] );//VGA1_EDID|HDMI1_EDID;//
                                                       DDCBuffer[0] = 0x84;
                                                       DDCBuffer[1] = 0x02;
                                                  DDCBuffer[2] = g_wFDCRCValue >> 8;
                                                  DDCBuffer[3] = g_wFDCRCValue & 0xFF;
                                                 // DDCBuffer[4] = 0x03;
                                                      
                                              }
                                              else if(DDCBuffer[6]==0x00)
                                              {
                                                      hw_SetDDC_WP();
                                                      Clr_WriteDeviceFlag();
                                                       DDCBuffer[1] = 0x02;
                                              }
                                      }
                                      else if(DDCBuffer[3]==0x04)
                                      {
                                              if (PowerOnFlag)
                                              {
                                                      hw_ClrAmberLed();
                                                      hw_ClrGreenLed();
                                                      //hw_ClrBlacklit();
                                                      #if USEFLASH
                                                      UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit);
                                                      #else
                                                      NVRam_WriteByte( nvrMonitorAddr( MonitorFlag ), MonitorFlags);
                                                      #endif
                                              }
                                      }
                                      else
                                      #endif
3821   3              
3822   3                      {
3823   4                      #if NewFactoryCommand
                                 BYTE tempValue;
                              #endif
3826   4                       
3827   4              #ifdef DATA_LENGTH_20_BYTE
3828   4                  BYTE i;
3829   4                  for(i=0;i<23;i++)
3830   4                      SIORxBuffer[i] = DDCBuffer[i+3];
3831   4              #else
                          SIORxBuffer[0] = DDCBuffer[3];
                          SIORxBuffer[1] = DDCBuffer[4];
                          SIORxBuffer[2] = DDCBuffer[5];
                          SIORxBuffer[3] = DDCBuffer[6];
                          SIORxBuffer[4] = DDCBuffer[7];
                          SIORxBuffer[5] = DDCBuffer[8];
                          SIORxBuffer[6] = DDCBuffer[9];
                          SIORxBuffer[7] = DDCBuffer[10];
                      #endif
3841   4      
3842   4                                      #if NewFactoryCommand
              //==========================NewFactoryCommand====================
                                      #define TPVCMD1    DDCBuffer[3]
                                      #define TPVCMD2    DDCBuffer[4]
                                      #define TPV_ValueH DDCBuffer[5]
                                      #define TPV_ValueL DDCBuffer[6]
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 64  

              
                      #if 0//def WH_REQUEST//add by lwj 120828
                              #if 0//WH_REQUEST_DDCCI_POWERSAVING
                              if(TPVCMD1==0xD6)//POWER DOWN 
                                       {
                                              if(TPVCMD2==PowerOff)
                                                      {
                                                       PowerOffSystem();
                                                      }
                                              if(TPVCMD2==ForceIntoPowerSaving)
                                                       {
                                                #if MS_PM
                                                      if (!PowerSavingFlag)
                                                      {
                                                      hw_ClrBlacklit();
                                                      Set_ForcePowerSavingFlag();
                                                      Set_DDCForcePowerSavingFlag();
                                                      }
                                              #else
                                                      Power_PowerOffSystem();
                                              #endif
              
                                                      hw_ClrGreenLed();
                                                      hw_SetAmberLed();
              
                                                      }
                                      }
                              #endif
                      #endif
                                              
                                      if(TPVCMD1==TPV_FactoryAutoAlignment)
                                      {
                                              if(TPVCMD2==SetFactoryMode)
                                              {
                                                      if(TPV_ValueL==SetOn)
                                                              {
                                                              Set_FactoryModeFlag();
                                                              Set_BurninModeFlag();
                                                              //120413 Modify for TPV Request
                                                              #if Enable_Gamma
                                                              if( UserPrefGamaMode != GAMA1 )
                                                              {
                                                                      UserPrefGamaMode = GAMA1;
                                                                      mStar_SetupGamma( GAMA1 );
                                                              }
                                                              #endif
                                                              if(UserPrefECOMode != ECO_Standard)
                                                              {
                                                                      UserPrefECOMode = ECO_Standard;
                                                                      SetECO();
                                                              }
                                                              if(UserPrefDcrMode)
                                                              {
                                                                      UserPrefDcrMode = 0;
                                                                      SetECO();
                                                                      msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
                                                              }
              
                                                              UserPrefBrightness = DefBrightness;
                                                              UserPrefContrast = DefContrast;
              
                                                              mStar_AdjustBrightness(UserPrefBrightness);
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 65  

                                                              mStar_AdjustContrast(UserPrefContrast);
              
                                                              DDCBuffer[1] = 0x02;    
                                                              }
                                                      else if(TPV_ValueL==SetOff)
                                                              {
                                                              Clr_FactoryModeFlag();
                                                              DDCBuffer[1] = 0x04;    
                                                      
                                                              }
                                                       #if !USEFLASH
                                                          NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                                                       #else
                                                       UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                                                       #endif
                                              }
                                              else if(TPVCMD2==NVMInit)
                                              {
                                              }
                                              else if(TPVCMD2==SetBurnMode)
                                              {
                                                      if(TPV_ValueL==SetOn)
                                                      {
                                                              Set_BurninModeFlag();
                                                              Set_DoBurninModeFlag();         //120703 Modify for TPV Request
                                                      }
                                                      else if(TPV_ValueL==SetOff)
                                                      {
                                                              Clr_BurninModeFlag();
                                                              Clr_DoBurninModeFlag();         //120703 Modify for TPV Request
                                                      }
                                                      else if(TPV_ValueL==2)//burnin room checklater
                                                              ;
                                              #if !USEFLASH
                                  NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                                              #else
                                  SaveMonitorSetting();
                                              #endif
                                              #if USEFLASH
                                                              Flash_ReadMonitorSet((BYTE*)&MonitorSetting, MonitorSettingSize);
                                                        if(MonitorSetting.MonitorFlag==MonitorFlags)
                                                   {
                                                      DDCBuffer[1]=0x02;
                                                      }
                                                  else
                                                   {
                                                      DDCBuffer[1]=0x04;
                                                      }       
                                                       
                                                #else
                                                      NVRam_ReadByte(nvrMonitorAddr(MonitorFlag), &tempValue);
                                                   if(tempValue== MonitorFlags)
                                                      {
                                                      DDCBuffer[1]=0x02;
                                                      }
                                                  else
                                                   {
                                                      DDCBuffer[1]=0x04;
                                                      }
                                      #endif
                                              
                                              }
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 66  

                                              else if(TPVCMD2==ClearBacklitTime)
                                              {
                                                      #if USEFLASH
                                                      #else
                                                      SaveBlacklitTime();
                                                      
                                                      NVRam_ReadTbl(BlacklitTimeAddr, (BYTE*)(&tempValue), 4);
                                                         if(tempValue==0)
                                                            {
                                                              DDCBuffer[1]=0x02;
                                                              }
                                                         else
                                                           {
                                                              DDCBuffer[1]=0x04;
                                                              }
                                                      #endif
                                              
                                                      
                                              }
                                              else if(TPVCMD2==SetDPSAndICareEnable)          //130311 Modify
                                              {
              
                                              }
                                              else if(TPVCMD2==SetProduceMode)
                                              {
                                                      #if !USEFLASH
                                                      WORD temp,temp1;
                                                      #endif
                                                      if(TPV_ValueL==SetOn)
                                                      {
                                                              #if AudioFunc
                                                                       UserPrefVolume=90;     //120920 Modify for PE Request
                                                               mStar_AdjustVolume(UserPrefVolume);                    //130107_23 Henry 
                                                              #endif
                                                   #if USEFLASH
                                                       FactoryProductModeValue=ProductModeOnValue;
                                                       SaveFactorySetting();
                                                                                               SaveMonitorSetting();
                                                            #else
                                                              {
                                                      temp=ProductModeOnValue;
                                                      NVRam_WriteTbl(ProductModeAddr, (BYTE*)(&temp), 2);
                                                                                              #if AudioFunc
                                                                                              NVRam_WriteByte(nvrMonitorAddr(Volume), UserPrefVolume);
                                                                                              #endif
                                                              }
                                                             #endif
                                                      }
                                                      else if(TPV_ValueL==SetOff) 
                                                      {
                                                      #if USEFLASH
                                                          FactoryProductModeValue=ProductModeOffValue;
                                                          SaveFactorySetting();
                                                            #else
                                                              {
                                                         temp=ProductModeOffValue;
                                                          NVRam_WriteTbl(ProductModeAddr, (BYTE*)(&temp), 2);
                                                              }
                                                              #endif
                                                      }
                                                  #if USEFLASH
                                                                              Flash_ReadFactorySet((BYTE*)&FactorySetting, FactorySettingSize);
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 67  

                                                  if(FactorySetting.ProductModeValue==FactoryProductModeValue)
                                                   {
                                                      DDCBuffer[1]=0x02;
                                                      }
                                                  else
                                                   {
                                                      DDCBuffer[1]=0x04;
                                                      }
              
                                                     #else
                                                           NVRam_ReadTbl(ProductModeAddr, (BYTE*)(&temp1), 2);
                                                   if(temp1==temp)
                                                      {
                                                      DDCBuffer[1]=0x02;
                                                      }
                                                  else
                                                   {
                                                      DDCBuffer[1]=0x04;
                                                      }
                                             #endif
                                                                         
              
                                              }
                                              else if(TPVCMD2==LogoONOFF)//  2011.8.3   
                                                 {
                                                   if(TPV_ValueH==0x06)       //120420 Modify
                                                      {
                                                        if(TPV_ValueL==0x01)
                                                              {
                                                                UserPrefLogoON=1;
                                                                      #if USEFLASH
                                                                      SaveFactorySetting();
                                                                      #else
                                                                         NVRam_WriteByte(nvrFactoryAddr(LogoON), UserPrefLogoON);
                                                                      #endif
              
                                                              }
                                                        else
                                                              {
                                                                UserPrefLogoON=0;
                                                                      #if USEFLASH
                                                                      SaveFactorySetting();
                                                                      #else
                                                                          NVRam_WriteByte(nvrFactoryAddr(LogoON), UserPrefLogoON);
                                                                      #endif
              
                                                              }
                                                       
                                                      }
                                                      else if(TPV_ValueH==0x03)       //120301 Modify
                                                      {
                                                              if( TPV_ValueL == SetOn )
                                                              {
                                                                      if(!UserPrefDcrMode)
                                                                      {
                                                                              AdjustDcrMode(1);
                                                                              #if !USEFLASH
                                                                              NVRam_WriteByte( nvrMonitorAddr( DcrMode ), UserPrefDcrMode );
                                                                              #else
                                                                              UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
                                                                              #endif
                                                                      }
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 68  

                                                              }
                                                              else if( TPV_ValueL == SetOff )
                                                              {
                                                                      if(UserPrefDcrMode)
                                                                      {
                                                                              AdjustDcrMode(1);
                                                                              #if !USEFLASH
                                                                              NVRam_WriteByte( nvrMonitorAddr( DcrMode ), UserPrefDcrMode );
                                                                              #else
                                                                              UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
                                                                              #endif
                                                                      }
                                                              }
                                                      }
                                                  }                           
                                              
                                              #if PanelminiLVDS ||PANEL_VCOM_ADJUST   //110229 Modify
                                              else if(TPVCMD2==AdjPanelVCOM)
                                              {
                                                      #if VCOM_TYPE == VCOM_MAXIM     || VCOM_TYPE == VCOM_SMIM ||VCOM_TYPE == VCOM_TPSIM     //120322 Modify
                                                      WordValue = (( TPV_ValueH << 8 ) | TPV_ValueL );
                                                      WordValue = WordValue + VCOM_VALUE_OFFSET;
                                                      if( WordValue >= MAX_VCOM_VALUE )
                                                              FactorySetting.VcomValue = MAX_VCOM_VALUE;
                                                      else
                                                              FactorySetting.VcomValue = WordValue & 0x3FF;
                                                      #else
                                                      if( TPV_ValueL >= 0x7F )
                                                              FactorySetting.VcomValue = 0x7F;
                                                      else
                                                              FactorySetting.VcomValue = TPV_ValueL;
                                                      #endif
                                                      msWriteMiniLVDSi2c_Vcom_DAC(FactorySetting.VcomValue);
                                                      #if USEFLASH
                                                              SaveFactorySetting();
                                                      #else
                                                                      #if VCOM_TYPE == VCOM_MAXIM || VCOM_TYPE == VCOM_SMIM ||VCOM_TYPE == VCOM_TPSIM //120413 Modify
                                                              NVRam_WriteWord( nvrFactoryAddr( VcomValue ), FactorySetting.VcomValue );
                                                                      #else
                                                              NVRam_WriteByte( nvrFactoryAddr( VcomValue ), FactorySetting.VcomValue );
                                                                      #endif
                                                      #endif
                                              }
                                              #endif
                                              #if HDCPKEY_IN_Flash
                                              else if(TPVCMD2==HDCPReadWriteStart)
                                              {
                                                      Set_WriteHDCPcodeFlag();
              
                                                      TCRCvalue = 0;
                                                      Power_TurnOffLed();
                                                      //Flash_Erase_FreeBuffer(FLASH_KEY_HDCP,0); // jeff add it in 2009 0907
                                                      bFlashWriteFactory = TRUE;
                                                      
                                  #if 0 // Enable_Cache
                                  MCU_DisableCache();
                                  #endif
              
                                                      #if !((CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSUMF) && ENABLE_CABLE_5V_EDID)
                                                      FlashSectorErase(TRUE, HDCPKEYSET_START);
                                                      FlashDisableWP(HDCPKEYSET_START);
                                                      #endif
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 69  

                                              }
                                              #endif
                                              #if Enable_Gamma
                                              else if(TPVCMD2==AdjGammaMode)
                                              {
                                                 UserPrefGamaMode = TPV_ValueL;
                                 mStar_SetupGamma( UserPrefGamaMode );
                                              }
                                              #endif
              
                                      }       
                                      
                                      else if(TPVCMD1==TPV_AdjRedGain)
                                      {
                                          UserPrefRedColor = TPV_ValueL; // for CT
                              //mStar_AdjustRedColor(UserPrefRedColor, UserPrefContrast);
                                              mStar_AdjustRGBColor(UserPrefContrast, UserPrefRedColor, UserPrefGreenColor, UserPrefBlueColor);        //120
             -105 Modify
                                              DDCBuffer[1]=0x02;
                                      }
                                      else if(TPVCMD1==TPV_AdjGreenGain)
                                      {
                                          UserPrefGreenColor = TPV_ValueL; // for CT
                              //mStar_AdjustGreenColor(UserPrefGreenColor, UserPrefContrast);
                                              mStar_AdjustRGBColor(UserPrefContrast, UserPrefRedColor, UserPrefGreenColor, UserPrefBlueColor);        //120
             -105 Modify
                                              DDCBuffer[1]=0x02;
                                      }
                                      else if(TPVCMD1==TPV_AdjBlueGain)
                                      {
                                          UserPrefBlueColor = TPV_ValueL; // for CT
                              //mStar_AdjustBlueColor(UserPrefBlueColor, UserPrefContrast);
                                              mStar_AdjustRGBColor(UserPrefContrast, UserPrefRedColor, UserPrefGreenColor, UserPrefBlueColor);        //120
             -105 Modify
                                              DDCBuffer[1]=0x02;
                                      }
                                      else if(TPVCMD1==TPV_AdjContrast)       
                                      {
                              UserPrefContrast = TPV_ValueL;
                              UserPrefContrast = UserPrefContrast + MinContrastValue;//checklater
                              mStar_AdjustContrast(UserPrefContrast);                         
                                              DDCBuffer[1]=0x02;
                                      }
                                      else if(TPVCMD1==TPV_AdjBrightness)     
                                      {
                              UserPrefBrightness = TPV_ValueL;
                              mStar_AdjustBrightness(UserPrefBrightness);                     
                                              DDCBuffer[1]=0x02;
                                      }
                                      else if(TPVCMD1==TPV_SetDefLanguage)    
                                      {
                             
                                      #if 1   //120322 Modify
                                              if (TPV_ValueL == LanSpanishCode)
                                                      {
                                      UserPrefLanguage = LANG_Spanish;
                                                      }
                                                      
                                  else if (TPV_ValueL == LanFrenchCode)
                                      {
                                      UserPrefLanguage = LANG_France;
                                      }
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 70  

                                                      
                                  else if (TPV_ValueL == LanGermanCode)
                                      {
                                      UserPrefLanguage = LANG_German;
                                      }
                                                      
                                  else if (TPV_ValueL == LanItalianCode)
                                      {
                                      UserPrefLanguage = LANG_Italian;
                                      }
                                                      
                                  else if (TPV_ValueL == LanRussianCode)
                                      {
                                      UserPrefLanguage = LANG_Russia;
                                      }
                                                      
                                  else if (TPV_ValueL == LanSwedishCode)
                                      {
                                      UserPrefLanguage = LANG_Swedish;
                                      }
                                                      
                                  else if (TPV_ValueL == LanPolishCode)
                                      {
                                      UserPrefLanguage = LANG_Polish;
                                      }
                                                      
                                  else if (TPV_ValueL == LanCzechCode)
                                      {
                                      UserPrefLanguage = LANG_Czech;
                                      }
                                                                
                                              else if (TPV_ValueL == LanPortugueseCode_Brazil)
                                      {
                                      UserPrefLanguage = LANG_Portugues;
                                      }
                                        
                                  else if (TPV_ValueL == LanSChineseCode)
                                      {
                                      UserPrefLanguage = LANG_SChina;
                                      }
                                                      
                                  else if (TPV_ValueL == LanTChineseCode)
                                      {
                                      UserPrefLanguage = LANG_TChina;
                                      }
                                                      
                                  else if (TPV_ValueL == LanKoreanCode)
                                      {
                                      UserPrefLanguage = LANG_Korea;
                                      }
                                                      
                                  else if (TPV_ValueL == LanJapaneseCode)
                                      {
                                      UserPrefLanguage = LANG_Japan;
                                      }
                                                                              
                                                      else if (TPV_ValueL == LanDutchCode)    //120105 Modify
                                      {
                                                              UserPrefLanguage = LANG_Dutch;
                                      }
                                                      
                                                      else if (TPV_ValueL == LanFinnishCode)  //120105 Modify
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 71  

                                      {
                                                              UserPrefLanguage = LANG_Finnish;
                                      }
              
                                  else if (TPV_ValueL ==LanEnglistCode)
                                  // default
                                                              {
                                      UserPrefLanguage = LANG_English; 
                                      }       
                                      #if CHIP_ID == CHIP_TSUMV       //130924 henry  petit update 20131017
                                      Set_LoadOSDDataFlag();  
                                      if(MenuPageIndex>=MainMenu&&MenuPageIndex<=ExitMenu)
                                      {
                                              Osd_Hide();
                                                      MenuPageIndex=RootMenu;
                                      }
                                      #else
                                              //For Select SChinese/TChinese/Korean Language Font Error Issue
                                      LoadLanguageStatusPropfont();   //120105 Modify
                                      #endif
                              #endif
                              #if !USEFLASH
                                  NVRam_WriteByte(nvrMonitorAddr(Language), UserPrefLanguage);
                              #else
                                  SaveMonitorSetting();
                              #endif
                               #if USEFLASH
                                                      Flash_ReadMonitorSet((BYTE*)&MonitorSetting, MonitorSettingSize);
                                   if(MonitorSetting.Language==UserPrefLanguage)
                                           {
                                              DDCBuffer[1]=0x02;
                                              }
                                          else
                                           {
                                              DDCBuffer[1]=0x04;
                                              }       
                                
                            #else
                                         NVRam_ReadByte(nvrMonitorAddr(Language), &tempValue);
                                   if(tempValue==UserPrefLanguage)
                                      {
                                      DDCBuffer[1]=0x02;
                                      }
                                  else
                                   {
                                      DDCBuffer[1]=0x04;
                                      }
                                  
                             #endif
                                               
                                              
                                      }
                                      else if(TPVCMD1==TPV_SelectInput)       
                                      {
                                      
                                      }
                                      else if(TPVCMD1==TPV_SelectGamma)       
                                      {
                                      
                                      }                       
                                      else if(TPVCMD1==TPV_RestorFactory)     
                                      {
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 72  

              
                                                              {
                                                           if( ResetAllSetting())
                                                      DDCBuffer[1]=0x02;
                                                           else
                                                    DDCBuffer[1]=0x04;
                                                              }
              
                                              ForceDelay1ms(50);
                            
                              }                       
                                      else if(TPVCMD1==TPV_AutoColor) //120723 Modify
                                      {
                                              if (mStar_AutoColor())
                                              {
                                                      #if Show_BackLightTimeValue
                                                      BlacklitTime_S = 0;
                                                      BlacklitTime_M = 0;
                                                      BlacklitTime_H = 0;
                                                      MonitorBackLightTime_S=BlacklitTime_S;
                                                      MonitorBackLightTime_M= BlacklitTime_M; 
                                                      MonitorBackLightTime_H=BlacklitTime_H;  
                                                    #endif
                                                      if (CheckFactorySettingOutOfRange())
                                                      {
                                                              #if 1//USEFLASH         //131105 Henry For AutoColor Not Save
                                                              Init_FactorySetting();
                                                              SaveFactorySetting();
                                                              #else
                                                              Init_MonitorSetting();
                                                              SaveMonitorSetting();
                                                              #endif
                                                              DDCBuffer[1]=0x04;
                                                      }
                                                      else
                                                      {
                                                              #if 1//USEFLASH         //131105 Henry For AutoColor Not Save
                                                              SaveFactorySetting();
                                                              #else
                                                              SaveMonitorSetting();
                                                              #endif
                                                              DDCBuffer[1]=0x02;
                                                      #if 0//def WH_REQUEST           //Fay 2013/9/13
                                                              Set_EnableShowFactoryMenuFlag();
                                                      #else
                                                              Delay1ms(200);
                                                              MenuPageIndex = FactoryMenu;
              
                                                              MenuItemIndex = 0;
                                                              Osd_SetPosition(0,100);//20140903  for BJ PE
                                                              DrawOsdMenu();
                                                              
                                                              //Osd_SetPosition(0,100);
                                                      #endif
                                                      }
                                                   #if USEFLASH
                                                      //SaveMonitorSetting2();                        
                                                      UserPref_EnableFlashSaveBit( bFlashForceSaveMonitor2Bit );
                                                      //UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
                                                      #else   
                                                         NVRam_WriteByte(NVRAM_ADDR_MointorMember(MonitorFlag), MonitorFlags);
                                                          NVRam_WriteByte(nvrMonitorAddr(BacklighttimeS), MonitorBackLightTime_S);
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 73  

                                                          NVRam_WriteByte(nvrMonitorAddr(BacklighttimeM), MonitorBackLightTime_M);
                                                          NVRam_WriteByte(nvrMonitorAddr(BacklighttimeH), MonitorBackLightTime_H);
              
                                                      #endif
                                              }       
                                              else
                                              {
                                                      #if 1//USEFLASH                 //131105 Henry For AutoColor Not Save
                                                      SaveFactorySetting();
                                                      #else
                                                      SaveMonitorSetting();
                                                      #endif
              
                                                      DDCBuffer[1]=0x04;
                                              }
                                      }
                                      else if(TPVCMD1==TPV_AutoConfig)
                                      {
                                              if (mStar_AutoGeomtry())
                                              {
                                                     CheckModeSettingRange();
                                               
                                                      DDCBuffer[1]=0x02;
                                              }
                                              else
                                                      DDCBuffer[1]=0x04;
              
                                                SaveModeSetting();
                                      }
                                      else if(TPVCMD1==TPV_SaveOrRecallColTmp)        
                                      {
                                              //#define ColTemp               DDCBuffer[4]
                                              //#define InpSrc          DDCBuffer[5]
                                              //#define ActFlag         DDCBuffer[6]
              
                                              #if 1//WH_REQUEST_DDCCI
                                              
                                                               if( TPVCMD2 == 0x81 )//for quick Set_ColorTemp  //only for WH 20120906 lwj
                                                               {              
                                              
                                                       //9300   
                                                                       UserPrefRedColorCool1 = SIORxBuffer[2];
                                                                       UserPrefGreenColorCool1 = SIORxBuffer[3];
                                                                       UserPrefBlueColorCool1 = SIORxBuffer[4];
                                                                              //Normal                                                
                                                                       UserPrefRedColorNormal = SIORxBuffer[5];
                                                                       UserPrefGreenColorNormal = SIORxBuffer[6];
                                                                       UserPrefBlueColorNormal = SIORxBuffer[7];      
                                                                       //6500
                                                                       UserPrefRedColorWarm1 = SIORxBuffer[8];
                                                                       UserPrefGreenColorWarm1 = SIORxBuffer[9];
                                                                       UserPrefBlueColorWarm1 = SIORxBuffer[10];
                                                                       #if CT_sRGB_ENABLE
                                                                               //SRGB
                                                                       UserPrefRedColorSRGB = SIORxBuffer[11];
                                                                       UserPrefGreenColorSRGB = SIORxBuffer[12];
                                                                       UserPrefBlueColorSRGB = SIORxBuffer[13];
                                                                       #endif
                                              
                                                                       
                                                                       #if USEFLASH
                                                                       SaveFactorySetting();
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 74  

                                                                       #else
                                                                       SaveMonitorSetting();
                                                                      #endif
                                                               
                                                                      #if USEFLASH
                                                                       Flash_ReadMonitorSet((BYTE*)&MonitorSetting, MonitorSettingSize);
                                                                       tempValue=MonitorSetting.ColorTemp;
                                                                       Flash_ReadFactorySet((BYTE*)&FactorySetting, FactorySettingSize);
                                                                      #else
                                                                       NVRam_ReadByte(nvrMonitorAddr(ColorTemp), &tempValue);
                                                                       NVRam_ReadTbl(MonitorSettingAddr, (BYTE*) &MonitorSetting, MonitorSettingSize);
                                                                      #endif
                                                                      // recommand = OK_READY;                                                                          
                                                               }
                                              #endif
              
                                              if(TPV_ValueL)
                                              {
                                                      switch(TPVCMD2)
                                                      {
                                                          #if CT_sRGB_ENABLE
                                                              case ColorTempSRGB:
                                                                      
                                                                      UserPrefColorTemp = CTEMP_SRGB;
                                                                      UserPrefRedColor = UserPrefRedColorSRGB;
                                                                      UserPrefGreenColor = UserPrefGreenColorSRGB;
                                                                      UserPrefBlueColor = UserPrefBlueColorSRGB;
                                                                      ReadColorTempSetting(); // 2006/11/10 6:59PM by KK ReadSRGBSetting();
                                                                      mStar_AdjustBrightness(UserPrefBrightness);
                                                                      mStar_AdjustContrast(UserPrefContrast);
              
              
                                                                      break;
                                                               #endif
                                                              case ColorTempNative:
              
                                                                      break;
                                                              case ColorTemp4000K:
              
                                                                      break;
                                                              case ColorTemp5000K:
              
                                                                      break;
                                                              case ColorTemp6500K:
                                                                      
                                                                      UserPrefColorTemp = CTEMP_Warm1;
                                                                      UserPrefRedColor = UserPrefRedColorWarm1;
                                                                      UserPrefGreenColor = UserPrefGreenColorWarm1;
                                                                      UserPrefBlueColor = UserPrefBlueColorWarm1;
                                                                      ReadColorTempSetting(); // 2006/11/10 6:59PM by KK ReadWarm1Setting();
                                                                      mStar_AdjustBrightness(UserPrefBrightness);
                                                                      mStar_AdjustContrast(UserPrefContrast);
              
              
                                                                      break;
                                                              case ColorTemp7500K:
                                                                      UserPrefColorTemp = CTEMP_Normal;
                                                                      UserPrefRedColor = UserPrefRedColorNormal;
                                                                      UserPrefGreenColor = UserPrefGreenColorNormal;
                                                                      UserPrefBlueColor = UserPrefBlueColorNormal;
                                                                      ReadColorTempSetting(); // 2006/11/10 6:59PM by KK ReadNormalSetting();
                                                                      mStar_AdjustBrightness(UserPrefBrightness);
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 75  

                                                                      mStar_AdjustContrast(UserPrefContrast);
              
                                                                      break;
                                                              case ColorTemp8200K:
              
                                                                      break;
                                                              case ColorTemp9300K:
                                                                      
                                                                      UserPrefColorTemp = CTEMP_Cool1;
                                                                      ReadColorTempSetting(); // 2006/11/10 6:59PM by KK      ReadCool1Setting();
                                                                      UserPrefRedColor = UserPrefRedColorCool1;
                                                                      UserPrefGreenColor = UserPrefGreenColorCool1;
                                                                      UserPrefBlueColor = UserPrefBlueColorCool1;
                                                                      mStar_AdjustBrightness(UserPrefBrightness);
                                                                      mStar_AdjustContrast(UserPrefContrast);
              
              
                                                                      break;
                                                              case ColorTemp10000K:
              
                                                                      break;
                                                              case ColorTemp11500K:
              
                                                                      break;
                                                              case ColorTempUser:
              
                                                                      break;
                                                              case SaveAllColorTemp:                                  
                                                                      SaveFactorySetting();
                                                                      break;
                                                              
                                                              default:
                                                                      break;                                                  
                                                      }                       
                                                      DDCBuffer[1]=0x02;      
                                              }
                                              else
                                              {
                                                      switch(TPVCMD2)
                                                      {
                                                          #if CT_sRGB_ENABLE
                                                              case ColorTempSRGB:
                                                                      UserPrefColorTemp = CTEMP_SRGB;
                                                                      UserPrefRedColorSRGB = UserPrefRedColor;
                                                                      UserPrefGreenColorSRGB = UserPrefGreenColor;
                                                                      UserPrefBlueColorSRGB = UserPrefBlueColor;
                                                                      break;
                                                               #endif
                                                              case ColorTempNative:
              
                                                                      break;
                                                              case ColorTemp4000K:
              
                                                                      break;
                                                              case ColorTemp5000K:
              
                                                                      break;
                                                              case ColorTemp6500K:
                                                                      UserPrefColorTemp = CTEMP_Warm1;
                                                                      UserPrefRedColorWarm1 = UserPrefRedColor;
                                                                      UserPrefGreenColorWarm1 = UserPrefGreenColor;
                                                                      UserPrefBlueColorWarm1 = UserPrefBlueColor;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 76  

              
              
                                                                      break;
                                                              case ColorTemp7500K:
                                                                      UserPrefColorTemp = CTEMP_Normal;
                                                                      UserPrefRedColorNormal= UserPrefRedColor;
                                                                      UserPrefGreenColorNormal= UserPrefGreenColor;
                                                                      UserPrefBlueColorNormal= UserPrefBlueColor;
              
              
                                                                      break;
                                                              case ColorTemp8200K:
              
                                                                      break;
                                                              case ColorTemp9300K:
                                                                      
                                                                      
                                                                      UserPrefColorTemp = CTEMP_Cool1;
                                                                      UserPrefRedColorCool1 = UserPrefRedColor;
                                                                      UserPrefGreenColorCool1 = UserPrefGreenColor;
                                                                      UserPrefBlueColorCool1 = UserPrefBlueColor;
              
              
                                                                      //Osd_Draw4Num(0,1,UserPrefRedColor);
                                                                      //Osd_Draw4Num(0,2,UserPrefRedColorCool1);
                                                                      break;
                                                              case ColorTemp10000K:
              
                                                                      break;
                                                              case ColorTemp11500K:
              
                                                                      break;
                                                              case ColorTempUser:
              
                                                                      break;
                                                              case SaveAllColorTemp:                                          
                                                                      SaveFactorySetting();
                                                                      break;
                                                              default:
                                                                      break;                                                  
                                                      }
                                                      //Osd_Draw4Num(0,0,11);
                                                      //Osd_Show();                           
                                                      SaveFactorySetting();
                                              
                                              #if USEFLASH
                                    //Flash_ReadMonitorSet(0, (BYTE*)&MonitorSetting, MonitorSettingSize);    
                                    Flash_ReadMonitorSet((BYTE*)&MonitorSetting, MonitorSettingSize);
                                       tempValue=MonitorSetting.ColorTemp;
                                      //Flash_ReadFactorySet(0, (BYTE*)&FactorySetting, FactorySettingSize);  
                                      Flash_ReadFactorySet((BYTE*)&FactorySetting, FactorySettingSize);
                                              
                                              //msWriteByte(SC0_34,tempValue);
                                              //msWriteByte(SC0_35,UserPrefBlueColorCool1);
                                              #else
                                              NVRam_ReadByte(nvrMonitorAddr(ColorTemp), &tempValue);
                                              NVRam_ReadTbl(MonitorSettingAddr, (BYTE*) &MonitorSetting, MonitorSettingSize);
                                            NVRam_ReadTbl(FactorySettingAddr, (BYTE*) &FactorySetting, FactorySettingSize);
                                      #endif
                                              switch(tempValue)
                                              {
                                                      #if CT_sRGB_ENABLE
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 77  

                                                              case  CTEMP_SRGB:
                                                                      #if USEFLASH
                                                              if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                      FactorySetting.RedColorsRGB== UserPrefRedColor&&
                                                                      FactorySetting.GreenColorsRGB== UserPrefGreenColor&&
                                                                      FactorySetting.BlueColorsRGB == UserPrefBlueColor)
                                                              #else
                                                              if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                      FactorySetting.RedColorsRGB== UserPrefRedColor&&
                                                                      FactorySetting.GreenColorsRGB== UserPrefGreenColor&&
                                                                      FactorySetting.BlueColorsRGB == UserPrefBlueColor)
                                                                      #endif
                                                                      DDCBuffer[1]=0x02;
                                                              else
                                                                      DDCBuffer[1]=0x04;
                                                                      break;
                                                               #endif
                                                              case CTEMP_Warm1:
                                                                      #if USEFLASH
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                              FactorySetting.RedColorWarm1 == UserPrefRedColor&&
                                                                              FactorySetting.GreenColorWarm1 == UserPrefGreenColor&&
                                                                              FactorySetting.BlueColorWarm1 == UserPrefBlueColor)
                                                                      #else
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                              FactorySetting.RedColorWarm1 == UserPrefRedColor&&
                                                                              FactorySetting.GreenColorWarm1 == UserPrefGreenColor&&
                                                                              FactorySetting.BlueColorWarm1 == UserPrefBlueColor)
                                                                              #endif
                                                                              DDCBuffer[1]=0x02;
                                                                      else
                                                                              DDCBuffer[1]=0x04;
                                                              
                                                                      break;
                                                              case CTEMP_Normal:
                                                                              #if USEFLASH
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                              FactorySetting.RedColorNormal== UserPrefRedColor&&
                                                                              FactorySetting.GreenColorNormal== UserPrefGreenColor&&
                                                                              FactorySetting.BlueColorNormal== UserPrefBlueColor)
                                                                      #else
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                              FactorySetting.RedColorNormal== UserPrefRedColor&&
                                                                              FactorySetting.GreenColorNormal== UserPrefGreenColor&&
                                                                              FactorySetting.BlueColorNormal== UserPrefBlueColor)
                                                                              #endif
                                                                              DDCBuffer[1]=0x02;
                                                                      else
                                                                              DDCBuffer[1]=0x04;
                                                              
                                                                      break;
                                                              
                                                              case CTEMP_Cool1:
                                                                      #if USEFLASH
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&                               
                                                                      FactorySetting.RedColorCool1 == UserPrefRedColor&&
                                                                      FactorySetting.GreenColorCool1 == UserPrefGreenColor&&
                                                                      FactorySetting.BlueColorCool1 == UserPrefBlueColor)
                                                                      #else
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&                               
                                                                      FactorySetting.RedColorCool1 == UserPrefRedColor&&
                                                                      FactorySetting.GreenColorCool1 == UserPrefGreenColor&&
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 78  

                                                                      FactorySetting.BlueColorCool1 == UserPrefBlueColor)
                                                                      #endif
                                                                      DDCBuffer[1]=0x02;
                                                                      else
                                                                              DDCBuffer[1]=0x04;
                                                                      //Osd_Draw4Num(0,1,UserPrefRedColor);
                                                                      //Osd_Draw4Num(0,2,UserPrefRedColorCool1);
                                                                      msWriteByte(SC0_36,DDCBuffer[1]);
              
                                                                      break;
                                                              
                                                              default:
                                                                      break;                                                  
                                                      }
                                                      
                                              }
                                              //#undef ColTemp
                                              //#undef InpSrc
                                              //#undef ActFlag
                                      
                                      }
                                      #if HDCPKEY_IN_Flash
                                      else if(TPVCMD1==TPV_HDCPReadWriteStart&&WriteHDCPcodeFlag)     
                                      {
                                      #if ((CHIP_ID == CHIP_TSUM9 || CHIP_ID == CHIP_TSUMF) && ENABLE_CABLE_5V_EDID)
                              WORD wTemp;
                              if(SIO_TYPE2 < (HDCPKEY_SIZE/HDCP_BLOCK_LENGTH))
                                  Flash_Write_Factory_KeySet(FLASH_KEY_HDCP, SIO_TYPE2, HDCP_BLOCK_LENGTH, &SIORxBuffer[
             -3], HDCP_BLOCK_LENGTH);
                              else if(SIO_TYPE2 == (HDCPKEY_SIZE/HDCP_BLOCK_LENGTH))
                              {   Flash_Write_Factory_KeySet(FLASH_KEY_HDCP, SIO_TYPE2, HDCP_BLOCK_LENGTH, &SIORxBuffer[
             -3], HDCPKEY_SIZE%HDCP_BLOCK_LENGTH);
                                  for(wTemp=0; wTemp<HDCPKEY_SIZE; wTemp++)
                                  {
                                      TCRCvalue = CRC16(FlashReadByte(g_wKEYSET_START+wTemp), TCRCvalue);
                                  }
                                                      Set_LoadHDCPKeyFlag();
                                                      Power_TurnOnGreenLed();
                              }
                                      #else
                                                    BYTE i;
                                                  for (i = 0; i < HDCP_BLOCK_LENGTH; i++)
                                                  {//SIO_TYPE2==HDCP BANK NO    SIORxBuffer[3+i]==HDCP DATA
                                                      if(HDCP_BLOCK_LENGTH*SIO_TYPE2+i<HDCPKEY_SIZE)
                                                      {
                                                          FlashHDCPWriteByte((HDCPKEYSET_START+HDCP_BLOCK_LENGTH*SIO_TYPE2+i),SIORxBuf
             -fer[3+i]);
                                                          TCRCvalue = CRC16(FlashReadByte(HDCPKEYSET_START+HDCP_BLOCK_LENGTH*SIO_TYPE2
             -+i), TCRCvalue);
                                                                                                              
                                                      }
                                                                              
                                                  }
                                                 
                                                  if (SIO_TYPE2==HDCPKEY_SIZE/HDCP_BLOCK_LENGTH)//HDCP WRITE END
                                                  {
                                                      Set_LoadHDCPKeyFlag();
                                                              bFlashWriteFactory = FALSE;
                                                              FlashEnableWP();
              
                                                         #if 0 //Enable_Cache
                                                   
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 79  

                                                      #if Enable_Cache
                                                          CACHE_ENABLE();  //MCU_EnableCache();
                                                      #else
                                                          CACHE_DISABLE();
                                                      #endif
                                                   #endif
              
                                                      Power_TurnOnGreenLed();
                                                  }
                                      #endif
                                      }       
                                      #endif
                                      else if(TPVCMD1==TPV_SelectGamma)       
                                      {
                                      }       
              
              
                                      
              
                                      
                                      #undef TPV_ValueH
                                      #undef TPV_ValueL                       
                                      #undef TPVCMD1
              //==========================NewFactoryCommand=================
              
                                      #endif
4797   4                              {
4798   5                              #if 1//ndef WH_REQUEST
4799   5                              AOCAlign();
4800   5                              #endif
4801   5      
4802   5                              }
4803   4      
4804   4                      }   
4805   3              }
4806   2      #if JRY_Color_Tool_Functing
4807   2             else if(CPCode == 0x7B && PageValue == 0)
4808   2             {
4809   3                  Resault=JRYColorToolControl();
4810   3             }
4811   2      #endif
4812   2              else
4813   2              {
4814   3                  DDCBuffer[2] = 0x01;
4815   3              }
4816   2              //Setting----------------------------------End
4817   2              //Transmission-----------------------------Start
4818   2              if (CommandCode == SETVCPFeature)
4819   2              {
4820   3                #if  JRY_Color_Tool_Functing
4821   3                 if(CPCode == 0x7B)   
4822   3                  return Resault;
4823   3                 else
4824   3              #endif
4825   3                      {
4826   4                              UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit);
4827   4                           return 9;
4828   4                      }        
4829   3              }
4830   2              else
4831   2              {
4832   3                  DDCBuffer[0] = 0x89;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 80  

4833   3                  DDCBuffer[1] = 0xC7;
4834   3                  DDCBuffer[3] = PageValue;
4835   3                  DDCBuffer[4] = CPCode;
4836   3                  DDCBuffer[5] = TPValue;
4837   3                  DDCBuffer[6] = ValueH;
4838   3                  DDCBuffer[7] = ValueL;
4839   3                  DDCBuffer[8] = RetValueH;
4840   3                  DDCBuffer[9] = RetValueL;
4841   3                  return 9;
4842   3              }
4843   2              //Transmission-------------------------------End
4844   2          }
4845   1          //SetValue------------------------------------------------------End
4846   1          else if (CommandCode == SaveCurrentSetting)
4847   1          // 1-10
4848   1          {
4849   2              //SaveUserPref();
4850   2              #if USEFLASH
4851   2              UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit|bFlashSaveModeBit);
4852   2              #else
                      SaveMonitorSetting();
                      SaveModeSetting();
                      #endif
4856   2              
4857   2              return 0;
4858   2          }
4859   1          else if (CommandCode == GETVCPPage)
4860   1          // 1-11
4861   1          {
4862   2              DDCBuffer[0] = 0x83;
4863   2              DDCBuffer[1] = 0xC5;
4864   2              DDCBuffer[2] = 0;
4865   2              DDCBuffer[3] = 3;
4866   2              return 3;
4867   2          }
4868   1          DDCBuffer[0] = 0x80;
4869   1          return 0;
4870   1      }
4871          
4872          #else
              
              BYTE AlignControl(void)
              {
                  BYTE CommandCode, CPCode, ValueL, RetValueH, RetValueL, PageValue;
                  BYTE TPValue;
                  WORD WordValue, ValueH;
                      WORD XDATA g_wFDCRCValue = 0;
              #if JRY_Color_Tool_Functing
                  BYTE  XDATA Resault;
               #endif
                  CommandCode = DDCBuffer[1];
                  PageValue = 0;
              
              
                  
                  if (CommandCode == SETVCPFeature)
                  // 1-1
                  {
                      CPCode = DDCBuffer[2];
                      RetValueH = DDCBuffer[3];
                      RetValueL = DDCBuffer[4];
                      WordValue = ((WORD)DDCBuffer[3] << 8) | ((WORD)DDCBuffer[4]);
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 81  

                  }
                  else if (CommandCode == SETPagedVCP)
                  // 1-5
                  {
                      PageValue = DDCBuffer[2];
                      CPCode = DDCBuffer[3];
                      RetValueH = DDCBuffer[4];
                      RetValueL = DDCBuffer[5];
                      WordValue = ((WORD)DDCBuffer[4] << 8) | ((WORD)DDCBuffer[5]);
                  }
                  else if (CommandCode == GETVCPFeature)
                  // 1-2
                  {
                      CPCode = DDCBuffer[2];
                  }
                  else if (CommandCode == GETPagedVCP)
                  // 1-4
                  {
                      PageValue = DDCBuffer[2];
                      CPCode = DDCBuffer[3];
                  }   
                 else
                 {
                      RetValueH = CAP_VCP[4];
                      RetValueL = DVI_CAP_VCP[5];   
                              DDCBuffer[0] = 0x80;
                              return 0;
                 }
                      
              
                 if (CommandCode == GETVCPFeature || CommandCode == GETPagedVCP)
                  {
                      //Initial-----------------------Start
                      if (CommandCode == GETVCPFeature)
                      {
                          if(CPCode==TPV_App_Command)
                              {
                              DDCBuffer[0] = 0x88;
                              DDCBuffer[1] = 0x02;
                              DDCBuffer[2] = 0x00;
                              DDCBuffer[3] = IMenu_Application;
                              //DDCBuffer[4] = SIORxBuffer[1];//ExtByte
                              }
                          else
                              {
                          DDCBuffer[0] = 0x88;
                          DDCBuffer[1] = 0x02;
                          DDCBuffer[2] = 0x00;
                          DDCBuffer[3] = CPCode;
                          DDCBuffer[4] = 0x01;
                          ValueH = 0x00;
                          ValueL = 0xFF;
                          RetValueH = 0x00;
                          TPValue = 0x01;
                      }
                      }
                      else
                      {
                          DDCBuffer[0] = 0x89;
                          DDCBuffer[1] = 0xC7;
                          DDCBuffer[2] = 0x00;
                          DDCBuffer[3] = PageValue;
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 82  

                          DDCBuffer[4] = CPCode;
                          DDCBuffer[5] = 0x01;
                          ValueH = 0x00;
                          ValueL = 0xFF;
                          RetValueH = 0x00;
                          TPValue = 0x01;
                      }
                      //Initial-----------------------End
                      //Setting---------------------------------Start
                      if (CPCode == NewControl && PageValue == 0)
                      {
                           /*if(DDCCINewControlFlag)
                          RetValueL = 2;
                          else*/
                          RetValueL = 1;
                          ValueL = 2;
                      }  
                 #if ENABLE_HDMI_DRR_MCCS
                      else if(CPCode == VCP_FREESYNC_MODE)
                      {   
                          TPValue = 0x00;
                          ValueH = 0x00;
                          ValueL = 0x01;
                          RetValueH = 0x00;
                          if(UserprefFreeSyncMode)
                              RetValueL=1;
                          else
                              RetValueL =0;// USER_PREF_FREESYNCMODE;
                      }
              #endif
                              
                      #if ColorTool_Clear_Time
                      
                      else if(CPCode == GetUserTime&& PageValue == 0)
                      {
                              #if  Show_BackLightTimeValue
                                      
                              TPValue = 0x00;
                              ValueH          =BlacklitTime_H;
                              ValueL          =0;
                              RetValueH       =BlacklitTime_M;
                              RetValueL       =BlacklitTime_S;        
                              
                              #endif
                      }
                              //*/
                      else if(CPCode == CleanUsedTime && PageValue == 0)
                      {
                              if (PowerOnFlag)
                                      Set_DDCCResetTimeFlag();
                      }
                              
                      else if(CPCode == AutoColorDDCCI&& PageValue == 0)
                      {
                              
                                      if(SrcInputType== Input_VGA)
                                      {                       
                                              Set_DDCCIAutoColorFlag();
                                      }
                      }
                              
                      #endif
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 83  

                        else
                      {
                          DDCBuffer[2] = 0x01;
                          RetValueL = 0x00;
                          ValueH = 0xFF;
                          ValueL = 0xFF;
                      }
                      //Setting---------------------------------End
                      //Transmission----------------------------Start
                      if (CommandCode == GETVCPFeature)
                      {
                          if(CPCode==TPV_App_Command)
                              {
                                      DDCBuffer[5] = ValueH;
                                      DDCBuffer[6] = ValueL;
                                      DDCBuffer[7] = RetValueH;
                                      DDCBuffer[8] = RetValueL;
                              }
                              else
                              {
                          DDCBuffer[4] = TPValue;
                          DDCBuffer[5] = ValueH;
                          DDCBuffer[6] = ValueL;
                          DDCBuffer[7] = RetValueH;
                          DDCBuffer[8] = RetValueL;
                              }
                          return 8;
                      }
                      else
                      {
                          DDCBuffer[5] = TPValue;
                          DDCBuffer[6] = ValueH;
                          DDCBuffer[7] = ValueL;
                          DDCBuffer[8] = RetValueH;
                          DDCBuffer[9] = RetValueL;
                          return 9;
                      }
                      //Transmission----------------------------End
                  }
              
                  //SetValue------------------------------------------------------Start
                  else if (CommandCode == SETVCPFeature || CommandCode == SETPagedVCP)
                  {
                    /*
                      //if(!DisplayLogoFlag)
                     // Osd_Hide();
                     */
                      DDCBuffer[2] = 0x00; // Result Code
                      ValueH = 0x00;
                      ValueL = 0xFF;
                      TPValue = 0x01;
              
              #if JRY_Color_Tool_Functing
                      if(CPCode == 0x7B && PageValue == 0)
                     {
                          Resault=JRYColorToolControl();
                     }
                        else
              #endif
                      {
                          DDCBuffer[2] = 0x01;
                      }
C51 COMPILER V9.01   DDC2BI                                                                08/18/2023 11:33:20 PAGE 84  

                      //Setting----------------------------------End
                      //Transmission-----------------------------Start
                      if (CommandCode == SETVCPFeature)
                      {
                        #if  JRY_Color_Tool_Functing
                         if(CPCode == 0x7B)   
                          return Resault;
                         else
                      #endif
                              //else
                                   return 9;
                      }
                      else
                      {
                          DDCBuffer[0] = 0x89;
                          DDCBuffer[1] = 0xC7;
                          DDCBuffer[3] = PageValue;
                          DDCBuffer[4] = CPCode;
                          DDCBuffer[5] = TPValue;
                          DDCBuffer[6] = ValueH;
                          DDCBuffer[7] = ValueL;
                          DDCBuffer[8] = RetValueH;
                          DDCBuffer[9] = RetValueL;
                          return 9;
                      }
                      //Transmission-------------------------------End
                  }
                  else
                  {
                              AOCAlign();
                   }
                  DDCBuffer[0] = 0x80;
                  return 0;
              }
              
              #endif
5117          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   6138    ----
   CONSTANT SIZE    =    513    ----
   XDATA SIZE       =   ----       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      17
   IDATA SIZE       =      3    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
